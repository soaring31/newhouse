{# 调用说明开始 #}
{# {% import "HouseBundle:Macro:global.html.twig" as house_global %} #}
{# {{house_global.around_count({})}} #}
{# 调用说明结束 #}

    {# 说明
* 总参数说明
* 1：selected  已选条件数据合集
* 2：filter_rows：默认值：4，横向显示搜索条件条数
* 3：filter_action 默认值：action（当前路径） 搜索跳转路径
* 4：filter_url_opt  附加已选条件 键值对格式
* 5: filter_relate: 是否调用商圈、地铁筛选条件
* 6：filter_opt 搜索数据 结构如下说明
* 7：filter_hd 搜索栏头部数据
* 8：filter_type  搜索结构
*    可选值 {
*       0：地图所用搜索结构
*       1：默认值 普通列表所用搜索结构
*       2：首页筛选分类所用筛选结构
*    }
*
*
* 数据结构说明
* {% set filter_opt = {
*     area: {
*         title: '区域',
*         src: 'db.area',
*         relate: 'cate_circle',
*         sql_opt: {
*             pid: app.session.get('area')|default(0)
*         }
*     },
*     cate_circle: {
*         title: '商圈',
*         src: 'house.cate_circle',
*         type: 'relate',
*         p_relate: 'area',
*         sql_opt: {
*             pid: app.request.get('area'),
*             pageSize: 30
*         }
*     },
*     zj: {
*         title: '总价',
*     },
*     fwpt: {
*         title: '房屋配套',
*         src: 'srv_common',
*         type: 'form'
*     }
* } %}
* 方式一：relate表示所要关联的分类
* 方式二：type类型为relate的时候说明这只是一个关联搜索，p_relate表示所关联的父级字段
* 方式三：从分类表（house.category）中获取分类
* 方式四：从表单中获取分类，需定义type类型为form，src就是该字段所在的表单
*
*
* 参数说明
* 1：type 类型
*    可选值 {
*       form: 表示从表单中获取数据
*       relate: 表示关联字段类型，标注了此类型的字段不可独立使用，需配合p_relate中定义的属性一同使用
*    }
* 2: src 路径
*    可选值 {
*       house.category: 默认值，分类表
*       house.XX or db.XX: 从数据库中获取分类
*       form名称： 填写表单名称，从表单中获取分类
*    }
* 3：title 标题
* 4：sql_opt  查找条件
*    可选值 {
*       pageSize: 15,ename: k, pid: 'neq|0', order: 'sort|asc', 默认值， 最多获取条数为15条，父级id为0，升序排序
*       附加条件： 附加条件的数据形式必须是一个键值对的对象，如{pid: 12},如额外添加的条件中的key值与默认的相同，则会覆盖默认的，如不同，则会重新增加一个搜索条件
*    }
* 5：add  联合搜索
*    可选值 {
*       1：默认值，开启联合搜索
*       0: 关闭联合搜索，意思是此个条件除了当前选择筛选之外，其余情况都会清零
*    }
* 6：p_relate 所关联的父级字段
* 7：relate 所关联的子级字段
#}
{% macro cate_opt(opt) %}
    {% set _opt = {
            arr: []
        }|merge(opt) %}

    {# 检索配置 #}
    {% set cate_opt = {
        region: {
            title: '区域',
            src: 'db.area',
            children: {
                    title: '商圈',
                    name: 'cate_circle',
                    src: 'house.cate_circle',
                    sql_opt: {
                        pid: app.request.get('region', 0),
                        order: 'id|asc'
                    }
                },
            sql_opt: {
                pid: app.session.get('area')|default(0)
            },
            value: null,
            icon: 'font-f-15'
        },
        cate_line: {
            title: '地铁',
            src: 'house.cate_line',
            children: {
                title: '地铁站',
                name: 'cate_metro',
                src: 'house.cate_metro',
                sql_opt: {
                    pid: 'find|' ~ app.request.get('cate_line', 0),
                    order: 'id|asc'
                },
                value: null
            },
        },
        cate_type: {
            title: '类型',
            icon: 'font-f-47'
        },
        zj: {
            title: '总价',
            icon: 'font-f-26'
        },
        dj: {
            title: '价格',
            icon: 'font-f-26'
        },
        czj: {
            title: '租价',
            icon: 'font-f-26'
        },
        shoptype: {
            title: '类型',
        },
        officetype: {
            title: '类型'
        },
        mj: {
            title: '面积',
            icon: 'font-f-87'
        },
        fl: {
            title: '房龄',
            icon: 'font-f-88'
        },
        cx: {
            title: '朝向',
        },
        esflx: {
            title: '用途',
        },
        czlx: {
            title: '类型',
            icon: 'font-f-47'
        },
        zxcd: {
            title: '装修程度',
        },
        fwjg: {
            title: '房屋结构',
        },
        shi: {
            title: '室',
        },
        ting: {
            title: '厅',
        },
        chu: {
            title: '厨',
        },
        wei: {
            title: '卫',
        },
        fwpt: {
            title: '房屋配套',
            src: 'srv_common',
            type: 'form'
        },
        hxs: {
            title: '环线',
            name: 'hxs',
            type: 'form',
            src: 'hxs',
            value: null
        },
        lcs: {
            title: '楼层',
            type: 'form',
            src: 'lcs',
        },
        cate_status: {
            title: '状态',
        },
        tslp: {
            title: '特色',
            type: 'form',
            src: 'houses_common',
        },
        school_type: {
            title: '分类',
            src: 'around_school',
            type: 'form'
        },
        fkfs: {
            title: '付款方式',
            type: 'form',
            src: 'rent'
        },
        zlfs: {
            title: '方式',
            type: 'form',
            src: 'rent'
        },
        syzj: {
            title: '总价',
        },
        syczj: {
            title: '租金',
        },
        spczj: {
            title: '租金',
        }
    } %}
    {% set _data = [] %}
    {#
        arr = ['region', 'cate_line']
        arr = {
            category: {
                title: '环线',
                name: 'category',
                type: 'form',
                src: 'hxs',
                value: null
            }
        }
     #}
    {# 按标记生成配置 #}
    {% if _opt.arr[0]|default('') %}
        {% for item in _opt.arr if item in cate_opt|keys %}
            {% set _data = _data|merge({(item): cate_opt[item]}) %}
        {% endfor %}
    {% else %}
    {# 直接获取传过来的配置 #}
        {% set _data = _opt.arr %}
    {% endif %}
    {# 输出 #}
    {{ _data|json_encode|raw }}
{% endmacro cate_opt %}

{% macro cate_data(opt) %}
    {% from 'CoreBundle:Macro:global.html.twig' import mconfigtostring %}
    {#
        houses                : 新房
        sale                  : 二手房
        rent                  : 出租
        special               : 特价房
        office_houses         : 写字楼新房
        sp_lp                 : 商铺新房
        index_houses_filter   : 首页新房
        index_sale_filter     : 首页二手
        index_rent_filter     : 首页出租
        region                : 区域筛选
        xq_sale               : 小区二手
        xq_rent               : 小区出租
        xzl_sale              : 写字楼出售
        xzl_rent              : 写字楼出租
        sp_sale               : 商铺出售
        sp_rent               : 商铺出租
        xuequ                 : 学区
        news                  : 资讯
        map_location          : 附近找房
        door                  : 户型
        member_jjgs_sale      : 经纪公司出售
        member_jjgs_rent      : 经纪公司出售
     #}
    {% set _opt = {
        url_opt: [],
        selected: [],
        tag: 'sale',
        arr_tags: {
            houses: ['region','cate_line', 'dj', 'cate_type', 'tslp', 'cate_status', 'zxcd', 'lcs', 'hxs', ],
            special: ['region', 'zj', 'mj', 'cate_status', 'shi', 'ting', 'chu', 'wei', 'zxcd', 'cx', 'lcs'],
            sale: ['region', 'cate_line', 'zj', 'mj', 'fl', 'cx', 'esflx', 'zxcd', 'fwjg', 'shi', 'ting', 'chu', 'wei', 'fwpt', ],
            rent: ['region','cate_line', 'mj', 'czj', 'zlfs', 'shi', 'ting', 'chu', 'wei', 'fl', 'czlx', 'fwpt', 'zxcd', 'cx', 'fkfs',],
            index_houses_filter: ['region', 'dj', 'cate_type'],
            index_sale_filter: ['region', 'zj', 'mj', 'fl'],
            index_rent_filter: ['region', 'czj', 'mj', 'czlx'],
            xq_sale: ['zj', 'mj', 'esflx', 'shi'],
            xq_rent: ['czj', 'mj', 'czlx', 'shi'],
            office_houses: ['region', 'officetype', 'dj'],
            xzl_sale: ['region', 'syzj', 'mj', 'fl'],
            xzl_rent: ['region', 'syczj', 'mj', 'fl'],
            sp_lp: ['region', 'shoptype', 'dj'],
            sp_sale: ['region', 'syzj', 'mj', 'fl'],
            sp_rent: ['region', 'spczj', 'mj', 'fl'],
            xuequ: ['region', 'school_type'],
            region: ['region'],
            door: ['region', 'mj', 'cate_type', 'shi', 'cate_status'],
            member_jjgs_sale: ['shi', 'zj', 'mj'],
            member_jjgs_rent: ['shi', 'czj', 'mj'],
            map_location: {
                models: {
                    title: '类型',
                    type: 'myself',
                    data: {
                        0: {name:'新房', id:'houses'},
                        1: {name:'二手房', id:'sale'},
                        2: {name:'出租', id:'rent'}
                    }
                },
                ranges: {
                    title: '附近',
                    type: 'myself',
                    data: {
                       0: {name: '一公里', id:'1000'},
                       1: {name: '两公里', id:'2000'},
                       2: {name: '三公里', id:'3000'},
                       3: {name: '五公里', id:'5000'},
                       4: {name: '十公里', id:'10000'}
                    }

                }
            },
            news: {
                category: {
                    title: '资讯分类',
                    sql_opt: {
                        pid: 1
                    }
                }
            },
            photos: {
                category: {
                    title: '图库分类',
                    sql_opt: {
                        pid: 23
                    }
                }
            },
            video: {
                category: {
                    title: '视频分类',
                    sql_opt: {
                        pid: 16
                    }
                }
            },
            web_ask: {
                category: {
                    title: '服务中心分类',
                    sql_opt: {
                        models: 'ask',
                        pid: 'neq|0',
                    }
                }
            },
            web_server: {
                category: {
                    title: '服务中心分类',
                    sql_opt: {
                        models: 'service',
                        pid: 'neq|0',
                        id: 'neq|12'
                    }
                }
            },
            web_zyzn: {
                category: {
                    title: '置业指南',
                    sql_opt: {
                        pid: 36
                    }
                }
            },
        },
        switch: {}
    }|merge(opt|default('')) %}

    {# 开关 #}
    {% set switch = {
        cate_circle: 0,
        cate_line: 0,
        hxs: 0,
    }|merge(_opt.switch) %}

    {% set _switch = {
        cate_circle: mconfigtostring({name: 'closesqcircle', ename: 'mother'}).__toString ? switch.cate_circle : 0,
        cate_line: mconfigtostring({name: 'closesubway', ename: 'mother'}).__toString ? switch.cate_line : 0,
        hxs: mconfigtostring({name: 'closeloop', ename: 'mother'}).__toString ? switch.hxs : 0,
    } %}

    {% set arr_close = [] %}  {# 用于保存要关闭的内容 #}
    {% for k, v in _switch if v == 0 %}
        {% set arr_close = arr_close|merge([k]) %}
    {% endfor %}

    {# 分类配置 #}
    {% set cate_opt = _self.cate_opt({
            arr: _opt.tag|is_array ? _opt.tag : _opt.arr_tags[_opt.tag],
        }).__toString|json_decode %}
    {# url参数配置 #}
    {% set url_opt = _opt.url_opt %}

    {# 已选择项目 #}
    {% set selected = _opt.selected %}

    {# 处理一系列的配置 #}
    {% set new_cate_opt = [] %}

    {% for k, v in cate_opt if k not in arr_close %}
        {# 默认参数 #}
        {% set sql_opt = {pageSize: 50, ename: k, order: 'sort|asc', checked: 1}|merge(v.sql_opt|default({})) %}
        {% set src = v.src|default('house.category') %}
        {# add==0 时 不参与联合搜索 #}
        {% set add = v.add|default(1) %}
        {# /默认参数 #}

        {# url_opt #}
        {# 当前值 #}
        {% set value = app.request.get(k) %}
        {# 已选择项 #}
        {% if value and add %}
            {% set url_opt = url_opt|merge({(k): value}) %}
        {% endif %}
        {# /url_opt #}

        {# children #}
        {% set children_opt = [] %}
        {% set v1 = v.children|default({}) %} {# 等于循环了一次 #}
        {% set k1 = v1.name|default('') %}
        {% if v1 and k1 not in arr_close %}
            {% set sql_opt1 = {pageSize: 50, ename: k1, order: 'sort|asc', checked: 1}|merge(v1.sql_opt|default({})) %}
            {% set src1 = v1.src|default('house.category') %}
            {% set add1 = v1.add|default(1) %}
            {# url_opt #}
            {# 当前值 #}
            {% set value1 = app.request.get(k1) %}
            {# 已选择项 #}
            {% if value1 and add1 %}
                {% set url_opt = url_opt|merge({(k1): value1}) %}
            {% endif %}
            {# /url_opt #}

            {% set data1 = (src1)|getAll(sql_opt1).data %}
                {# 重新整理数据 #}
            {% set n_data1 = [] %}
            {% for item in data1 %}
                {# 处理自动类系 #}
                {% set item_value1 = item.sqlstr|default('') ? : item.id %}
                {# 组装一组新数据 #}
                {% set item_data1 = {value: item_value1, name: item.name} %}
                {# 当传过来的值与循环值相等保存数据 #}
                {% if value1 == item_value1 %}
                    {% set selected = selected|merge({(k1): item_data1}) %}
                {% endif %}
                {% set n_data1 = n_data1|merge([item_data1]) %}
            {% endfor %}
            {#  #}
            {% set children_opt = v1|merge({data: n_data1, value:  value1 == 'no' ? null : value1}) %}
        {% endif %}
        {# /children #}
        {# data #}
    {# 来自表单属性 #}
    {% set data = [] %}
    {% if v.type|default('') == 'form' %}
        {% set data = (src)|getFormField(k) %}
    {% elseif v.type|default('') == 'myself' %}
        {% set data = v.data %}
    {% else %}
        {% if v.src|default('') or k == 'category' %}
            {# 来自分类 #}
            {% set data = (src)|getAll(sql_opt).data %}
        {% else %}
            {% set data = k|getCategory() %}
        {% endif %}
    {% endif %}
        {# /data #}
    {# 新数据容器 #}
    {% set n_data = [] %}
    {# 处理数据 #}
    {% for item in data %}
        {# 处理自动类系 #}
        {% set item_value = item.sqlstr|default('') ? : item.id %}
        {# 组装一组新数据 #}
        {% set item_data = {value: item_value, name: item.name, map: item.map|default('')} %}
        {# 当传过来的值与循环值相等保存数据 #}
        {% if value == item_value %}
            {% set selected = selected|merge({(k): item_data}) %}
        {% endif %}
        {% set n_data = n_data|merge([item_data]) %}
    {% endfor %}

    {# 保存到配置变量里 #}
    {# {% set new_cate_opt = new_cate_opt|merge({(k): cate_opt[(k)]}) %} #}
    {% set kv = cate_opt[(k)]|merge({data: n_data, value: value == 'no' ? null : value, children: children_opt}) %}

    {% set new_cate_opt = new_cate_opt|merge({(k): kv}) %}
{% endfor %}

{% set cate_data = {
    cate_opt: new_cate_opt,
    selected: selected,
    url_opt: url_opt,
} %}
{# 输出 #}
{{ cate_data|json_encode|raw }}
{% endmacro cate_data %}
{#
/**
 * @method around_count(o)
 * @description 周边统计，二手、出租数量
 * @param {String} o.id - 周边id
 * @param {String} o.num=50 - 获取周边楼盘（包括新房，小区）
 * @param {String} o.field - 要统计的字段
 * @example 调用
 * ```twig
 * {{- house_global.around_count({id: school_detail.id|default(''), field: 'sales'}) -}}
 * ```
 */
 #}


{%- macro around_count(o) -%}
    {% if o.ids|default('') %}
        {% set id = o.ids %}
    {% else %}
        {% set id = ('house.houses_arc')|getCol('aid', {form: 'houses_around', fromid: o.id|default(''), checked: 1})|default('')|join(',') %}
    {% endif %}
    {% set data = ('house.houses')|getCol(o.field, {checked: 1, id: 'in|' ~ id, type: 1}) %}
    {% set count = 0 %}
    {% if data is defined %}
        {% for item in data %}
            {% set count = count + item|default('') %}
        {% endfor %}
    {% endif %}
    {{o.tpl|default('%count%')|replace({
        '%count%': count|default('0')
    })|raw}}
{%- endmacro around_count -%}

{#
/**
 * @method if_mj(o)
 * @description 面积类数据显示隐藏  其他参数可参考`core-global`中的 `if_dw(o)`
 * @param {String} o.danwei=m&sup2; - 单位
 * @param {String} o.default_tips=- - 默认值
 * @example 调用
 * ```twig
 * {{house_global.if_mj({value: item.mj|default('')})}}
 * ```
 */
 #}
{%- macro if_mj(o) -%}
{% spaceless %}
    {% import "CoreBundle:Macro:global.html.twig" as core_global %}
    {% if o.value|default('') and o.value|default(0) != 0 %}
        {{core_global.if_dw({danwei: 'm&sup2;', default_tips: o.default_tips|default('-')}|merge(o))}}
    {% else %}
        {{o.default_tips|default('')}}
    {% endif %}
{% endspaceless %}
{%- endmacro -%}

{#
/**
 * @method if_zj(o)
 * @description 以万元为单位的价格 其他参数可参考`core-global`中的 `if_dw(o)`
 * @param {String} o.danwei=万 - 单位
 * @param {String} o.default_tips=面谈 - 默认值
 * @example 调用
 * ```twig
 * {{house_global.if_wy({value: item.zj|default('')})}}
 * ```
 */
 #}

{%- macro if_wy(o) -%}
	{% import "CoreBundle:Macro:global.html.twig" as core_global %}
    {{core_global.if_dw({default_tips: '面谈', danwei: '万'}|merge(o))}}
{%- endmacro -%}
{#
/**
 * @method if_czj(o)
 * @description 出租总价 以元/月为单位的价格 其他参数可参考`core-global`中的 `if_dw(o)`
 * @param {String} o.danwei=元/月 - 单位
 * @param {String} o.default_tips=面谈 - 默认值
 * @example 调用
 * ```twig
 * {{house_global.if_czj({value: item.czj|default('')})}}
 * ```
 */
 #}

{%- macro if_czj(o) -%}
	{% import "CoreBundle:Macro:global.html.twig" as core_global %}
    {{core_global.if_dw({danwei: '元/月', default_tips: '面谈'}|merge(o))}}
{%- endmacro -%}
{#
/**
 * @method if_dj(o)
 * @description 以元/m&sup2;为单位的价格 其他参数可参考`core-global`中的 `if_dw(o)`
 * @param {String} o.danwei=元/m&sup2; - 单位
 * @param {String} o.default_tips=待定 - 默认值
 * @example 调用
 * ```twig
 * {{house_global.if_dj({value: item.czj|default('')})}}
 * ```
 */
 #}

{%- macro if_dj(o) -%}
    {% import "CoreBundle:Macro:global.html.twig" as core_global %}
    {% if '万' in o.value %}
        {# 为了兼容每套多少钱的标记，也就是说如果要以套为单位的情况下，填写的价钱必须包含`万`字 #}
        {% set dj_opt = {
            danwei: '万元/套',
            default_tips: '待定',
            value: o.value|abs
        } %}
    {% else %}
        {% set dj_opt = {
            danwei: '元/m&sup2;',
            default_tips: '待定'
        }|merge(o) %}
    {% endif %}
    {{core_global.if_dw(dj_opt)}}
{%- endmacro -%}
{#
/**
 * @method if_sycz(o)
 * @description 以元/平米 · 月为单位的价格 其他参数可参考`core-global`中的 `if_dw(o)`
 * @param {String} o.danwei=元/平米·月 - 单位
 * @param {String} o.default_tips=面谈 - 默认值
 * @example 调用
 * ```twig
 * {{house_global.if_sycz({value: item.czj|default('')})}}
 * ```
 */
 #}

{%- macro if_sycz(o) -%}
	{% import "CoreBundle:Macro:global.html.twig" as core_global %}
    {{core_global.if_dw({danwei: '元/平米 · 月', default_tips: '面谈'}|merge(o))}}
{%- endmacro if_sycz -%}

{#
/**
 * @method houses_arc_count(o)
 * @description 楼盘分类数量  其他参数可参考`core-global`中的`count(o)`方法
 * @param {string} o.form - 区块分类标识
 * @param {string} o.aid - 所属楼盘id
 * @example
 * ```twig
 * {{ house_global.houses_arc_count({form: 'houses_door', aid: detail.id|default('')}) }}
 * ```
 */
 #}
{% macro houses_arc_count(o) %}
{% spaceless %}
    {% import "CoreBundle:Macro:global.html.twig" as core_global %}
    {% set opt = {
        service: 'house',
        models: 'houses_arc',
        sql_opt: {
            form: o.form|default(''),
            checked: 1,
            aid: o.aid|default('')
        }
    }|merge(o) %}
    {{ core_global.count(opt) }}
{% endspaceless %}
{% endmacro %}

{#
/**
 * @method countshi(o)
 * @description 户型(以室分类)各分类个数
 * @param {String} o.models - 模型名称
 * @param {String} o.cate - 所属分类
 * @param {String} o.aid - 所属楼盘id
 * @param {String} o.groupBy - 筛选合集字段,指此定义的字段值相同的情况下只取一个
 * @example
 * ```twig
 * {{- house_global.countshi({aid: detail.id|default(''), tpl: '<li><a class="%class% album" rel="nofollow" href="#shi=%shi%" data-aid="' ~ detail.id|default('') ~ '" data-shi="%shi%">%name%(%number%)</a><span>|</span></li>'}) -}}
 * ```
 * 生成
 * ```html
 *  <ul>
 *      <li>
 *          <a href="#shi=0" class="act album" data-id="193">全部(2)</a>
 *          <span>|</span>
 *      </li>
 *      <li>
 *          <a class="album" rel="nofollow" href="#shi=148" data-id="193" data-shi="148">3室(1)</a>
 *          <span>|</span>
 *      </li>
 *      <li>
 *          <a class="album" rel="nofollow" href="#shi=147" data-id="193" data-shi="147">2室(1)</a>
 *          <span>|</span>
 *      </li>
 *  </ul>
 * ```
 */
 #}
{%- macro countshi(o) -%}
    {% import "CoreBundle:Macro:global.html.twig" as core_global %}
    {% set opt = {
        models: 'door',
        cate: 'huxing',
        checked: 1,
        groupBy: 'shi',
        show_mj: 0,
        tpl: '%name%%number%'
    }|merge(o) %}
    {%- set shi = app.request.get("shi") -%}
    {% set door_data = ('house.' ~ opt.models)|getAll({checked: opt.checked, aid: o.aid|default(''), findType: 1, groupBy: opt.groupBy, order: 'shi', orderBy: 'asc'}).data %}
    {% if opt.show_mj|default('') %}
        {% set small_mj = 0 %}
        {% set big_mg = 0 %}
        {% for item in door_data %}
            {% if loop.first %}
                {% set small_mj = item.mj %}
                {% set big_mg = item.mj %}
            {% else %}
                {% set small_mj = small_mj > item.mj ? item.mj : small_mj %}
                {% set big_mg = big_mg < item.mj ? item.mj : big_mg %}
            {% endif %}
        {% endfor %}
        {{opt.tpl|replace({
            '%mj%': small_mj == big_mg ? small_mj ~ '平米' : small_mj  ~ '平米 - ' ~ big_mg ~ '平米',
            '%small_mj%': small_mj ~ '平米',
            '%big_mg%': big_mg ~ '平米'
        })}}
    {% else %}
        {%- for item in door_data -%}
            {{- opt.tpl|replace({
                '%name%': core_global.formData({value: item.shi|default('')}),
                '%number%': ('house.' ~ opt.models)|getCount({cate_pushs: opt.cate, checked: opt.checked, aid: item.aid|default(''), shi: item.shi|default('')}),
                '%shi%': item.shi|default(''),
                '%class%': (item.shi|default('') == shi) ? 'act' : ''
            })|raw -}}
        {%- endfor -%}
    {% endif %}
{%- endmacro -%}

{#
/**
 * @method countxc(o)
 * @description 相册各分类个数
 * @param {string} o.models - 模型名称
 * @param {string} o.cate - 所属分类
 * @param {string} o.aid - 所属楼盘id
 * @param {String} o.groupBy - 筛选合集字段,指此定义的字段值相同的情况下只取一个
 * @example
 * ```twig
 * {{- house_global.countxc({aid: detail.id|default(''), tpl: '<li><a class="%class% album" href="#cate=%cate%" data-cate="%cate%" data-aid="' ~ detail.id|default('') ~ '">%name%(%number%)</a><span>|</span></li>'}) -}}
 * ```
 * 生成
 * ```html
 *   <ul>
 *      <li>
 *          <a href="#cate=0" class="act album" data-id="193">全部(6)</a>
 *          <span>|</span>
 *      </li>
 *      <li>
 *          <a class="album" href="#cate=5" data-cate="5" data-id="193">交通图(1)</a>
 *          <span>|</span>
 *      </li>
 *      <li>
 *          <a class="album" href="#cate=6" data-cate="6" data-id="193">规划图(1)</a>
 *          <span>|</span>
 *      </li>
 *      <li>
 *          <a class="album" href="#cate=3" data-cate="3" data-id="193">样板图(1)</a>
 *          <span>|</span>
 *      </li>
 *      <li>
           <a class="album" href="#cate=2" data-cate="2" data-id="193">实景图(1)</a>
           <span>|</span>
 *      </li>
 *      <li>
 *          <a class="album" href="#cate=1" data-cate="1" data-id="193">效果图(2)</a>
 *          <span>|</span>
 *      </li>
 *   </ul>
 * ```
 */
 #}
{%- macro countxc(o) -%}
    {% import "CoreBundle:Macro:global.html.twig" as core_global %}
    {% set opt = {
        models: 'inter_album',
        cate: 'houses_album',
        checked: 1,
        groupBy: 'cate_album'
    }|merge(o) %}
    {%- set cate = app.request.get("cate") -%}

    {%- for item in ('house.' ~ opt.models)|getAll({checked: opt.checked, aid: o.aid|default(''), findType: 1, groupBy: opt.groupBy, order: 'cate_album', orderBy: 'asc'}).data -%}
        {{- o.tpl|default('%name%%number%')|replace({
            '%name%': core_global.formField({value: item.cate_album|default(''), form: opt.cate, field:'cate_album'}),
            '%number%': ('house.' ~ opt.models)|getCount({form: opt.cate, checked: opt.checked, aid: item.aid|default(''), cate_album: item.cate_album|default('')}),
            '%cate%': item.cate_album|default(''),
            '%class%': (item.cate_album|default('') == cate) ? 'act' : ''
        })|raw -}}
    {%- endfor -%}
{%- endmacro -%}

{#
/**
 * @method huxing(o)
 * @description 户型
 * @param {string} o.models - 模型名称
 * @param {string} o.pagesize=20 - 显示条数
 * @param {string} o.id - 所属楼盘id
 * @param {string} o.zlhx=2 - 户型, 默认显示全部(设置为 1为非主力户型，0为主力户型)
 * @param {string} o.tpl='%shi%%ting%' - 模板
 * @param {string} o.controller='door' - 链接控制器
 * @param {string} o.action='detail' - 链接方法
 * @param {Object} o.query={} - 链接其他参数
 * @example
 * 主力户型
 * ```twig
 * {{- house_global.huxing({id: item.id|default(''),zlhx: 0, tpl: "<a class='mr10' href='%url%' target='_blank'>%shi%%ting%%mj%m&sup2;</a>"}) -}}
 * ```
 * @example
 * 当前户型
 * ```twig
 * {{- house_global.huxing({id: item.id|default(''), tpl: '%shi%%ting%%wei%'}) -}}
 * ```
 */
 #}
{%- macro huxing(o) -%}
{% import "CoreBundle:Macro:global.html.twig" as core_global %}
{% spaceless %}
    {% set opt = {
        tpl: '%shi%%ting%',
        models: 'door',
        default: '-',
        pagesize: 20,
        zlhx: 2,
        checked: 1,
        ename: 'huxing',
        id: '-',
        controller: 'door',
        action: 'detail',
        query: {}
    }|merge(o) %}
    {# 直接传数据进来 #}
    {% if opt.data|default('') %}
        {{- _self.hxtpl(opt) -}}
    {%- elseif opt.id != '-'  -%}
        {# 自己获取数据显示 #}
        {% set huxing = ('house.' ~ opt.models)|getRow({checked: opt.checked, id: opt.id|default('')}) %}
        {{- _self.hxtpl(opt|merge({data: huxing})) -}}
    {%- else -%}
        {%- for item in ('house.' ~ opt.models)|getBlock(opt.ename, {pageSize: opt.pagesize, checked: opt.checked, aid: opt.aid|default('') }).data if item.zlhx != opt.zlhx -%}
            {{- _self.hxtpl(opt|merge({data: item})) -}}
        {%- endfor -%}
    {%- endif -%}
{% endspaceless %}
{%- endmacro -%}

 {#
/**
 * @method hxtpl
 * @description 户型属性, 注意：室或者厅至少要选择显示一个且数据不为空，如果没有则其他数据也不会显示
 * @param {string} tpl - 模板
 * @param {string} item - 数据
 * @param {string} default - 默认值
 * @example
 * ```twig
 * {{- house_global.hxtpl(tpl|default('%shi%%ting%'), huxing, '-') -}}
 * ```
 */
 #}
 {%- macro hxtpl(o) -%}
{% spaceless %}
    {% import "CoreBundle:Macro:global.html.twig" as core_global %}
    {%- set id = app.request.get("id") -%}
    {% set item = o.data|default({}) %}
    {% set default = o.default|default('') %}
    {% if item.shi|default('') or item.ting|default('') %}
        {{- o.tpl|replace({
            '%shi%': core_global.formData({value: item.shi|default(''), default: ''}),
            '%ting%': core_global.formData({value: item.ting|default(''), default: ''}),
            '%chu%': core_global.formData({value: item.chu|default(''), default: ''}),
            '%wei%': core_global.formData({value: item.wei|default(''), default: ''}),
            '%mj%': item.mj|default(''),
            '%zj%': item.zj|default(''),
            '%id%': item.id|default(''),
            '%class%': (id|default('') == item.id|default('')) ? 'act' : '',
            '%url%': (o.controller ~ '/' ~ o.action)|UU({id: item.id}|merge(o.query))
        })|raw -}}
    {% else %}
        {{ default }}
    {% endif %}
{% endspaceless %}
 {%- endmacro -%}

 {#
/**
 * @method lptag(o)
 * @description 楼盘属性, con里面包含要显示的值必须在`field`和`service`这两个变量中存在，否则不会显示
 * @param {Array} o.value - 所属数据
 * @param {string} o.con - 要显示的字段，多个字段之间使用(,)分隔如(zxcd,cate_type)
 * @param {string} o.tpl - 模板
 * @param {Object} field - 内部变量，需要从表单中获取数据的字段，增加规则为，key=要显示的字段名称,value=需要在哪个表单中查找该字段
 * @param {Object} service - 内部变量，需要从数据库中获取数据的字段，增加规则为，key=要显示的字段名称，value=表示需要查询的数据表名，默认分类表(house.category)
 * @example
 * ```twig
 * {{- house_global.lptag({value: detail, tpl:'<span>%value%</span>' con: 'zxcd,cate_type'}) -}}
 * ```
 */
 #}
 {%- macro lptag(o) -%}
{% spaceless %}
    {% import "CoreBundle:Macro:global.html.twig" as core_global %}
    {% set opt = {
        tpl: '%value%'
    }|merge(o) %}

    {% set tag = opt.value %}
    {#
        表单字段：k 表示需要查询的字段，v 表示需要查询的表单名称
    #}
    {% set field = {
        'tslp': 'houses_common',
        'lcs': 'houses_common',
        'louxing': 'houses_common',
        'office_ts': 'office_ts',
        'shops_ts': 'shops_ts',
        'buildingfacilities': 'houses_attr_common'
    } %}
    {#
        数据库查询：k 表示需要查询的字段，v 表示需要查询的数据表名，默认分类表'house.category'
    #}
    {% set service = {
        'cate_line': 'house.cate_line',
        'cate_metro': 'house.cate_metro',
        'cate_status': '',
        'zxcd': '',
        'cx': '',
        'cate_type': '',
        'officetype': '',
        'officelevel': '',
        'shoptype': '',
        'shopindustry': ''
    } %}
    {% for item in opt.con|default('')|split(',') %}
        {% for k, v in field %}
            {# 表单查询 #}
            {% if tag[k]|default('') and item == k %}
                {{core_global.formField(o|merge({
                        value: tag[k]|default(''),
                        form: v,
                        field: k,
                        tpl: opt.tpl|replace({'%value%': '%title%'})
                    })
                )}}
            {% endif %}
        {% endfor %}

        {% for k,v in service %}
            {# 数据库 #}
            {% if tag[k]|default('') and item == k %}
                {{core_global.formData(o|merge({
                        value: tag[k]|default(''),
                        form: v|default('house.category'),
                        tpl: opt.tpl
                    })
                )}}
            {% endif %}
        {% endfor %}
    {% endfor %}
{% endspaceless %}
 {%- endmacro -%}

 {#
/**
* @method publisher(id)
* @description 判断用户类型,自定义模板替换标记`%name%`表示用户名，`%id%`表示用户id，`%idcard%`表示是否认证了身份证(返回一个img图片)，`%license%`表示是否认证了营业执照(返回一个img图片)，`%jjgs_id%`表示所属经纪公司id，`%jjgs_name%`表示所属经纪公司名称，`%fwdj%`表示服务等级图片(返回一个img图片)，`%fwdj_name%`表示服务等级名称  图片参见参数参考 coreBundle里面的global.html.twig中的 `img_url` 方法
* @param {Number} o.id - 用户id
* @example 调用
* ```twig
* {{- house_global.publisher({id: users.id|default('')}) -}}
* ```
*/
 #}

{%- macro publisher(o) -%}
{% import "CoreBundle:Macro:global.html.twig" as core_global %}
{% set opt = {
    models: 'member',
    action: 'detail',
    gr_tpl: '%name%',
    jjr_tpl: '%name%'
}|merge(o) %}
{# 会员数据 #}
{% set user = ('db.users')|getRow({id: opt.id|default(''), checked: 1, findType: 1}) %}
{# 会员拓展数据 #}
{% set user_info = ('db.userinfo')|getRow({uid: opt.id|default(''), findType: 1}) %}
{# 会员名称 #}
{% set user_name = user_info.company|default(user_info.nicename|default(user.username|default(''))) %}
{# 会员类型 #}
{% set user_usertype = user_info.usertype|default('') %}

{% if user_usertype|default('') == 11 or user.mid|default('') == 1 %}
{# 普通会员 #}
    {{opt.gr_tpl|default('%name%')|replace({
        '%name%': user_name|default(''),
        '%id%': user.id|default(''),
    })|raw}}
{% elseif user_usertype|default('') == 15 %}
{# 经纪人 #}
    {% if 'idcard' in opt.jjr_tpl %}
        {# 身份认证 #}
        {% set idcard_checked = ('db.user_cert')|getOne('checked', {uid: user.id|default(''), userauth: 5}) %}
        {% if idcard_checked|default('') %}
            {% set idcard_img = ('house.user_auth')|getOne('thumb', {id: 5}) %}
            {% set idcard = '<img src="' ~ core_global.img_url({src: idcard_img, type: 2, height: 20, width: 40}) ~ '" style="height: 20px; width: 40px;" title="身份证认证" />' %}
        {% endif %}
    {% endif %}

    {% if 'license' in opt.jjr_tpl %}
        {# 执照认证 #}
        {% set license_checked = ('db.user_cert')|getOne('checked', {uid: user.id|default(''), userauth: 3}) %}
        {% if license_checked|default('') %}
            {% set license_img = ('house.user_auth')|getOne('thumb', {id: 3}) %}
            {% set license = '<img src="' ~ core_global.img_url({src: license_img, type: 2, height: 20, width: 40}) ~ '"  style="height: 20px; width: 40px;" title="营业执照认证" />' %}
        {% endif %}
    {% endif %}

    {% if 'fwdj' in opt.jjr_tpl %}
        {# 服务等级 #}
        {% set user_level = user.id|getMemAttach(user_info.usertype) %}
            {# {{dump(user_level)}} #}
        {% set user_level_img = '' %}
        {% set user_level_name = '' %}
        {% for item in user_level %}
            {% set user_level_img = '<img src="' ~ core_global.img_url({src: item.ico|default(''), type: opt.type|default(''), height: opt.height|default(''), width: opt.width|default('')}) ~ '" title="' ~ item.subname|default('') ~ '" />' %}
            {% set user_level_name = item.subname|default('') %}
        {% endfor %}
    {% endif %}

    {% if 'jjgs_name' in opt.jjr_tpl %}
        {# 经纪公司 #}
        {% set user_jjgs_data = ('db.users')|getRow({id: user_info.cid|default('')}) %}
        {# 经纪公司 #}
        {% set user_jjgs = ('db.userinfo')|getRow({uid: user_info.cid|default('')}) %}
        {# 经纪公司名称 #}
        {% set user_jjgs_name = user_jjgs.company|default(user_jjgs.cpltd|default(user_jjgs.nicename|default(user_jjgs_data.username|default('')))) %}
        {# 地址 #}
        {% set user_jjgs_address = user_jjgs.caddress|default('') %}
    {% endif %}
    {# 模板变量替换 #}
    {{opt.jjr_tpl|default('%name%')|replace({
        '%name%': user_name|default(''),
        '%id%': user.id|default(''),
        '%idcard%': idcard|default(''),
        '%license%': license|default(''),
        '%jjgs_id%': user_jjgs.uid|default(''),
        '%jjgs_name%': user_jjgs_name|default(''),
        '%jjgs_address%': user_jjgs_address|default(''),
        '%fwdj%': user_level_img|default(''),
        '%fwdj_name%': user_level_name|default(''),
        '%url%': (opt.models ~ '/' ~ opt.action)|UU({id: user_jjgs.uid|default('')})
    })|raw}}
{% elseif user_usertype|default('') == 17 %}
{# 经纪公司 #}
{% elseif user_usertype|default('') == 18 %}
{# 开发商 #}
{% endif %}
{%- endmacro publisher -%}

{#
/**
* @method publisher_list(id)
* @description 判断用户是个人还是经纪人, 列表使用
* @param {Number} o.id - 用户id
* @example 调用
* ```twig
* {{- house_global.publisher_list(item.uid|default('')) -}}
* ```
*/
 #}
{%- macro publisher_list(id) -%}
{{- _self.publisher({
    id: id,
    gr_tpl: '%name%<span class="new">(个人)</span>',
    jjr_tpl: '<a href="' ~ ('member/detail')|U({id: '%jjgs_id%'}) ~ '" target="_blank" class="ps mr5">%jjgs_name%</a><a href="' ~ ('member/j_detail')|U({id: '%id%'}) ~ '" target="_blank" class="ps c-e43"><i class="font-icons-2 mr5" style="vertical-align: -1px;"></i>%name%</a><span class="new mr10">(经纪人)</span>'
}) -}}
{%- endmacro publisher_list -%}

{#
/**
 * @method map(o)
 * @description 内页地图
 * @param {Object} o.detail - 当前数据
 * @param {Object} o.data - 楼盘数据
 * @param {String} o.title - 标题
 * @param {Object} o.arr_round - 周边筛选
 * @param {Boolean} o.round - 是否显示周边信息
 * @param {Boolean} o.panorama - 是否显示街景图切换
 * @example
 * ```twig
 * {{
 *     house_global.map({
 *         detail: ss_xiaoqu,
 *         data: detail,
 *         arr_round : [
 *             {ico: 42, name: '学校'},
 *             {ico: 43, name: '医院'},
 *             {ico: 44, name: '银行'},
 *             {ico: 45, name: '餐饮'},
 *             {ico: 46, name: '购物'},
 *             {ico: 47, name: '公交'},
 *             {ico: 49, name: '公园'},
 *             {ico: 50, name: '机场'},
 *             {ico: 51, name: '加油站'},
 *         ]
 *     })
 * }}
 * ```
 */
#}
{%- macro map(o) -%}
{% if o.detail.map|default('') %}
    <div class="big-map-wrap">
        <div class="map-wrap">
            <div class="lp-coltit clearfix">
                <h3>{{o.title|default('地图')}}</h3>
                {% if o.panorama|default('1') %}
                    <div class="map-label map-label01">
                        <ul js="clearSonAttr">
                            <li class="mLabel-li label-li active" data-map-reset="1">
                                <div class="icon-text">
                                    <span class="round">
                                        <i class="font-lp-48"></i>
                                    </span>
                                    <i search-flag="school">原点</i>
                                </div>
                            </li>
                            <li class="mLabel-li label-li">
                                <div class="icon-text" data-btn-panorama="1">
                                    <span class="round">
                                        <i class="font-lp-52 tu"></i>
                                    </span>
                                    <i class="txt">街景地图</i>
                                </div>
                            </li>
                        </ul>
                    </div>
                {% endif %}
            </div>
            {# {% set arr_round = [
                {ico: 42, name: '学校'},
                {ico: 43, name: '医院'},
                {ico: 44, name: '银行'},
                {ico: 45, name: '餐饮'},
                {ico: 46, name: '购物'},
                {ico: 47, name: '公交'},
                {ico: 49, name: '公园'},
                {ico: 50, name: '机场'},
                {ico: 51, name: '加油站'},
            ] %} #}
            {% if o.round|default('1') %}
                {% if o.arr_round|default('') %}
                <div class="map-label">
                    <ul>

                        {% for item in o.arr_round[ : 5] %}
                        <li class="mLabel-li label-li" data-map-local-search="{name: '{{item.name}}'}">
                            <div class="icon-text" >
                                <span class="round">
                                    <i class="font-lp-{{item.ico}} tu"></i>
                                </span>
                                <i class="txt">{{item.name}}</i>
                            </div>
                        </li>
                        {% endfor %}

                        <li class="mLabel-li mLabel-more" style="margin-bottom: 0px; border-bottom: 0px; border-right: 0px; background: none;">
                            更多
                            <i class="img-lp-11"></i>
                            <i class="img-lp-10"></i>

                            <ul>
                                {% for item in o.arr_round[6 : ] %}
                                    <li class="mLabel-li label-li" data-map-local-search="{name: '{{item.name}}'}">
                                        <div class="icon-text" >
                                            <span class="round">
                                                <i class="font-lp-{{item.ico}} tu"></i>
                                            </span>
                                            <i search-flag="school" class="txt">{{item.name}}</i>
                                        </div>
                                    </li>
                                {% endfor %}
                            </ul>
                        </li>
                    </ul>
                </div>
                {% endif %}

                {# 周边列表 #}
                <div class="assort-distance">
                    <i class="img-lp-9" data-close-btn="1" data-closeex="{target: '.assort-distance', showTarget: '.assort-distance-btn'}"></i>
                    <div data-map-list-title="1"></div>
                    <div id="map-list" data-map-list="1"></div>
                </div>
                <div class="assort-distance-btn"><i class="font-lp-52"></i>显示列表</div>
            {% endif %}
            {% set zoom = o.detail.map|default('')|split(',')|last %}
            <div class="show"
                data-map="{
                    redraw: false,
                    point: {
                        lng: {{o.detail.lng|default('')}},
                        lat: {{o.detail.lat|default('')}}
                    },
                    minZoom: 14,
                    zoom: {{zoom}}
                }"
                data-marker-lists="{
                        tpl:  '#tpl-14',
                        data:  [{% if o.data.data|default('') %}
                                    {% for item in o.data.data|default('') %}
                                        {% if loop.index != 1 %},{% endif %}{
                                            disableMassClear: {{item.disableMassClear|default(true)}},
                                            name: '{{item.name|default('')}}',
                                            id: '{{item.id|default('')}}',
                                            polyline: '{{item.polyline|default('')}}',
                                            dj: '{{item.dj|default('')}}',
                                            point: {
                                                lng: {{item.lng|default('')}},
                                                lat: {{item.lat|default('')}}
                                            }
                                        }
                                    {% endfor %}
                                {% else %}
                                    {
                                        disableMassClear: {{o.data.disableMassClear|default(true)}},
                                        name: '{{o.data.name|default('')}}',
                                        id: '{{o.data.id|default('')}}',
                                        polyline: '{{o.data.polyline|default('')}}',
                                        dj: '{{o.data.dj|default('')}}',
                                        point: {
                                            lng: {{o.data.lng|default('')}},
                                            lat: {{o.data.lat|default('')}}
                                        }
                                    }
                                {% endif %}]
                    }">
            </div>
            <div class="vista-wrap">
                <div data-panorama="1" class="vista"></div>
            </div>
        </div>
    </div>
    {# 标注模板 #}
    <script id="tpl-14" type="text/html">
        <div class="marker-item" data-item="<%= id %>" data-map-item="<%= id %>" data-polyline="<%= polyline %>">
            <span data-name="1" class="name"><%= name %></span>
            <span data-name-sub="1" class="name-sub"><%= dj * 1 ? dj + '元/m&sup2;' : name %></span>
            <span class="arrow"></span>
        </div>
    </script>
    <script type="text/javascript">
    seajs.use(['mapSimple'], function(mapSimple) {
        {% if o.panorama|default('1') %}
            // 没有街景实例时初始化
            mapSimple.panoInit($('[data-panorama]')[0]);
            // 街景按钮
            $('[data-btn-panorama="1"]').on('click', function() {
                // 街景外框vista-wrap
                $('.vista-wrap').show();
                mapSimple.panoAction('show');
            });
        {% endif %}
        {% if o.round|default('1') %}
            $('[data-map-reset]').on('click', function() {
                if ($('.vista-wrap').is(':visible')) {
                    $('.vista-wrap').hide();
                    mapSimple.panoAction('hide');
                }
            })
            // 周边按钮
            var $labelLi = $('.label-li');
            $labelLi.on('click', function() {
                $labelLi.removeClass('active');
                $(this).addClass('active');
                $('.assort-distance-btn').click();
            });
        {% endif %}
    });
    </script>
{% endif %}
{%- endmacro map -%}

{#
/**
 * @method sale_aside(o)
 * @description 二手房类型侧栏推送位数据
 * @param {Array} o.value - 所属数据
 * @param {string} o.con - 要显示的字段，多个字段之间使用(,)分隔如(zxcd,cate_type)
 * @param {string} o.tpl - 模板
 * @param {Object} field -
 * @example
 * ```twig
 * {{- house_global.sale_aside({value: detail, tpl:'<span>%value%</span>' con: 'zxcd,cate_type'}) -}}
 * ```
 */
 #}
{%- macro sale_aside(o) -%}
    {% import "CoreBundle:Macro:global.html.twig" as core_global %}
    {% set opt = {
        models: 'sale',
        btn: 1,
        smsconfig: ('sms_api')|C|default(''),
        user_id: app.user.id|default(''),
        tpl_tjj: 11
    }|merge(o|default({})) %}
    <!--aside-->
    <div class="side">
        {% if opt.btn == 1 %}
        <div class="s-info">
            {% if opt.models =='sale' %}
                {% if opt.smsconfig is empty or opt.user_id %}
                    <a href="{{ path('house_main') }}#/default/52" target="_blank">免费发布信息</a>
                    <div class="blank10"></div>
                    <a href="{{ path('house_main') }}#/default/57/1" target="_blank">免费委托信息</a>
                {% else %}
                    <a href="{{('release/usale')|U({models: 'sale', esflx: 194})}}" target="_blank">免费发布信息</a>
                    <div class="blank10"></div>
                    <a href="{{('release/wtbuy')|U({models: 'sale' })}}" target="_blank">免费委托信息</a>
                {% endif %}
            {% elseif  opt.models =='rent' %}
                 {% if opt.smsconfig is empty or opt.user_id %}
                    <a href="{{ path('house_main') }}#/default/53" target="_blank">免费发布信息</a>
                    <div class="blank10"></div>
                    <a href="{{ path('house_main') }}#/default/57/0" target="_blank">免费委托信息</a>
                {% else %}
                    <a href="{{('release/urent')|U({models: 'rent', czlx: 126})}}" target="_blank">免费发布信息</a>
                    <div class="blank10"></div>
                    <a href="{{('release/wthouse')|U({models: 'rent' })}}" target="_blank">免费委托信息</a>
                {% endif %}
            {% endif %}
        </div>
        {% endif %}
        <!-- 最近浏览过的房子 -->
        <div data-browser-recored="1" data-config="{models: 'sale', tpl: '#record', field: 'name,mj,zj'}">
            {# <h2 class="s-title">最近浏览过的房子</h2> #}
        </div>
        <script id="record" type="text/html">
            <h2 class="s-title">最近浏览过的房子</h2>
            <div class="s-look">
                <ul>
                <% for(var i = 0; i < data.length; i++){ %>
                    <li>
                        <i></i>
                        <a class="left" href="<%= data[i].url%>" target="_blank" title="<%= data[i].name%>"><%= data[i].name%></a>
                        <span class="middle"><%= data[i].mj%><b>m&sup2;</b></span>
                        <span class="right"><%= data[i].zj%><b>万</b></span>
                    </li>
                    <% } %>
                </ul>
            </div>
        </script>
        <script type="text/javascript">
            seajs.use(['browserRecord'], function (browserRecord){
                browserRecord.init({
                    url: '{{("viewinter/record")|U}}'
                });
            });
        </script>

        {{ core_global.ads({tag: 'esfasidegg', width: 250, height: 130, class: "mt30"}) }}

        {% if opt.tpl_tjj == 11 %}
        {# 推荐经纪人 #}
        {% set esfasidejjr_fromid = ('house.pushs')|getCol('fromid', {cate_pushs: 'esfasidejjr', checked: 1})|default(0)|join(',') %}
        {% set push_esfasidejjr = ('db.userinfo')|getAll({uid: 'in|' ~ esfasidejjr_fromid}) %}
        {% set push_esfasidejjr_tel = {} %}

        {% set push_esfasidejjr_tel_data = ('db.users')|getAll({id: 'in|' ~ esfasidejjr_fromid}) %}

        {% for item in push_esfasidejjr_tel_data.data %}
            {% set push_esfasidejjr_tel = {
                ('tel' ~ item.id): item.tel,
                ('username' ~ item.id): item.username
            }|merge(push_esfasidejjr_tel) %}
        {% endfor %}
        <h2 class="s-title">推荐经纪人</h2>
        <div class="s-agent" data-tag="esfasidejjr">
            <ul>
                {% if push_esfasidejjr.data is defined %}
                    {% for item in push_esfasidejjr.data %}
                        {% set item_user_name = item.nicename|default(push_esfasidejjr_tel['username' ~ item.uid]|default('')) %}
                        {% if item.uid|default('') %}
                            {% set item_url = ('member/j_detail')|U({id: item.uid|default('')}) %}
                        {% else %}
                            {% set item_url = 'javascript:;' %}
                        {% endif %}
                        <li class="clearfix">
                            <a href="{{item_url|default('')}}" target="_blank">
                               {{- core_global.img({
                                   src: item.image|default(''),
                                   alt: item_user_name|default(''),
                                   type: 2,
                                   width: 80,
                                   height: 100
                               }) -}}
                            </a>
                            <div class="s-a-info">
                                <h3>
                                    <a href="{{item_url|default('')}}" target="_blank">
                                        {{item_user_name|default('-')}}
                                    </a>
                                </h3>
                                <p>
                                    <i class="shou">售</i><span>&nbsp;{{item.sales|default('0')}}套</span>
                                    <i class="zu">租</i><span>&nbsp;{{item.rents|default('0')}}套</span>
                                </p>
                                <p class="phone mt5">{{push_esfasidejjr_tel['tel' ~ item.uid]|default('')}}</p>
                            </div>
                        </li>
                    {% endfor %}
                {% endif %}
            </ul>
        </div>
       {% endif %}
        <!-- 最新二手房 -->

        {% set zuixinershoufang = ('zuixinershoufang')|getPush(5) %}
        <h2 class="s-title">最新二手房</h2>
        <div class="s-new">
            <ul>
                {% if zuixinershoufang is defined %}
                    {% for item in zuixinershoufang %}
                        <li>
                            <a class="name" href="{{item.url|default('')}}" target="_blank">
                                {{- core_global.img({
                                    src: item.thumb|default(''),
                                    alt: item.name|default(''),
                                    type: 2,
                                    width: 210,
                                    height: 158
                                }) -}}
                            </a>
                            <p>
                                <a class="name" title="{{item.name|default('')}}" href="{{item.url|default('')}}" target="_blank">{{core_global.substr(item.name|default(''), 5, 1)}}</a>
                                <span class="money">{{ _self.if_wy({value: item.zj|default('')})}}</span>
                            </p>
                            <p>
                                <span class="left">
                                    {{-  _self.if_mj({value: item.mj|default('')}) -}}
                                </span>
                                <span class="right">
                                    {% if item.fromid|default('') %}
                                        {{-  _self.huxing({data: item|default(''), tpl: '%shi%%ting%%wei%'}) -}}
                                    {% endif %}
                                </span>
                            </p>
                        </li>
                    {% endfor %}
                {% endif %}
            </ul>
        </div>

        <!-- 同楼盘二手房推荐 -->
        {% if opt.tpl_sale|default('') and opt.tpl_sale.pageCount|default(0) != 0 %}
        <h2 class="s-title">同楼盘{{opt.rectitle|default('二手房')}}推荐</h2>
        <div class="s-new">
            <ul>
                {% for item in opt.tpl_sale.data %}
                    <li>
                        <a class="name" href="{{ (opt.models ~ '/detail')|U({id: item.id}) }}" target="_blank">
                            {{- core_global.img({
                                src: item.thumb|default(''),
                                alt: item.name|default(''),
                                type: 2,
                                width: 210,
                                height: 158
                            }) -}}
                        </a>
                        <p>
                            <a class="name" title="{{item.name|default('')}}" href="{{ (opt.models ~ '/detail')|U({id: item.id}) }}" target="_blank">{{core_global.substr(item.name|default(''), 5, 1)}}</a>
                            <span class="money">{{ _self.if_wy({value: item.zj|default('')})}}</span>
                        </p>
                        <p>
                            <span class="left">
                                {{-  _self.if_mj({value: item.mj|default('')}) -}}
                            </span>
                            <span class="right">
                                {% if item.fromid|default('') %}
                                    {{-  _self.huxing({data: item|default(''), tpl: '%shi%%ting%%wei%'}) -}}
                                {% endif %}
                            </span>
                        </p>
                    </li>
                {% endfor %}
            </ul>
        </div>
    {% endif %}
    </div>
    <!--/aside-->
 {%- endmacro -%}
{% macro filter_item(o) %}
    {% from "CoreBundle:Macro:global.html.twig" import h5_attr %}
    {# 默认值 #}
    {% set _opt = {
        action: '',
        rows: 4,
        select_num: 8,
        reserve: 0,
    }|merge(o|default({})) %}

    {% set filter_opt     = _opt.cate_opt %}
    {% set filter_url_opt = _opt.url_opt %}
    {% set selected       = _opt.selected %}
    {% set filter_rows    = _opt.rows %}
    {% set filter_action  = _opt.action %}
    <div class="filter-item">
    {% if _opt.reserve == 0 %}
         {# 默认列表 #}
        {% for k, vo in filter_opt[ : filter_rows] %}
            {% block filter_item_list %}
            {% if loop.first %}
        <div data-filter-item-list="1" class="filter-item-list clearfix">
            {% endif %}
            {% set children = vo.children|default('') %}
            {# 下级标记及配置，给ajax用 #}
            {% if children %}
            {% set next %}
                {{ h5_attr({
                    'data-next': {
                        name: children.name,
                        title: children.title,
                    }
                }) }}
            {% endset %}
            {% endif %}
            {% set child_select = vo.children.name|default('') ? {(vo.children.name): ''} : {} %}
            <dl class="clearfix {{k}}" {{ next|default('') }}>
                <dt>{{vo.title}}：</dt>
                <dd>
                    {% set url_opt = filter_url_opt|merge({(k): null})|merge(child_select) %}
                    <a href="{{ (filter_action)|U(url_opt) }}" data-value="" class="{% if vo.value is null %}act{% endif %} default" data-name="{{k}}">不限</a>
                    {% for vo1 in vo.data %}
                    {% set url_opt = filter_url_opt|merge({(k): vo1.value})|merge(child_select) %}
                    <a href="{{ (filter_action)|U(url_opt) }}" data-title="{{vo1.name|default('')}}" data-value="{{vo1.value}}" class="{% if vo.value == vo1.value %}act{% endif %}" data-name="{{k}}">{{vo1.name}}</a>
                    {% endfor %} {# /vo.data #}
                    {% if vo.extend is defined %}
                        {{ attribute(form, vo.extend, {0: k, 1: vo, action: filter_action}) }}
                    {% endif %}
                </dd>
            </dl>
            {% if children.data|default('')|length and app.request.get(k, 'no') != 'no' %}
            <dl class="{{children.name}} clearfix">
                <dt>{{children.title|default('')}}：</dt>
                <dd>
                    {% set url_opt = filter_url_opt|merge({(children.name): null}) %}
                    <a href="{{ (filter_action)|U(url_opt) }}" data-value="" class="{% if children.value is null%}act{% endif %} default"  data-name="{{children.name}}">不限</a>
                {% for vo2 in children.data %}
                    {% set url_opt = filter_url_opt|merge({(children.name|default('')): vo2.value|default('')}) %}
                    <a href="{{ (filter_action)|U(url_opt) }}" data-title="{{vo2.name|default('')}}" data-value="{{vo2.value}}"  class="{% if children.value == vo2.value %}act{% endif %}" data-name="{{children.name|default('')}}">{{vo2.name|default('')}}</a>
                {% endfor %}
                </dd>
            </dl>
            {% endif %}
            {% if loop.last %}
        </div>
            {% endif %}
            {% endblock filter_item_list %}
        {% endfor %}
        {# 更多 #}
        {% for k, vo in filter_opt[filter_rows : ] %}
            {% block filter_item_select %}
            {% if loop.first %}
        <div data-filter-item-select="1" class="filter-item-select clearfix">
            <ul>
                {% if _opt.reserve == 0 %}
                <li class="more-tit">
                    更多：
                </li>
                {% endif %}
            {% endif %}
                <li {% if vo.value and vo.value != 'no'%}class="active"{% endif %}>
                    <div class="more-hd hoverslider" data-obj=".more-bd"  data-delay="0">
                    {% if vo.value and vo.value != 'no' %}
                        <span class="title">{{selected[(k)].name}}</span>
                    {% else %}
                        <span class="title">{{vo.title}}</span>
                    {% endif %}<i class="font-icons-1"></i>
                    </div>
                    <div class="more-bd {{ vo.data|length > _opt.select_num ? 'more-horizontal' : '' }} {% if loop.last %}last{% endif %}">
                        {% set url_opt = filter_url_opt|merge({(k): null}) %}
                        <a href="{{ (filter_action)|U(url_opt) }}" class="{% if vo.value is null or vo.value == 'no' %}act{% endif %} default" data-title="{{vo.title}}" data-select="1" data-point data-value data-name="{{k}}">不限</a>
                        {% for vo1 in vo.data %}
                        {% set url_opt = filter_url_opt|merge({(k): vo1.value}) %}
                        <a href="{{ (filter_action)|U(url_opt) }}" {% if k == 'region' %}data-point="{{vo1.map|default('')}}"{% endif %} data-title="{{vo1.name}}" data-select="1" data-value="{{vo1.value}}" class="{% if vo.value == vo1.value %}act{% endif %}" data-name="{{k}}">{{vo1.name}}</a>
                        {% endfor %} {# /vo.data #}
                    </div>
                </li>
            {% if loop.last %}
                {% if _opt.reserve == 1 %}
                <li data-title="更多">
                    <div class="more-hd hoverslider" data-obj="[data-filter-item-list]" data-global-obj="1" data-delay="0">
                        <span class="title">更多<span data-more-num="1"></span></span>
                        <i class="font-icons-1"></i>
                    </div>
                </li>
                <li data-title="全部取消" class="cancel" data-clear="all">
                    <i class="font-map-f5"></i>全部取消
                </li>
                {% endif %}
            </ul>
        </div>
            {% endif %}
            {% endblock filter_item_select %}
        {% endfor %}
        {# /默认列表 #}
    {% else %}
        {# 反转列表 地图用 #}
        {% for k, vo in filter_opt[ : filter_rows] %}
            {{ block('filter_item_select') }}
        {% endfor %}
        {% for k, vo in filter_opt[filter_rows : ] %}
            {{ block('filter_item_list') }}
        {% endfor %}
        {# /反转列表 #}
    {% endif %}
    </div>
{% endmacro filter_item %}

{%- macro filter_cfg(opt) -%}
    {% import "CoreBundle:Macro:global.html.twig" as core_global %}
    {# 默认值 #}
    {% set _opt = {
        tag: '',
        action: '',
        rows: 4,
        cate_opt: [],
        search: {},
        url_opt: {},
        cate_data: {},
        head_data: [],
        selected: {},
        show_selected: 0,
        class: 'container',
    }|merge(opt|default({})) %}

    {% set filter_url_opt = _opt.url_opt %}
    {% set selected       = _opt.selected %}
    {% set filter_action  = _opt.action %}
    {% set filter_hd      = _opt.head_data %}
    {% set filter_search  = _opt.search %}

    <div class="{{_opt.class}}">
        {# 筛选头部 #}
        {% if filter_hd %}
        <div class="head-search">
           <div class="h-s-btns">
            {% for k, vo in filter_hd|default('') %}
               <a class="btn1 btn1-{{loop.index}}" href="{{vo.url|default('')}}" {% if vo.target|default('') %}target="{{vo.target|default('')}}"{% endif %}><i class="fz16 {{vo.icons|default('')}}"></i>
                {% if vo.url|default('') == filter_action|U %}
                <i class="tri"></i>
                {% endif %}
                {{vo.title|default('')}}</a>
            {% endfor %}
           </div>
           {% if filter_search %}
           {{core_global.search(filter_search)}}
           {% endif %}
        </div>
        {% endif %}
        {# 没有数据就不显示列表 #}
        {% if _opt.cate_opt %}
        {# 列表 #}
        <div class="filter-wrap">
            <!--body-->
            <div class="filter-bd">
                <!--筛选条件-->
                {{ _self.filter_item(_opt) }}
                <!--/筛选条件-->
                <!--cur-->
                {# {% if selected|length %} #}
                {% if _opt.show_selected %}
                <div data-filter-show="1" class="filter-cur clearfix" style="display:{% if selected|length %}block {% else %}none{% endif %}">
                    <span class="tip">当前条件：</span>
                    <div class="filters">
                        {% for k, v in selected %}
                        {% set url_opt = filter_url_opt|merge({(k): null}) %}
                            <a href="{{ (filter_action)|U(url_opt) }}" data-clear="{{k}}" title="{{ v.name }}">
                                <span>{{ v.name }}</span>
                                <i class="font-filter-7"></i>
                            </a>
                        {% endfor %}
                    </div>
                    <a href="{{ (filter_action)|U }}" data-clear="all" title="取消所有" class="cancal-cur">
                        <i class="font-filter-8"></i>
                        <span>取消所有</span>
                    </a>
                </div>
                {% endif %}

                <!--/cur-->
            </div>
            <!--/body-->
        </div>
        {% endif %}
    </div>
{%- endmacro filter_cfg -%}
{#
/**
 * @method filter_cfg2(o)
 * @description 首页筛选条件模板
 * @param {String} o.action - 跳转链接
 * @param {Number} o.rows=4 - 显示数量
 * @param {String} o.exclass - 样式
 * @param {Array} o.head_data - 头部导航数据
 * @param {Array} o.search - 搜索配置(参考`search`方法)
 * @param {Boolean} o.tag - 小分页
 * @example
 * ```twig
 * {{- house_global.fy_title({
 *      data: data
 * }) -}}
 * ```
 */
 #}
{% macro filter_cfg2(opt) %}
    {% set cate_data = _self.cate_data({ tag: opt.tag|default('sale') }).__toString|json_decode %}

    {# 默认值 #}
    {% set _opt = {
        action: '',
        rows: 4,
        exclass: '',
        head_data: [],
        search: { },
    }|merge(cate_data)|merge(opt|default({})) %}

    {% set filter_action  = _opt.action %}
    {% set filter_opt  = _opt.cate_opt %}

    <div class="filter-wrap {{_opt.exclass}}" >
        <div class="filter"  data-hover="hoverslider" data-direction="right" data-offsetx="200" data-obj=".filter-more">
            {% for k, v in filter_opt %}
                <dl>
                    <dt>
                        <h4>
                            {{v.title|default('')}}
                            <span class="fr arrow">></span>
                        </h4>
                    </dt>
                    <dd>
                        {% if v.data is defined %}
                            {% for k1, v1 in v.data %}
                                <a href="{{(filter_action|default(''))|U({(k): v1.value|default('')})}}" target="_blank">
                                    {{v1.name|default('')}}
                                </a>
                            {% endfor %}
                        {% endif %}
                    </dd>
                </dl>
            {% endfor %}
        </div>
        <div class="filter-more">
            {% for k, v in filter_opt %}
                <dl>
                    <dt>
                        <h4>
                            所有{{v.title|default('')}}
                        </h4>
                    </dt>
                    <dd>
                        {% if v.data is defined %}
                            {% for k1, v1 in v.data %}
                                <a href="{{(filter_action|default(''))|U({(k): v1.value|default('')})}}" target="_blank">
                                    {{v1.name|default('')}}
                                </a>
                            {% endfor %}
                        {% endif %}
                    </dd>
                </dl>
            {% endfor %}
        </div>
    </div>
{% endmacro filter_cfg2 %}
{#
/**
 * @method fy_title(o)
 * @description 列表头部（出租、二手）
 * @param {String} o.class - 样式
 * @param {String} o.act=act - 高亮样式
 * @param {Array} o.data - 数据
 * @param {String} o.attr - 其他属性
 * @param {String} o.is_act - 当前高亮条件
 * @param {Boolean} o.small_page - 小分页
 * @example
 * ```twig
 * {{- house_global.fy_title({
 *      data: data
 * }) -}}
 * ```
 */
 #}
{%- macro fy_title(o) -%}
    {% from "CoreBundle:Macro:global.html.twig" import h5_attr %}
    {% spaceless %}
        {% set opt = {
            class: 't-h-l',
            act: 'act',
            data: {},
            attr: '',
            is_act: '',
            small_page: 1
        }|merge(o) %}
        <p class="{{opt.class}}">
            {% for item in opt.data %}
                <a href="{{item.url|default('')}}" {{ h5_attr(opt.attr|default('')) }} {{ h5_attr(item.attr|default('')) }} class="{% if opt.is_act == item.act|default(null) %}{{opt.act}}{% endif %} {{ item.class|default('') }}">
                   <i></i><span>{{item.name|default('')}}</span>
                </a>
            {% endfor %}
        </p>
        {# 小分页 #}
        {% if opt.small_page %}
        <div data-minpage='1' class="t-h-r"> </div>
        <script type="text/javascript">
         seajs.use(['listPjax'],function(listPjax){
            listPjax.page();
         })
        </script>
        {% endif %}
    {% endspaceless %}
{%- endmacro -%}
{# 对比 #}
{#
/**
 * @method compare_tpl(o)
 * @description 对比模板
 * @param {String} o.title - 标题
 * @param {Number} o.chid=2 - 对比分类  2: 出租，3: 出售，4: 新房
 * @example
 * ```twig
 * {{- house_global.compare_tpl({
 *      chid: 2,
 *      title: '出租'
 * }) -}}
 * ```
 */
 #}
{%- macro compare_tpl(o) -%}
    <script id="compBox" type="text/html">
        <div id="comp_box">
            <form action="" method="get" target="_blank">
                <div id="comp_top">
                    <a class="close font-icons-28" href="javascript:;" data-role="hidden"></a>
                    <div class="top_l">[<b id="comp_num">0</b>/5]<%= data.otit%>对比</div>
                </div>
                <ul id="comp_items"></ul>
                <div id="comp_boot">
                    <input type="submit" class="prosubmit" value="{{o.title|default('楼盘对比')}}">
                    <a class="clear" data-role="clear-all" href="javascript:;">
                        <i class="font-icons-29 fz16 mr5"></i>清空
                    </a>
                    <input id="subid_obj" name="subcatid" type="hidden" value="4">
                </div>
            </form>
        </div>
    </script>

    <script id="compItem" type="text/html">
        <li id="<%= data.id%>">
            <a class="icon font-icons-28" data-role="clear-one" data-id="<%= data.pro_id%>" href="javascript:;"></a>
            <p class="title">
                <a href="<%= data.pro_link%>" title="<%= data.pro_title %>" target="_blank"><%= data.pro_title %></a>
            </p>
              <input type="hidden" name="pro_id[]" value="<%= data.pro_id%>">
        </li>
    </script>

    <script id="btnShow" type="text/html">
        <a class="btnshow" data-role="show"><i class="font-icons-35"></i></a>
    </script>

    <script type="text/javascript">
         // 对比配置
         var comp_boxMXY = [1,0,300];
         var chid = '{{o.chid|default(2)}}';
         var comp_action= '{{("houses/contrast")|U({fid: 8})}}' + '&chid=' + chid + '#/';
         seajs.use(['contrast'], function (contrast) {
             contrast.onload();
         })
    </script>
{%- endmacro compare_tpl -%}
{#
/**
 * @method compare_btn(o)
 * @description 对比按钮
 * @param {String} o.target=label - 标签
 * @param {String} o.class - 样式
 * @param {String} o.tpl - 模板
 * @param {String} o.title - 标题
 * @param {Number} o.id - id
 * @param {Number} o.url - 链接
 * @example
 * ```twig
 * {{- house_global.compare_btn({
 *      id: item.id,
 *      title: item.name,
 *      url: ('rent/detail')|U({id: item.id})
 * }) -}}
 * ```
 */
 #}
{%- macro compare_btn(o) -%}
    {% set opt = {
        target: 'label',
        class: 'compare ico-word',
        tpl: '<i class="font-lp-8"></i>对比',
    }|merge(o) %}
    <{{opt.target}} class="compare ico-word" {{opt.attr|default('')|raw}} for="pro_{{o.id|default('')}}">
        <input type="checkbox" data-contrast="1" data-contrast-cfg="{obj: this, pro_name:'{{opt.title|default("")}}', pro_link: '{{opt.url|default("")}}', pro_id: '{{opt.id|default("")}}'}" value="" name="" id="pro_{{opt.id|default('')}}">
        {{opt.tpl|raw}}
    </{{opt.target}}>
{%- endmacro compare_btn -%}

{# 列表弹窗 #}
{#
/**
 * @method modal_btn(o)
 * @description 弹窗按钮
 * @param {String} o.target=label - 标签
 * @param {String} o.class - 样式
 * @param {String} o.tpl - 模板
 * @param {String} o.title - 标题
 * @param {Number} o.id - id
 * @param {Number} o.url - 链接
 * @example
 * ```twig
 * {{- house_global.modal_btn({
 *      id: 'yx',
 *      title: '我有意向',
 *      opt: '{aid: ' ~ item.id ~ '}'
 * }) -}}
 * ```
 */
 #}
{%- macro modal_btn(o) -%}
    {% set opt = {
        title: '',
        id: '',
        class: '',
        icon: ''
    }|merge(o) %}
    <a href="#{{opt.id|default('')}}" data-opt="{{opt.opt|default('')}}" class="{{opt.class|default('')}} btn-jqModal-ex" {{opt.attr|default('')|raw}}>
        {% if opt.icon|default('') %}<i class="{{opt.icon}}"></i>{% endif %}{{opt.title|default('')|trans({})}}
    </a>
{%- endmacro modal_btn -%}
{#
/**
 * @method modal_layout(o)
 * @description 列表弹窗
 * @param {String} o.btn - 点击按钮
 * @param {Number} o.id - 获取id
 * @param {String} o.name - 名称
 * @param {Number} o.width - 弹窗宽度
 * @param {String} o.ajax - 表单请求
 * @param {Number} o.fields - 更新字段
 * @param {String} o.type - 加载方式/默认点击
 * @example
 * ```twig
 * {{- house_global.modal_btn({
 *      id: 'yx',
 *      title: '我有意向',
 *      opt: '{aid: ' ~ item.id ~ '}'
 * }) -}}
 * ```
 */
 #}
{%- macro modal_layout(o) -%}
    {% set opt = {
        btn: '',
        id: '',
        name: '',
        width: 450,
        ajax: '',
        icon: '',
        title: '',
        class: '',
        attr: '',
        type: 'click'
    }|merge(o) %}
    {# 替换值使用 #}
    {% if opt.fields|default('') %}
        <script type="text/javascript">
            seajs.use(['jqmodal', 'utils'], function(jqmodal, utils) {
                $('{{opt.btn|default("")}}').off('shown').on('shown', function(){
                    var $btn = $(this);
                    var config = utils.parseJSON($btn.data('opt'));
                    var $modal = $('#{{opt.id|default("")}}');
                    {% for item in opt.fields %}
                        $modal.find('#{{item}}').val(config['{{item}}']);
                    {% endfor %}
                    $modal.data('jqModal').$hd.find('span').html('{{opt.name|default('')|trans({})}}(' + config.name + ')');
                });
            })
        </script>
    {% endif %}

    <div {% if opt.type != 'load' %}id="{{opt.id|default("")}}" style="display: none;"{% endif %} class="{{opt.class}}" {{opt.attr|raw}} data-form-config="{
        modal: {
            head: '<i class=\'{{opt.icon}} mr5 fz18 c-e43\'></i><span class=\'jqmodal-title\'>{{opt.title}}</span>',
            css: {
                width: {{opt.width}}
            }
        },
        type: '{{opt.type}}',
        {{opt.ajax|raw}}
    }">
    </div>
{%- endmacro modal_layout -%}

{# 前台发布按钮 #}
{#
/**
 * @method release_nav(o)
 * @description 前台发布导航
 * @param {String} o.action - 当前链接
 * @example
 * ```twig
 * {{- house_global.release_nav({action: action}) -}}
 * ```
 */
 #}
{%- macro release_nav(o) -%}
    {% import "CoreBundle:Macro:global.html.twig" as core_global %}
    {% spaceless %}
        {{core_global.linkcss('bundles/house/css/relform.css')}}
        {% set release_nav = [
            {
                models: 'usale',
                url: ('release/usale')|U({models:'sale', esflx: 94}),
                name: '发布二手'
            },
            {
                models: 'urent',
                url: ('release/urent')|U({models:'rent', czlx: 126}),
                name: '发布出租'
            },
            {
                models: 'usdemand',
                url: ('release/usdemand')|U({models:'demand'}),
                name: '发布求购'
            },
            {
                models: 'urdemand',
                url: ('release/urdemand')|U({models:'demand'}),
                name: '发布求租'
            },
            {
                models: 'uoffice',
                url: ('release/uoffice')|U({models:'sale', esflx: 121}),
                name: '二手写字楼'
            },
            {
                models: 'ushops',
                url: ('release/ushops')|U({models:'sale', esflx: 122}),
                name: '二手商铺'
            },
            {
                models: 'uroffice',
                url: ('release/uroffice')|U({models:'rent', czlx: 129}),
                name: '出租写字楼'
            },
            {
                models: 'urshops',
                url: ('release/urshops')|U({models:'rent', czlx: 130}),
                name: '出租商铺'
            },
            {
                models: 'wthouse',
                url: ('release/wthouse')|U({models:'rent', mid: app.request.get('mid')|default()}),
                name: '委托出租'
            },
            {
                models: 'wtbuy',
                url: ('release/wtbuy')|U({models:'sale', mid: app.request.get('mid')|default()}),
                name: '委托出售'
            }
        ] %}
        <div class="fmtype">
            {% for item in release_nav %}
                <a href="{{item.url}}" {% if o.action == item.models %}class="on"{% endif %}>
                    {{item.name}}<i></i>
                </a>
            {% endfor %}
        </div>
    {% endspaceless %}
{%- endmacro -%}

{# 出租、二手详情模块 #}
{#
/**
 * @method sale_rent_btn_info(o)
 * @description 出租、二手详情按钮模块
 * @param {String} o.models - 所属模型
 * @param {Number} o.id - 当前数据id
 * @param {String} o.name - 当前数据标题
 * @param {String} o.thumb - 当前数据缩略图
 * @param {String} o.controller - 链接
 * @example
 * ```twig
 * {{- house_global.sale_rent_btn_info({
 *      id: detail.id|default(''),
 *      models: 'sale'
 * }) -}}
 * ```
 */
 #}
{%- macro sale_rent_btn_info(o) -%}
    {% set opt = {
        models: '',
        id: 0,
        name: '',
        thumb: '',
        controller: ''
    }|merge(o) %}
    {% import "CoreBundle:Macro:global.html.twig" as core_global %}
    {% spaceless %}
        <div class="info3">
            {{_self.modal_btn({
                id: 'yy',
                class: 'btn form-bdrs btn-yy',
                title: '预约看房',
                icon: 'font-icons-18',
            })}}
            {# 预约modal #}
            {{_self.modal_layout({
                id: 'yy',
                title: '预约看房',
                ajax: "ajax: {
                    data : {
                        formflag: 'view_sale_intent',
                        aid: " ~ opt.id ~ ",
                        models: '" ~ opt.models ~ "',
                        cate_pushs: 'syixiang',
                        type: 'sale',
                        formcls: 'common-form-lg common-form-control'
                    }
                }"
            })}}
            {# 收藏按钮 #}
            {{core_global.collect_btn({
                aid: opt.id,
                models: "" ~ detail.models|default(opt.models|default('sale')) ~ "",
                class: 'btn',
                text: '收藏房源'
            })}}
            <a class="btn btn-jqModal" href="#sjkf">
                <i class="font-icons-9"></i>
                手机看房
            </a>
            {# 举报按钮 #}
            {{_self.modal_btn({
                id: 'jbao',
                class: 'btn form-bdrs btn-jb',
                title: '举报房源',
                icon: 'font-icons-27',
            })}}
            {# 举报modal #}
            {{_self.modal_layout({
                id: 'jbao',
                title: '举报房源',
                ajax: "ajax: {
                    data : {
                        formflag: 'view_sale_report',
                        aid: " ~ opt.id ~ ",
                        models: '" ~ opt.models ~ "',
                        cate_pushs: 'sreport',
                        type: 'sale',
                        formcls: 'common-form-lg common-form-control'
                    }
                }"
            })}}
            <span class="bdsharebuttonbox btn share-btn" share-text="{{opt.name}}"
                         share-desc="{{opt.name}}"
                         share-pic="{{core_global.img_url({src: opt.thumb, type: 0, absolute:1 })}}"
                         share-url="{{(opt.controller|default(opt.models ~ '/detail'))|U({id: opt.id|default('')}, true)}}">
                <a class="bds_more" data-cmd="more">
                    <i class="font-icons-32"></i>分享
                </a>
            </span>
            {# 手机看房 #}
            <div id="sjkf" data-animate="null" style="display: none;">
                <div data-qrcode="1" data-logo="{{core_global.img_url({src: core_global.mconfig({name: 'qrcodelogo', ename: 'mvariables_user'})})}}" data-text="{{(opt.controller|default(opt.models ~ '/detail'))|U({id: opt.id}, true)}}" data-size="200"></div>
            </div>
        </div>
        {# 收藏 #}
        <script type="text/javascript">
            seajs.use(['share'], function (share) {})
        </script>
    {% endspaceless %}
{%- endmacro sale_rent_btn_info -%}

{# 二手、出租幻灯片 #}
{#
/**
 * @method sale_rent_hdp(o)
 * @description 二手、出租幻灯片
 * @param {String} o.data - 幻灯片数据
 * @example
 * ```twig
 * {{- house_global.sale_rent_hdp({
 *      data: detail.tujis|default({}),
 * }) -}}
 * ```
 */
 #}
{%- macro sale_rent_hdp(o) -%}
    {% import "CoreBundle:Macro:global.html.twig" as core_global %}
    {% spaceless %}
        <div class="preview fl jqDuang" data-obj=".item" data-cell=".s-item ul" data-prevbtn=".b-left" data-nextbtn=".b-right" data-autoplay="0" data-lazyload="src">
            <div class="preview-big">
                {% if o.data|default('') %}
                    {% for item in o.data %}
                        <div class="item" {% if loop.index != 1 %}style="display: none;"{% endif %}>
                            <a href="javascript:;">
                                {{- core_global.data_src_img({
                                    src: item.href|default(''),
                                    alt: item.desc|default(''),
                                    width: 500,
                                    height: 370,
                                    type: 0,
                                    loopindex: loop.index,
                                    watermark: 'giffun'
                                }) -}}
                            </a>
                        </div>
                    {% endfor %}
                {% else %}
                    <div class="item">
                        <a href="javascript:;">
                            {{- core_global.data_src_img({
                                src: '',
                                alt: '暂无图片',
                                width: 500,
                                height: 370,
                                type: 0
                            }) -}}
                        </a>
                    </div>
                {% endif %}
            </div>
            <div class="preview-s jqDuang" data-obj="li" data-prevbtn=".s-left" data-nextbtn=".s-right" data-autoplay="0" data-visible="5" data-steps="5" data-effect="left">
                <div class="s-left"> <i class="font-icons-11"></i>
                </div>
                <div class="s-item">
                    <ul>
                        {% if o.data|default('') %}
                            {% for item in o.data %}
                                <li>
                                    {{- core_global.img({
                                        src: item.href|default(''),
                                        alt: item.desc|default(''),
                                        width: 78,
                                        height: 56,
                                        type: 2
                                    }) -}}
                                </li>
                            {% endfor %}
                        {% else %}
                            <li>
                                {{- core_global.img({
                                    src: '',
                                    alt: '暂无图片',
                                    width: 78,
                                    height: 56,
                                    type: 2
                                }) -}}
                            </li>
                        {% endif %}
                    </ul>
                </div>
                <div class="s-right"><i class="font-icons-12"></i>
                </div>
            </div>
            <div class="b-left">
                <i class="font-icons-11"></i>
            </div>
            <div class="b-right">
                <i class="font-icons-12"></i>
            </div>
        </div>
        <script type="text/javascript">
            seajs.use(['jqduang'], function (jqduang) {})
        </script>
    {% endspaceless %}
{%- endmacro -%}
{# 二手、出租头部 #}
{#
/**
 * @method sale_rent_header(o)
 * @description 二手、出租头部
 * @param {String} o.data - 幻灯片数据
 * @example
 * ```twig
 * {{- house_global.sale_rent_header(detail|default({})) -}}
 * ```
 */
 #}
{%- macro sale_rent_header(o) -%}
    {% set opt = {
        controller: '',
        models: '',
        id: 0,
        uid: 0,
        name: '',
        lpmc: '',
        update_time: ''
    }|merge(o) %}
    {% import "CoreBundle:Macro:global.html.twig" as core_global %}
    {# 发布人信息 #}
    {% set user = ('db.users')|getRow({id: opt.uid|default(''), checked: 1, findType: 1}) %}

    {% set user_info = ('db.userinfo')|getRow({uid: opt.uid|default(''), findType: 1}) %}

    {% set user_name = user_info.nicename|default(user.username|default('')) %}

    {% spaceless %}
        <div class="tit-wrap clearfix">
            {# 当前二手房的手机地址二维码 #}
            <div class="phone-weixin" >
              <div id="ewm" data-qrcode="1" data-text="{{(opt.controller|default(opt.models ~ '/detail'))|U({id: opt.id}, true)}}" data-size="76"></div>
              <em>用手机看</em>
            </div>
              {# 经纪人的微信二维码 #}
            {% if user_info.usertype|default('') == 15 %}
                {% if user_info.weixin|default('') %}
                <div class="people-weixin">
                    {{core_global.img({
                        src: user_info.weixin,
                        type: 2,
                        width: 76,
                        height: 76
                    })}}
                    <em>经纪人微信</em>
                </div>
                {% endif %}
                <div class="people-info fr">
                    <a href="{{('member/j_detail')|U({id: user.id|default('')})}}" target="_blank" class="people-img">
                        {{core_global.img({
                            src: user_info.image|default(''),
                            alt: user_name|default(''),
                            type: 2,
                            width: 66,
                            height: 85
                        })}}
                    </a>
                    {{- _self.publisher({
                        id: user.id|default(''),
                        jjr_tpl: '
                            <p class="mt5">
                                经纪人:
                                <a href="'~ ('member/j_detail')|U({id:  user.id|default('')}) ~'" target="_blank" class="c-888">
                                    %name%
                                </a>
                            </p>
                            <p>
                                <a href="'~ ('member/j_detail')|U({id:  user.id|default('')}) ~'" target="_blank" class="c-888">进入他的店铺&gt;</a>
                            </p>
                            <p class="mt5">
                                %idcard%
                                %license%
                            </p>'
                    }) -}}
                </div>
            {% endif %}

            <h1>
                {% if opt.lpmc %}【{{opt.lpmc}}】{% endif %}{{opt.name|default('')}}
            </h1>
            <div class="olorg clearfix">
                <div class="fl c-888">
                    更新时间:
                    <span>{{core_global.time_date({time: opt.update_time})}}</span>
                </div>
                <div class="fl c-888 ml30">
                    点击: <i data-counts="{models: '{{opt.models}}', field: 'clicks', id: '{{opt.id}}'}"></i>次
                </div>
                <div class="fl c-888 ml30"></div>
            </div>
        </div>
    {% endspaceless %}
{%- endmacro -%}

{# 二手、出租所属小区 #}
{#
/**
 * @method sale_rent_xiaoqu(o)
 * @description 二手、出租所属小区
 * @param {String} o.aid - 小区id
 * @example
 * ```twig
 * {{- house_global.sale_rent_xiaoqu({aid: detail.aid|default(0)}) -}}
 * ```
 */
 #}
{%- macro sale_rent_xiaoqu(o) -%}
    {% set opt = {
        aid: 0,
    }|merge(o) %}
    {% import "CoreBundle:Macro:global.html.twig" as core_global %}
    {# 小区数据 #}
    {% set detail_houses = ('house.houses')|getRow({id: opt.aid|default(''), checked: 1, findType: 1}) %}

    {% spaceless %}
    {# 小区相册 #}
        {% if detail_houses|default('') %}
            {% set detail_houses_ablum = ('house.inter_album')|getAll({checked: 1, aid: detail_houses.id|default(''), findType: 1, groupBy: 'cate_album', order: 'cate_album', orderBy: 'asc'}) %}
            <div class="panel" id="ssxq">
                <!--title-->
                <div class="panel-hd">
                    <h2>小区信息</h2>
                </div>
                <!--/title-->
                <!--body-->
                <div class="panel-bd bd-gray">
                    {% if detail_houses_ablum.data is defined and detail_houses_ablum.pageCount|default(0) != 0 %}
                        <ul class="unity_pics clearfix">
                            {% for item in detail_houses_ablum.data %}
                                {% set item_count = core_global.count({
                                    models: 'inter_album',
                                    sql_opt: {
                                        checked: 1,
                                        cate_album: item.cate_album|default(''),
                                        aid: item.aid|default('')
                                    }
                                }).__toString %}

                                {% if item_count|default('') > 0 %}
                                <li>
                                    <a target="_blank" href="{{('sale/qdphotos')|U({id: detail_houses.id|default('')})}}">
                                        <div class="unity_pic">
                                            {{- core_global.img({
                                                src: item.thumb|default(''),
                                                alt: item.name|default(''),
                                                type: 2,
                                                width: 76,
                                                height: 49
                                            }) -}}
                                        </div>
                                        <div class="unity_txt">
                                            <h3>
                                                {{- core_global.formField({value: item.cate_album|default(''), form: 'houses_album', field:'cate_album'}) -}}
                                            </h3>
                                            <p>
                                                {{- item_count|default('') -}}张
                                            </p>
                                        </div>
                                    </a>
                                </li>
                                {% endif %}
                            {% endfor %}
                        </ul>
                    {% endif %}
                    <ul class="unity_data clearfix">
                        <li>
                            <b>小区名称: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</b>
                            <a target="_blank" href="{{('sale/qdetail')|U({id: detail_houses.id|default('')})}}">
                                <span class="Cf50">{{detail_houses.name|default('-')}}</span>
                            </a>
                        </li>

                        <li>
                            <b>所属区域: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</b>
                            {{core_global.region({id: detail_houses.region|default(''), tpl: '<span>%value%</span>'})}}
                        </li>

                        <li>
                            <b>小区地址: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</b>
                            <span>
                                 {{core_global.address({data:detail_houses|default('更新中')})}}
                            </span>
                        </li>

                        <li>
                            <b>开发商: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</b>
                            <span>{{detail_houses.house_developer|default('-')}}</span>
                        </li>

                        <li>
                            <b>物业公司: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</b>
                            <span>{{detail_houses.wygs|default('-')}}</span>
                        </li>

                        <li>
                            <b>建筑面积: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</b>
                            {{_self.if_mj({value: detail_houses.jzmj|default('')})}}
                        </li>

                        <li>
                            <b>竣工日期: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</b>
                            <span>{{detail_houses.jgdate|default('')}}</span>
                        </li>

                        <li>
                            <b>绿化率: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</b>
                            <span>{{detail_houses.lhl|default('-')}}</span>
                        </li>

                    </ul>
                </div>
                <!--/body-->
            </div>
        {% endif %}
    {% endspaceless %}
{%- endmacro -%}

{# 二手、出租内容导航 #}
{#
/**
 * @method sale_rent_daohang(o)
 * @description 二手、出租内容导航
 * @param {String} o.aid - 小区id
 * @example
 * ```twig
 * {{- house_global.sale_rent_daohang({aid: detail.aid|default(0)}) -}}
 * ```
 */
 #}
{%- macro sale_rent_daohang(o) -%}
    {% spaceless %}
        <div class="panel-hd">
            <div class="fy-fixed jqScrollspy clearfix" data-offset="25" >
                {% if o.data|default({}) %}
                    {% for k,v in o.data|default({}) %}
                        <a href="#{{k|default('')}}" {% if loop.index == 1 %}class="act"{% endif %}>{{v|default('')}}</a>
                    {% endfor %}
                {% endif %}
                <div class="fixed-lxfs hideTel">
                    <em>电话联系TA</em>
                    {{o.name|default('')}}：<span>{{o.tel|default('')}}</span>
                </div>
            </div>
        </div>
        <script type="text/javascript">
            seajs.use(['jqscrollspy', 'fixed'], function (jqscrollspy, fixed) {
                var $fylxfs = $('.fixed-lxfs');
                $(".fy-fixed").scrollToFixed({
                    marginTop: 50,
                    fixed: function () {
                        $fylxfs.show();
                    },
                    preUnfixed: function () {
                        $fylxfs.hide();
                    }
                });
            })
        </script>
    {% endspaceless %}
{%- endmacro -%}

{#
/**
 * @method prices_info(o)
 * @description 价格走势图
 * @param {String} o.aid - 楼盘id
 * @param {String} o.order - 数据排列顺序
 * @param {Number} o.pageSize - 总数
 * @param {Boolean} o.table - 显示详细列表
 * @param {Boolean} o.chart - 显示图表
 * @param {String} o.name - 名称
 * @param {Array} o.sql_opt - 其他筛选条件
 * @example
 * ```twig
 * {{- house_global.prices_info({aid: detail.id|default(0), chart: 1}) -}}
 * ```
 */
 #}
{%- macro prices_info(o) -%}
    {% set opt = {
        aid: 0,
        order: 'jtime|desc',
        pageSize: 100,
        table: 0,
        chart: 0,
        sql_opt: {},
        name: ''
    }|merge(o) %}
    {% spaceless %}
        {% if opt.data|default('') %}
            {% set prices = opt.data %}
        {% else %}
            {% set prices = ('house.houses_price')|getAll( {aid: opt.aid, checked: 1, order: opt.order, pageSize: opt.pageSize}|merge(opt.sql_opt) ) %}
        {% endif %}
        {% if opt.chart %}
            {% if prices.data is defined and prices.pageCount|default(0) != 0 %}
                <div id="zst"></div>
                <script type="text/javascript">
                    {# 走势图 #}
                    {# 横坐标 #}
                    var zstMouth = [{% if prices.data is defined %}
                        {% for item in prices.data %}
                            {% if loop.index <= 10 %}
                            "{{item.jtime.date|default('')|date('m/d')}}",
                            {% endif %}
                        {% endfor %}
                    {% endif %}];
                    {# 数据 #}
                    var dzstDta = [{% if prices.data is defined %}
                        {% for item in prices.data %}
                            {% if loop.index <= 10 %}
                            ["{{item.jtime.date|default('')|date('Y-m-d')}}", {{item.dj|default('')}}],
                            {% endif %}
                        {% endfor %}
                    {% endif %}];
                    var jsonData = {
                        "title": "",
                        "series": [{
                            "name": "{{opt.name}}",
                            "datatype": "house",
                            "data": dzstDta.reverse()
                        }],
                        "color": ["#ee4433", "#F8CE5D", "#339966"],
                        "month_s": zstMouth.reverse()
                    };
                    seajs.use(['zst'], function (zst) {})
                </script>
            {% else %}
                <div class="noinfo">
                    暂无数据
                </div>
            {% endif %}
        {% endif %}
        {% if opt.table %}
            <div class="lsjg">
                <div class="lp-coltit">
                    <h3 class="tit1">
                        历史价格
                    </h3>
                </div>
                <div class="lp-con1 lp-lsjg fz12">
                    <table cellpadding="0" cellspacing="0" border='0' width="100%">
                        <tbody>
                            <tr bgcolor="#eeeeee">
                                <td width="70" class="lsjg_td lsjg_bor">{{'记录时间'|trans({})}}<i class="font-icons-23"></i></td>
                                <td width="100" class="lsjg_td lsjg_bor">{{'均价'|trans({})}}<i class="font-lp-18"></i></td>
                                <td width="100" class="lsjg_td lsjg_bor">{{'最低价'|trans({})}}<i class="font-lp-19"></i></td>
                                <td width="100" class="lsjg_td lsjg_bor">{{'最高价'|trans({})}}<i class="font-lp-17"></i></td>
                                <td align="center" class="lsjg_td lsjg_bor1">{{'价格说明'|trans({})}}<i class="font-lp-20"></i></td>
                            </tr>
                        </tbody>
                        {% if prices.data is defined %}
                            {% for item in prices.data %}
                                {% if loop.index < 10 %}
                                    <tr {% if loop.index % 2 == 0 %}style="background:#fafafa;"{% endif %}>
                                        <td class=" lsjg_bor">{{item.jtime.date|default('-')|date('Y-m-d')}}</td>
                                        <td class=" lsjg_bor">{{item.dj|default('-')}}{{'元'|trans({})}}/{{'平方米'|trans({})}}</td>
                                        <td class=" lsjg_bor">{{item.jdjj|default('-')}}{{'元'|trans({})}}/{{'平方米'|trans({})}}</td>
                                        <td class=" lsjg_bor">{{item.jgjj|default('-')}}{{'元'|trans({})}}/{{'平方米'|trans({})}}</td>
                                        <td class=" lsjg_bor1">
                                            <div style="width:380px;float:right">
                                                {{item.bdsm|default('-')}}
                                            </div>
                                        </td>
                                    </tr>
                                {% endif %}
                                {% if loop.index >= 10 %}
                                    {% if loop.index == 10 %}
                                    <tbody style="display: none;" class="lp-lsjg-tbody">
                                    {% endif %}
                                        <tr {% if loop.index % 2 == 0 %}style="background:#fafafa;"{% endif %}>
                                            <td class=" lsjg_bor">{{item.jtime.date|default('-')|date('Y-m-d')}}</td>
                                            <td class=" lsjg_bor">{{item.dj|default('-')}}{{'元'|trans({})}}/{{'平方米'|trans({})}}</td>
                                            <td class=" lsjg_bor">{{item.jdjj|default('-')}}{{'元'|trans({})}}/{{'平方米'|trans({})}}</td>
                                            <td class=" lsjg_bor">{{item.jgjj|default('-')}}{{'元'|trans({})}}/{{'平方米'|trans({})}}</td>
                                            <td class=" lsjg_bor1">
                                                <div style="width:380px;float:right">
                                                    {{item.bdsm|default('-')}}
                                                </div>
                                            </td>
                                        </tr>
                                    {% if loop.last %}
                                    </tbody>
                                    {% endif %}
                                {% endif %}
                            {% endfor %}
                        {% endif %}
                    </table>
                </div>
                {% if prices.pageCount|default('0') > 10 %}
                     <div class="lp-lsjg-btn">
                        <div class="wrap">
                            <input type="button" value="{{'更多'|trans({})}}" class="btn"><i class="font-lp-21 ico"></i><i class="font-lp-55 ico02" style="display: none;font-size: 20px;"></i>
                        </div>
                     </div>
                {% endif %}
            </div>
            <script type="text/javascript">
                seajs.use([], function() {
                    // 历史价格列表下面，切换更多和收起按钮，并显示隐藏列表内容
                    $oBtn = $(".wrap");
                    $oDiv = $(".lp-lsjg-tbody");
                    $ico = $(".ico")

                    $oBtn.click(function() {
                        if (!$oDiv.is(":visible")) {
                            $oBtn.val("{{'收起'|trans({})}}");
                            $oDiv.show();
                            $ico.hide();
                            $('.ico02').show();

                        } else {
                            $oBtn.val("{{'更多'|trans({})}}");
                            $oDiv.hide();
                            $ico.show();
                            $('.ico02').hide();
                        }
                    });
                });
            </script>
        {% endif %}
    {% endspaceless %}
{%- endmacro -%}
{#
/**
 * @method dzsp(o)
 * @description 电子沙盘
 * @param {String} o.aid - 楼盘id
 * @param {String} o.dzsp - 沙盘图
 * @example
 * ```twig
 * {{- house_global.dzsp({dzsp: detail.id|default(0), chart: 1}) -}}
 * ```
 */
 #}
{%- macro dzsp(o) -%}
    {% import "CoreBundle:Macro:global.html.twig" as core_global %}
    {% set opt = {
        dzsp: '',
        aid: 0
    }|merge(o) %}
    {% spaceless %}
        {# 楼栋 #}
        {% set block_loudong = ('house.build')|getAll({aid: opt.aid|default(''), findType: 1,pageSize:100}) %}
        {# 销售状态 #}
        {% set category_cate_status = 'cate_status'|getCategory() %}
        {# 沙盘图 #}
        {% set tpl_dzsp = opt.dzsp %}
        {# 栋楼数据 #}
        {% if tpl_dzsp != null %}
            <div class="lp-coltit">
                <h3 class="tit1">电子沙盘</h3>
                <div class="more">
                    注：按下鼠标不松可以拖动图片
                    {% if category_cate_status is defined %}
                        {% for item in category_cate_status %}
                            <span>
                                <i class="sp-i sp-color-{{item.id|default('')}}"></i>
                                {{item.name|default('')}}
                            </span>
                        {% endfor %}
                    {% endif %}
                </div>
            </div>
            <div class="bd-gray p10 shapan">
                <div class="shapan-inner">
                    <div class="shapan-drag">
                        {{core_global.img({
                            src: tpl_dzsp,
                            type: 0
                        })}}
                        {# 楼栋图标 #}
                        {% if block_loudong.data is defined %}
                            {% for item in block_loudong.data %}
                                {% if item.seat|default('') != '0' %}
                                    <div data-role="sha-dot" data-index="{{loop.index}}" class="sha-dot sp-color-{{item.cate_status|default('')}}" style="{% for sate in item.seat|split(',') %}{% if loop.index == 1 %}left:{{sate}}px{% else %};top:{{sate}}px{% endif %}{% endfor %}"  data-sate="{{item.seat|default('')}}" href="javascript:;">
                                        <i class="sanjiao"></i>
                                        {{item.name|default('')}}
                                    </div>
                                {% endif %}
                            {% endfor %}
                        {% endif %}
                    </div>
                </div>
                <div data-info="1" class="shapan-info-small">楼栋列表</div>
                <div data-info-big="1" class="shapan-info">
                    <h5>楼栋列表 <i data-role="shapanClose" class="font-ico-28 shapan-close" data-closeex="{target: '[data-info-big]', showTarget: '[data-info]'}"></i></h5>
                    {% if block_loudong.data is defined %}
                        {% for item in block_loudong.data %}
                            <div data-shapan-item="{{loop.index}}" class="shapan-item">
                                <div class="shapan-title">
                                    <i data-icon="1" class="font-ico-plus"></i>
                                     {{item.name|default('')}}
                                </div>
                                <div class="shapan-box">
                                    <p><i></i>开盘时间&nbsp;:&nbsp;
                                    {{core_global.time_date({time: item.kpsj.date|default('')})}}
                                    </p>
                                    <p><i></i>交房时间&nbsp;:&nbsp;
                                    {{core_global.time_date({time: item.jfsj.date|default('')})}}
                                </p>
                                    <p><i></i>单元&nbsp;:&nbsp;{{item.unit|default('')}} </p>
                                    <p><i></i>层数&nbsp;:&nbsp;{{item.floor|default('')}} </p>
                                    <p><i></i>户数&nbsp;:&nbsp;{{item.hushu|default('')}} </p>
                                    <p class="text"><i></i>近期动态&nbsp;:&nbsp;{{item.dongtai|default('')}}</p>
                                </div>
                            </div>
                        {% endfor %}
                    {% endif %}
                </div>
            </div>
            <script type="text/javascript">
                seajs.use(['shapan'], function (shapan) {
                    //电子沙盘
                    shapan.showInfo({
                        drag : '.shapan-drag',
                        dragParent : '.shapan-inner',
                        dot : '.sha-dot',
                        info : '.shapan-info'
                    });
                })
            </script>
        {% endif %}
    {% endspaceless %}
{%- endmacro -%}

{# 详情图库 #}
{#
/**
 * @method detail_photos_common(o)
 * @description 详情页相册图库公用部分  使用模板  1、楼盘图库  houses/dphotos  2、商业地产图库  business/dphotos  3、小区图库 sale/qdphotos
 * @param {String} o.aid - 楼盘id
 * @param {String} o.ajax_url - 请求路径
 * @example
 * ```twig
 * {{- house_global.detail_photos_common({aid: detail.id|default(0), ajax_url: action|U}) -}}
 * ```
 */
 #}
{%- macro detail_photos_common(o) -%}
    {% import "CoreBundle:Macro:global.html.twig" as core_global %}
    {% set opt = {
        ajax_url: '',
        aid: 0
    }|merge(o) %}
    {% spaceless %}
        <div class="container">
            <!--hx-nav-->
            <div class="lp-hx-nav clearfix">
                <ul>
                    <li>
                        <a href="#cate_album=" class="act album" data-params="{cate_album: ''}" data-id="{{opt.aid}}">{{'全部'|trans({})}}({{- core_global.count({models: 'inter_album', sql_opt: {aid: opt.aid} }) -}})</a>
                        <span>|</span>
                    </li>
                    {{- _self.countxc({aid: opt.aid, tpl: '<li><a class="%class% album" href="#cate_album=%cate%" data-cate="%cate%" data-params="{cate_album: %cate%}" data-id="' ~ opt.aid ~ '">%name%(%number%)</a><span>|</span></li>'}) -}}
                </ul>
            </div>
            <div class="blank20"></div>
            <!--/hx-nav-->
            <ul id="lightgallery" class="lp-plist1 plist-mod clearfix">
            </ul>
            <div class="blank10"></div>
            <div class="tac pt10 pb10" style="display: none">
                <a href="javascript:;" class="ico-word lp-plist-more btn" id="lp-plist-more">
                    <i></i>
                    {{'加载更多'|trans({})}}
                </a>
            </div>
            <div class="blank20"></div>
        </div>

        <script type="text/javascript">
            seajs.use(['listajax', 'lightgallery'], function (listajax, lightgallery) {
                listajax.init({
                    url: '{{opt.ajax_url}}',
                    list: '.lp-plist1',
                    addBtn: '.tac',
                    filterBtn: '.album',
                    data: {
                        id: '{{opt.aid}}',
                        cate_album: ''
                    },
                    success: function (data) {
                        // 当有数据的时候执行
                        if (!$('.lp-plist1').find('li:first').data('noinfo')) {
                            var $lg = $('#lightgallery');
                            // 如果已经启动过则先注销启动，然后在内容加载完之后重新启动
                            try{
                                $lg.data('lightGallery').destroy(true);
                            }catch(ex){};
                            $lg.lightGallery();
                        };
                    },
                    defaultAct: '#cate_album='
                })
            });
        </script>
    {% endspaceless %}
{%- endmacro -%}

{# 户型公用模块 #}
{#
/**
 * @method detail_planintro_common(o)
 * @description 详情页户型公用部分 使用模板   1、楼盘户型  houses/qdplanintro  2、小区户型 sale/qdplanintro
 * @param {String} o.aid - 楼盘id
 * @param {String} o.ajax_url - 请求路径
 * @example
 * ```twig
 * {{- house_global.detail_planintro_common({aid: detail.id|default(0), ajax_url: action|U}) -}}
 * ```
 */
 #}
{%- macro detail_planintro_common(o) -%}
    {% import "CoreBundle:Macro:global.html.twig" as core_global %}
    {% set opt = {
        aid: 0,
        ajax_url: ''
    }|merge(o) %}
    {% spaceless %}
        <div class="container">
            <div class="lp-hx-nav clearfix">
                <ul>
                    <li>
                        <a href="#shi=" data-params="{shi: ''}" class="act album" data-id="{{opt.aid}}">{{"全部"|trans({})}}({{- core_global.count({models: 'door', sql_opt: {aid: opt.aid} }) -}})</a>
                        <span>|</span>
                    </li>
                    {{- _self.countshi({aid: opt.aid, tpl: '<li><a class="%class% album" rel="nofollow" href="#shi=%shi%" data-params="{shi: %shi%}" data-id="' ~ opt.aid ~ '" data-shi="%shi%">%name%(%number%)</a><span>|</span></li>'}) -}}
                </ul>
            </div>
            <div class="blank20"></div>
            <ul class="lp-plist1 plist-mod clearfix">
            </ul>
            <div class="blank10"></div>
            <div class="tac pt10 pb10" style="display: none;">
                <a href="javascript:;" class="ico-word lp-plist-more btn" id="lp-plist-more" style="display:inline-block">
                    <i></i>{{"加载更多"|trans({})}}
                </a>
            </div>
            <div class="blank20"></div>
        </div>

        <script type="text/javascript">
        seajs.use(['listajax'], function (listajax) {
            listajax.init({
                url: '{{opt.ajax_url}}',
                list: '.lp-plist1',
                addBtn: '.tac',
                filterBtn: '.album',
                data: {
                    id: '{{opt.aid}}',
                    shi: ''
                },
                defaultAct: '#shi='
            })
        });
        </script>
    {% endspaceless %}
{%- endmacro -%}

{# 红包 #}
{#
/**
 * @method red_modal(o)
 * @description 楼盘红包
 * @param {String} o.aid - 楼盘id
 * @example
 * ```twig
 * {{- house_global.red_modal({aid: detail.id|default(0)}) -}}
 * ```
 */
 #}
{%- macro red_modal(o) -%}
    {% import "CoreBundle:Macro:global.html.twig" as core_global %}
    {% set block_hongbao = ('house.red')|getRow({checked: 1, aid: o.aid|default(''), form: 'houses_red', order: 'id|desc', findType: 1}) %}
    {% spaceless %}
        {% if block_hongbao|default('') %}
            <!-- 红包 -->
            <div class="moneybtn tf" id="hbMoneybtn">
                <a href="#hbContent" class="btn-jqModal" data-css='{"width": 1000, "minHeight": 700}' data-bodycss='{"padding":0}'>

                    <p class="hbp1" style="margin-top: 125px;">
                        </p><center>
                            最高<span>{{block_hongbao.price|default('')}}</span>
                        </center>
                    <p></p>
                    <div class="getMoneybtn" id="hbGetMoneybtn"></div>
                </a>
                <div class="detailPopClose" data-closeex="{target: '#hbMoneybtn', showTarget: '.moneyclose'}"></div>
            </div>

            <!-- 关闭-->
            <a class="moneyclose" href="javascript:;"></a>
            <!-- 关闭-->

            <!-- 点击弹窗-->
            <div class="monyePop tf" id="hbContent" style="display: none;">
                <div class="popHead pr">
                    <a class="moneyNumPos fred1 by_a2" style=" line-height:32px;">
                        最高<span class="moneyNum">{{block_hongbao.price|default('')}}</span>
                    </a>
                    <div class="popCloseBtn cp" id="hbPopCloseBtn" data-close="1"></div>
                    <img src="{{- core_global.img_url({src: 'bundles/house/images/hb/head_11.png'}) -}}" width="758" class="headBanner">
                </div>
                <div class="popCont popCont1 pr">
                    <img src="{{- core_global.img_url({src: 'bundles/house/images/hb/popRightPic.png'}) -}}" class="popRightPic">
                    <div class="hbbg pr ">
                        <div class="moneyNum fred1" style="top:96px">{{block_hongbao.price|default('')}}</div>
                        <div class="menNum">
                            <span class="fred3">{{block_hongbao.hdnum|default('0')}}</span>人 <br>
                            已领取
                        </div>
                        <div class="right fwhite">
                            <div class="tiale">{{core_global.substr(block_hongbao.name|default(''),22,1)}}</div>
                            <p class="datas">
                                签约有效期：
                                <span class="fyellow">{{block_hongbao.limit_time|default(0)|date('Y-m-d')}}</span>
                            </p>
                            <a href="{{('hongbao/detail')|U({id:block_hongbao.id|default(0)})}}" target="_blank" class="takebtn">立即领取</a>
                        </div>
                    </div>
                </div>
            </div>
            <!-- 点击弹窗-->
        {% endif %}
    {% endspaceless %}
{%- endmacro red_modal -%}

{# 置业顾问 #}
{#
/**
 * @method zhiyeguwen(o)
 * @description 置业顾问
 * @param {Array} o.aid - 楼盘id
 * @example
 * ```twig
 * {{- house_global.zhiyeguwen({aid: detail.id}) -}}
 * ```
 */
 #}
{%- macro zhiyeguwen(o) -%}
    {% import "CoreBundle:Macro:global.html.twig" as core_global %}
    {% set block_zhiyeguwen = ('house.inter_adviser')|getAll({checked: 1,aid: o.aid|default(''), findType:1, order: 'sort', orderBy: 'asc', pageSize: 18}) %}
    {% if block_zhiyeguwen.data is defined and block_zhiyeguwen.pageCount|default(0) != 0 %}
        <div class="blank15"></div>
        <div class="advidser-line"></div>
        <div class="blank5"></div>
        <label class="advidser-text">置业顾问: </label>
        <div data-nextbtn=".advidser-next" class="advidser-list clearfix">
            <ul>
                {% for item in block_zhiyeguwen.data %}
                    <li>
                        {{
                            core_global.img({
                                src: item.thumb|default(''),
                                alt: item.name|default(''),
                                height: 34,
                                width: 34,
                                type: 2,
                                attr: 'class="advidser-img"'
                            })
                        }}
                        <p class="advidser-name">
                            {{item.name|default('')}}
                        </p>
                        <div class="advidser-more">
                            <div class="advidser-container">
                                <dl class="advidser-more-content clearfix">
                                    <dt>
                                        {{
                                            core_global.img({
                                                src: item.thumb|default(''),
                                                alt: item.name|default(''),
                                                height: 60,
                                                width: 45,
                                                type: 2,
                                            })
                                        }}
                                    </dt>
                                    <dd>
                                        <p>
                                            {{item.name|default('')}}
                                        </p>
                                        <p class="mt5">
                                            <a target="_blank" href="http://wpa.qq.com/msgrd?v=3&uin={{- item.qq|default('') -}}&site=qq&menu=yes"><img border="0" src="http://wpa.qq.com/pa?p=2:{{- item.qq|default('') -}}:41" alt="{{item.name|default('')}}" title="{{item.name|default('')}}"/></a>
                                        </p>
                                    </dd>
                                </dl>
                                <div class="advidser-more-footer">
                                    <i class="font-lp-13"></i>{{item.tel|default('')}}
                                </div>
                            </div>
                            <div class="advidser-arrow">{# 向下的箭头 #}
                                <div class="arrow1"></div>
                                <div class="arrow2"></div>
                            </div>
                        </div>
                    </li>
                {% endfor %}
            </ul>
        </div>
        <script type="text/javascript">
            seajs.use([''], function () {
                $('.advidser-list li').hover(function () {
                    $(this).addClass('hover');
                }, function () {
                    $(this).removeClass('hover')
                });
            })
        </script>
    {% endif %}
{%- endmacro -%}

{# 底部公用模块 #}
{#
/**
 * @method footer_recommend(o)
 * @description 底部推荐内容
 * @param {Array} o.data - 推荐数据
 * @param {Number} o.pageSize=5 - 推荐数据数量限制
 * @param {String} o.tag - 数据标识
 * @param {String} o.title - 标题
 * @example
 * ```twig
 * {{- house_global.footer_recommend({title: '楼盘', tag: 'index_dblp'}) -}}
 * ```
 */
 #}
{%- macro footer_recommend(o) -%}
    {% set opt = {
        pageSize: 5,
        tag: '',
        title: '',
        data: {}
    }|merge(o) %}
    {% if opt.data %}
        {% set data = opt.data %}
    {% else %}
        {% set data = (opt.tag)|getPush2(opt.pageSize) %}
    {% endif %}
    {% spaceless %}
        <dl >
            <dt>{{opt.title}}</dt>
            <dd>
                {% if data is defined %}
                    {% for item in data %}
                        {% if 'http' in item.url %}
                            {% set item_url = item.url %}
                        {% else %}
                            {% set item_url = (item.url)|U(item.urlparams|default({})) %}
                        {% endif %}
                        <a href="{{item_url}}" target="_blank">
                            {{item.name|default('')}}
                        </a>
                    {% endfor %}
                {% endif %}
            </dd>
        </dl>
    {% endspaceless %}
{%- endmacro -%}

{########################################################################################################
                                        推荐列表区域
 ########################################################################################################}
{# 出租、二手详情页推荐 #}
{#
/**
 * @method sale_rent_recommend(o)
 * @description 出租、二手详情页推荐
 * @param {String} o.data - 推荐数据
 * @example
 * ```twig
 * {{- house_global.sale_rent_header(detail|default({})) -}}
 * ```
 */
 #}
{%- macro sale_rent_recommend(o) -%}
    {% import "CoreBundle:Macro:global.html.twig" as core_global %}
    {% set opt = {
        title: '',
        data: {},
        tag: '',
        action: ''
    }|merge(o) %}
    {% spaceless %}
        {% if opt.list.data is defined and opt.list.pageCount|default(0) != 0 %}
            <div class="panel" data-tag="{{opt.tag}}">
                <div class="panel-hd">
                    <h2>{{opt.title}}</h2>
                </div>
                <div class="panel-bd bd-gray clearfix">
                    <div class="house-recommend jqDuang" data-prevbtn=".recommend-left" data-nextbtn=".recommend-right" data-obj="li" data-visible="3" data-steps="3" data-effect="left" data-lazyload="src">
                        <ul>
                            {% for item in opt.list.data %}
                                <li>
                                    <a href="{{(opt.action|default(''))|U({id: item.id|default('')})}}" target="_blank">
                                        {{- core_global.data_src_img({
                                            src: item.thumb|default(''),
                                            alt: item.name|default(''),
                                            type: 2,
                                            width: 240,
                                            height: 160
                                        }) -}}

                                    <div>
                                        <a target="_blank" title="{{item.name|default('')}}" href="{{(opt.action|default(''))|U({id: item.id|default('')})}}">
                                            {{core_global.substr( item.name|default(''), 10, 1)}}
                                        </a>
                                        {{core_global.region({id: item.region|default(''), tpl: '<span class="fr">%value%</span>'})}}
                                    </div>
                                    <p>
                                        参考价格：
                                        {% if item.models|default('') == 'sale' %}
                                            {{_self.if_wy({value: item.zj|default('')})}}
                                        {% else %}
                                            {{_self.if_czj({value: item.czj|default('')})}}
                                        {% endif %}
                                    </p>
                                </li>
                            {% endfor %}
                        </ul>
                        <div class="recommend-left">
                            <i class="font-icons-11"></i>
                        </div>
                        <div class="recommend-right">
                            <i class="font-icons-12"></i>
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}
        <script type="text/javascript">
            seajs.use(['jqduang'], function (jqduang) {})
        </script>
    {% endspaceless %}
{%- endmacro -%}

{# 侧栏楼盘推荐 #}
{#
/**
 * @method houses_recommend(o)
 * @description 楼盘列表侧栏推荐
 * @param {String} o.class - 样式
 * @param {String} o.models - 链接模型
 * @param {Array} o.list - 数据
 * @param {String} o.tag - 数据来源标记
 * @example
 * ```twig
 * {{- house_global.houses_recommend({list: houses_data, tag: 'clicks'}) -}}
 * ```
 */
 #}
{%- macro houses_recommend(o) -%}
    {% import "CoreBundle:Macro:global.html.twig" as core_global %}
    {% set opt = {
        class: '',
        list: {},
        tag: '',
        models: 'houses'
    }|merge(o) %}
    {% spaceless %}
        <div class="{{opt.class}}" data-tag="{{opt.tag}}">
            <h2 class="s-title">热门推荐</h2>
            <ul class="lp-tj">
                {% if opt.list is defined %}
                    {% for item in opt.list %}
                        <li class="lp-tj-item">
                            <a href="{{(opt.models ~ '/detail')|U({id: item.fromid|default('')})}}" target="_blank" class="pic">
                               {{- core_global.img({
                                   src: item.thumb|default(''),
                                   alt: item.name|default(''),
                                   type: 2,
                                   width:210 ,
                                   height: 156
                               }) -}}
                            </a>
                            <div class="info">
                                <p class="tit">
                                    <a href="javascript:;" target="_blank" class="pr10">
                                        {{core_global.region({id: item.region|default('')})}}
                                    </a>
                                    <a href="{{(opt.models ~ '/detail')|U({id: item.fromid|default('')})}}" target="_blank">
                                        {{item.name|default('')}}
                                    </a>
                                </p>
                                <p class="price">
                                    均价：{{_self.if_dj({value: item.dj|default('')})}}
                                </p>
                                <p class="tag">
                                    {{_self.lptag({value: item, tpl: '<a href="javascript:;">%value%</a>', con: 'cate_status,cate_type'})}}
                                    <a href="{{(opt.models ~ '/dcomment')|U({id: item.formid|default('')})}}" target="_blank">评论</a>
                                </p>
                            </div>
                        </li>
                    {% endfor %}
                {% endif %}
            </ul>
        </div>
    {% endspaceless %}
{%- endmacro -%}

{# 楼盘详情推荐 #}
{#
/**
 * @method houses_detail_recommend(o)
 * @description 楼盘详情页推荐
 * @param {String} o.title - 标题
 * @param {String} o.title_url=javaScript:; - 标题链接/默认javascript:;
 * @param {Array} o.list - 数据
 * @param {String} o.tag - 数据来源标记
 * @param {String} o.compare - 楼盘对比
 * @param {String} o.models=houses - 模型
 * @example
 * ```twig
 * {{- house_global.houses_detail_recommend({title: '同价位楼盘', list: aaaa, tag: 'clicks'}) -}}
 * ```
 */
 #}
{%- macro houses_detail_recommend(o) -%}
    {% import "CoreBundle:Macro:global.html.twig" as core_global %}
    {% set opt = {
        title: '',
        title_url: 'javascript:;',
        tag: '',
        list: {},
        compare: 0,
        models: 'houses'
    }|merge(o) %}
    {% spaceless %}
        <div class="lp-coltit">
            <h3>
                <a href="{{opt.title_url}}">{{opt.title}}</a>
            </h3>
        </div>
        <div class="lp-tlist3 bd-gray clearfix" data-tag='{{opt.tag}}'>
            <ul>
                {% if opt.list.data is defined and opt.list.pageCount|default(0) != 0 %}
                    {% for item in opt.list.data %}
                        <li>
                            <i class="td1">
                                <a target="_blank" title="{{item.name|default('')}}" href="{{(opt.models ~ '/detail')|U({id: item.id|default('')})}}">{{item.name|default('')|trans({})}}</a>
                            </i>
                            <i class="td2">
                                {{_self.if_dj({value: item.dj|default(''), tpl: '<b class="c-f00">%value%</b>%danwei%'})}}
                            </i>
                            {% if opt.compare %}
                                <i class="td3">
                                    <a href="{{('houses/contrast')|U({fid: 8, chid: 4})}}#/{{app.request.get('id')}},{{item.id|default('')}}" target="_blank">对比</a>
                                </i>
                            {% else %}
                                {{core_global.region({id: item.region|default(''), tpl: '<i class="td3">%value%</i>'})}}
                            {% endif %}
                        </li>
                    {% endfor %}
                {% else %}
                    <li class="noinfo">{{_self.list_tips()}}</li>
                {% endif %}
            </ul>
        </div>
    {% endspaceless %}
{%- endmacro -%}

{# 侧边楼盘推荐 #}
{#
/**
 * @method aside_houses_recommend(o)
 * @description 楼盘详情右侧推荐
 * @param {String} o.title - 标题
 * @param {Array} o.list - 数据
 * @param {String} o.tag - 数据来源标记
 * @param {String} o.models - 模型
 * @example
 * ```twig
 * {{- house_global.aside_houses_recommend({title: '热门楼盘', models: 'houses', list: detail_houses_data }) -}}
 * ```
 */
 #}
{%- macro aside_houses_recommend(o) -%}
    {% import "CoreBundle:Macro:global.html.twig" as core_global %}
    {% set opt = {
        models: '',
        title: '',
        tag: 'clicks'
    }|merge(o) %}
    {% spaceless %}
        {% if o.list.data is defined and o.list.pageCount|default(0) != 0 %}
        <div class="borgray clearfix" data-tag='{{opt.tag}}'>
            <div class="area2-3">
                <a href="{{(opt.models ~ '/list')|U}}" target="_blank">
                    <p class="gengduo img-news-09" title="更多"></p>
                </a>
                <h3 class="rmlp">{{opt.title}}</h3>
            </div>
            <div class="area2_10">
                <ul class="tjtuw clearfix">
                    {% for item in o.list.data %}
                        {% set item_models = item.models|default(opt.models) %}
                        <li>
                            <a href="{{(item_models ~ '/detail')|U({id: item.id|default('')})}}" target="_blank" title="{{item.name|default('')|trans({})}}">
                                {{- core_global.img({
                                    src: item.thumb|default(''),
                                    alt: item.name|default(''),
                                    type: 2,
                                    width: 126,
                                    height: 90
                                }) -}}
                                 <em>{{item.name|default('')}}</em>
                            </a>
                            <p>
                                {{core_global.region({id: item.region|default(''), tpl: '<i class="ico">%value%</i>'})}}
                                {% if item_models == 'sale' %}
                                    {{_self.if_wy({value: item.zj|default(''), tpl: '<i class="pri">%value%</i>%danwei%'})}}
                                {% else %}
                                    {{_self.if_dj({value: item.dj|default(''), tpl: '<i class="pri">%value%</i>%danwei%'})}}
                                {% endif %}
                            </p>
                        </li>
                    {% endfor %}
                </ul>
            </div>
        </div>
        {% endif %}
    {% endspaceless %}
{%- endmacro -%}

{# 学区房源推荐 #}
{#
/**
 * @method school_lp_recommend(o)
 * @description 学区出租、二手推荐
 * @param {String} o.models - 模型
 * @param {Array} o.ids - 楼盘id合集
 * @example
 * ```twig
 * {{- house_global.school_lp_recommend({models: 'rent', ids: houses_id}) -}}
 * ```
 */
 #}
{%- macro school_lp_recommend(o) -%}
    {% spaceless %}
        {% set data = ('house.' ~ o.models)|getAll({pageSize: 10, aid: 'in|' ~ o.ids, checked: 1}) %}
        {% if data.data is defined and data.pageCount|default(0) != 0 %}
            {% for item in data.data %}
                <dd>
                    <span class="gy1">
                        <a target="_blank" href="{{( o.models ~ '/detail')|U({id: item.id|default('')})}}">{{item.name|default('')}}</a>
                    </span>
                    {{- _self.huxing({data: item|default(''), tpl: '<span class="gy2">%shi%%ting%</span>'}) -}}
                    <span class="gy3">
                        {{_self.if_mj({value: item.mj|default(''), tpl: '%value%%danwei%'})}}
                    </span>
                    <span class="gy4">
                        {% if o.models == 'sale' %}
                            {{_self.if_wy({value: item.zj|default(''), tpl: '<i>%value%</i>%danwei%'})}}
                        {% else %}
                            {{_self.if_czj({value: item.czj|default(''), tpl: '<i>%value%</i>%danwei%'})}}
                        {% endif %}
                    </span>
                    <span class="gy5">{{item.update_time|default('')|date('m-d')}}</span>
                </dd>
            {% endfor %}
        {% else %}
            <dd class="noinfo" style="width: 100%; padding-left: 0">{{_self.list_tips()}}</dd>
        {% endif %}
    {% endspaceless %}
{%- endmacro -%}

{# 直播推荐 #}
{#
/**
 * @method live_recommend(o)
 * @description 直播推荐
 * @param {String} o.title - 标题
 * @param {String} o.tag - 推送数据来源
 * @param {Array} o.list - 数据
 * @example
 * ```twig
 * {{- house_global.live_recommend({title: '推荐', list: aaa, tag: 'clicks'}) -}}
 * ```
 */
 #}
{%- macro live_recommend(o) -%}
    {% import "CoreBundle:Macro:global.html.twig" as core_global %}
    {% set opt = {
        title: '',
        tag: '',
        list: {}
    }|merge(o) %}
    {% spaceless %}
        {% if opt.list is defined %}
            <div class="coltit">
                <h3 class="tit">
                    <span>{{opt.title}}</span>
                </h3>
            </div>
            <ul class="tlist pt10 pb10 mr10" data-tag="{{opt.tag}}">
                {% for item in opt.list %}
                    <li class="clearfix pic">
                        <a href="{{item.url|default('#')}}" target="_blank">
                            {{- core_global.lazy_img({
                                src: item.thumb|default(''),
                                alt: item.name|default(''),
                                width: 115,
                                height: 75,
                                type: 2
                            }) -}}
                        </a>
                        <h4>
                            <a href="{{item.url|default('#')}}" target="_blank" >{{item.name|default('')}}</a>
                        </h4>
                    </li>
                {% endfor %}
            </ul>
        {% endif %}
        {{core_global.lazyload()}}
    {% endspaceless %}
{%- endmacro -%}

{# 图库右侧推荐 #}
{#
/**
 * @method photos_recommend(o)
 * @description 图库推荐
 * @param {String} o.title - 标题
 * @param {String} o.tag - 推送数据来源
 * @param {Array} o.list - 数据
 * @example
 * ```twig
 * {{- house_global.live_recommend({title: '推荐', list: aaa, tag: 'clicks'}) -}}
 * ```
 */
 #}
{%- macro photos_recommend(o) -%}
    {% import "CoreBundle:Macro:global.html.twig" as core_global %}
    {% set opt = {
        list: {},
        tag: '',
        class: ''
    }|merge(o) %}
    {% spaceless %}
        <ul class="content {{opt.class}}" data-tag="{{opt.tag}}">
            {% if opt.list|default('') %}
                {% for item in opt.list %}
                    {% if loop.index == 1 %}
                    <li class="first{% if item.ad|default('') %} house-ad right-top{% endif %}">
                        {% if item.ad|default('') %}
                            <div class="ad-txt"></div>
                        {% endif %}
                        <a class="content-img" target="_blank" href="{{item.url|default('#')}}">
                            {{- core_global.data_src_img({
                                src: item.thumb|default(''),
                                alt: item.name|default(''),
                                type: 2,
                                width: 300,
                                height: 200
                            }) -}}
                        </a>
                        <a class="first-txt" target="_blank" href="{{item.url|default('#')}}">
                    {% else %}
                    <li>
                        <a target="_blank" href="{{item.url|default('#')}}">
                        <i></i>
                    {% endif %}
                            {{item.name|default('')|trans({})}}
                        </a>
                    </li>
                {% endfor %}
            {% endif %}
        </ul>
    {% endspaceless %}
{%- endmacro -%}

{# 置业指南右侧 #}
{#
/**
 * @method guide_recommend(o)
 * @description 置业指南推荐
 * @param {String} o.title - 标题
 * @param {String} o.tag - 推送数据来源
 * @param {Array} o.list - 数据
 * @example
 * ```twig
 * {{- house_global.guide_recommend({title: '推荐', list: aaa, tag: 'clicks'}) -}}
 * ```
 */
 #}
{%- macro guide_recommend(o) -%}
    {% import "CoreBundle:Macro:global.html.twig" as core_global %}
    {% set opt = {
        tag: '',
        title: '',
        list: {}
    }|merge(o) %}
    {% spaceless %}
        {% if opt.list|default('') %}
            <div class="s-box" data-tag="{{opt.tag}}">
                <div class="s-title">
                    <h3>{{opt.title}}</h3>
                </div>
                <div class="box-con">
                    <!-- 重复的内容框 -->
                    {% for item in opt.list %}
                        <div class="box-b">
                            <h4>
                                <a href="{{core_global.url(item|merge({models: 'guide', set_models: 1}))}}" target="_blank" >{{item.name}}</a>
                            </h4>
                            <div class="b-btns">
                                {{core_global.keywords({
                                    keywords: item.keywords|default(''),
                                    models: 'guide',
                                    tpl: '<a href="%url%">%keywords%</a>'
                                })}}
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
        {% endif %}
    {% endspaceless %}
{%- endmacro -%}

{# 服务中心首页推荐 #}
{#
/**
 * @method service_index_recommend(o)
 * @description 服务中心首页推荐
 * @param {String} o.show - 是否显示
 * @param {Array} o.list - 数据
 * @example
 * ```twig
 * {{- house_global.service_index_recommend({list: aaa}) -}}
 * ```
 */
 #}
{%- macro service_index_recommend(o) -%}
    {% spaceless %}
        <div class="tab-item clearfix" {% if o.show|default('') %}style="display:block;"{% endif %}>
            <ul class="clearfix">
                {% if o.list|default('') %}
                    {% for item in o.list %}
                        <li>
                            <i class="font-service-arrow"></i>
                            <a href="{{item.url}}" title="{{item.name}}">{{item.name}}</a>
                        </li>
                    {% endfor %}
                {% else %}
                    <li class="no-info">暂无数据</li>
                {% endif %}
            </ul>
        </div>
    {% endspaceless %}
{%- endmacro -%}

{# 服务中心流程推荐 #}
{%- macro service_shortcut_recommend(o) -%}
    {% import "CoreBundle:Macro:global.html.twig" as core_global %}
    {% spaceless %}
        {% set push_rumenliucheng = ('rumenliucheng')|getPush(6) %}
        <div class="shortcut-nav container">
            <ul class="clearfix">
                {% if push_rumenliucheng|default('') %}
                    {% for item in push_rumenliucheng %}
                        <li>
                            <a href="{{core_global.url(item|merge({models: 'service'}))}}" title="{{item.name|default('')}}">
                                <div class="shortcut-nav-icon {{item.navicon|default('font-service-2')}}"></div>
                                <div class="shortcut-name">
                                    {{item.name|default('')}}
                                </div>
                            </a>
                        </li>
                    {% endfor %}
                {% endif %}
            </ul>
        </div>
    {% endspaceless %}
{%- endmacro -%}

{# 周边配套 #}
{#
/**
 * @method around_recommend(o)
 * @description 周边出租、二手房推荐
 * @param {String} o.models - 模型
 * @param {String} o.tips - 提示
 * @param {Array} o.ids - id合集
 * @example
 * ```twig
 * {{- house_global.around_recommend({tips: '暂无出租数据', models: 'rent', ids: 'id合集'}) -}}
 * ```
 */
 #}
{%- macro around_recommend(o) -%}
    {% import "CoreBundle:Macro:global.html.twig" as core_global %}
    {% set opt = {
        models: '',
        ids: '',
        tips: '暂无数据'
    }|merge(o) %}
    {% spaceless %}
        {% set houses_cate = ('house.' ~ opt.models)|getAll({aid: 'in|' ~ opt.ids|join(','), checked: 1}) %}

        {% if houses_cate.data is defined and houses_cate.pageCount|default(0) != 0 and opt.ids %}
            {% for item in houses_cate.data %}
                {% set item_url = {
                    id: item.id|default(''),
                    models: item.models|default('')
                } %}
                <dd>
                    <em class="td1 c-e43">
                        <a target="_blank" href="{{core_global.url(item_url)}}">
                            {{item.name|default('')}}
                        </a>
                    </em>
                    <em class="td2">
                        {{_self.huxing({
                            data: item|default('')
                        })}}
                    </em>
                    <em class="td3">
                        {{_self.if_mj({value: item.mj|default('')})}}
                    </em>
                    <em class="td4">
                        {% if opt.models == 'sale' %}
                            {{_self.if_wy({value: item.zj|default(''), tpl: '%value%%danwei%'})}}
                        {% else %}
                            {{_self.if_czj({value: item.czj|default(''), tpl: '%value%%danwei%'})}}
                        {% endif %}
                    </em>
                    <em class="td5">
                        {{item.update_time|default('')|date('m-d')}}
                    </em>
                </dd>
            {% endfor %}
        {% else %}
            <dd class="noinfo">
                {{opt.tips}}
            </dd>
        {% endif %}
    {% endspaceless %}
{%- endmacro -%}

{# 首页大全 #}
{#
/**
 * @method index_dq_recommend(o)
 * @description 首页大全推送
 * @param {Boolean} o.show - 是否显示
 * @param {Array} o.list - 数据
 * @param {Array} o.hot_list - 热门城市数据
 * @example
 * ```twig
 * {{- house_global.index_dq_recommend({show: 1, list: list}) -}}
 * ```
 */
 #}
{%- macro index_dq_recommend(o) -%}
    {% import "CoreBundle:Macro:global.html.twig" as core_global %}
    {% set opt = {
        list: {},
        show: 0,
        models: ''
    }|merge(o) %}
    {% spaceless %}
        <div class="item" {% if opt.show|default('') %}style="display:block;"{% endif %}>
            <ul class="clearfix">
                {% if opt.list is defined %}
                    {% for item in opt.list %}
                        {% set url_data = {
                            'office': {
                                models: 'business'
                            },
                            'shop': {
                                models: 'business'
                            },
                            'houses': {
                                models: 'houses'
                            },
                            'xq': {
                                models: 'sale',
                                action: 'qdetail'
                            }
                        } %}
                        {% set tpl_url = '' %}
                        {% for k, v in url_data if opt.models|default('') == k %}
                            {% set tpl_url = core_global.url({
                                models: v.models,
                                fromid: item.fromid|default(0),
                                set_models: 1,
                                id: item.id,
                                action: v.action|default('detail')
                            }) %}
                        {% endfor %}
                        <li>
                            <a href="{{tpl_url|default('')}}" target="_blank">{{item.name|default('')}}</a>
                        </li>
                    {% endfor %}
                {% endif %}
            </ul>
            {% if opt.hot_list|default('') %}
                <p>
                    热门城市：
                    {% for item in opt.hot_list %}
                        <a href="{{item.url|default('')}}" target="_blank">
                            {{item.name|default('')}}
                        </a>
                    {% endfor %}
                </p>
            {% endif %}
        </div>
    {% endspaceless %}
{%- endmacro -%}

{# 首页推荐 #}
{#
/**
 * @method index_lp_recommend(o)
 * @description 首页推送
 * @param {Boolean} o.show - 是否显示
 * @param {Boolean} o.set_models - 是否使用自定义链接
 * @param {String} o.controller - 控制器/方法
 * @param {String} o.models - 显示类型
 * @param {Array} o.list - 数据
 * @example
 * ```twig
 * {{- house_global.index_lp_recommend({show: 1, list: list}) -}}
 * ```
 */
 #}
{%- macro index_lp_recommend(o) -%}
    {% import "CoreBundle:Macro:global.html.twig" as core_global %}
    {% set opt = {
        list: {},
        show: 0,
        controller: 'houses/detail',
        models: 'houses',
        set_models: 0
    }|merge(o) %}
    {% spaceless %}
        <div class="item item1" {% if opt.show %}style="display:block;"{% endif %}>
            <ul class="list clearfix">
                {% if opt.list is defined %}
                    {% for item in opt.list %}
                        {# 链接设置 #}
                        {% if opt.set_models|default('') %}
                            {% set item_url = core_global.url(item|merge({controller: opt.controller, set_models: opt.set_models|default('')})) %}
                        {% else %}
                            {% set item_url = item.url|default('') %}
                        {% endif %}
                        {# 类型判断 #}
                        {% set lp_type = opt.models %}

                        {# 价钱 #}
                        {% set tpl_price = {
                            'houses'  : _self.if_dj({value: item.dj|default(''), class: 'price'}),
                            'xiaoqu'  : _self.if_dj({value: item.dj|default(''), class: 'price'}),
                            'sale'    : _self.if_wy({value: item.zj|default(''), class: 'price'}),
                            'rent'    : _self.if_czj({value: item.czj|default(''), class: 'price'}),
                            'groupbuy': '<span class="price" title="'~ item.tgj|default(0) ~'">' ~ item.tgj|default('') ~ '</span>',
                            'fenxiao' : _self.if_dj({value: item.shichangjia|default(''), class: 'price'}),
                            'kft'     : ('已有'|trans({}))~' <span class="price">' ~ item.enroll|default('') ~ '</span> '~('人'|trans({}))~('报名'|trans({}))
                        } %}
                        {# 简介说明 #}
                        {% set tpl_abstract = {
                            'houses'  : item.bdsm|default(''),
                            'sale'    : item.lpmc|default(''),
                            'rent'    : item.lpmc|default(''),
                            'xiaoqu'  : ('售'|trans({}))~':<span class="c-e43">' ~ item.sales|default(0) ~ '</span>'~('套'|trans({}))~'<span class="fr">'~('租'|trans({}))~':<span class="c-e43">' ~ item.rents|default(0) ~ '</span>'~('套'|trans({}))~'</span>',
                            'fenxiao' : ('推荐'|trans({}))~':<span class="c-e43">' ~ item.yituijian|default(0) ~ '</span>'~('人'|trans({}))~'<span class="fr">'~('预订'|trans({}))~':<span class="c-e43">' ~ item.yiyuding|default(0) ~ '</span>人</span>',
                            'kft'     : ('截止时间'|trans)~'：<span class="c-e43">' ~ item.show_time.date|default(item.end_time.date|default(''))|date('Y-m-d') ~ '</span>',
                            'groupbuy': ('截止时间'|trans)~'：<span class="c-e43">' ~ item.enddate.date|default(item.end_time.date|default(''))|date('Y-m-d') ~ '</span>'
                        } %}

                        <li {% if item.ad|default('') %}class="house-ad right-top"{% endif %}>
                            {% if item.ad|default('') %}
                                <div class="ad-txt"></div>
                            {% endif %}
                            <a href="{{item_url|default('')}}" target="_blank">
                                {{core_global.data_src_img({
                                    src: item.thumb|default(''),
                                    alt: item.name|default(''),
                                    type: 2,
                                    height: 138,
                                    width: 193
                                })}}
                                <p>
                                    {{item.name|default('')}}
                                </p>
                            </a>
                            <div class="info">
                                {{core_global.region({id: item.region|default(''), tpl: '<span class="ad fr">%value%</span>', default: ' '})}}
                                {% for k,v in tpl_price %}
                                    {% if k == lp_type|default('') %}
                                        {{v|default('')|raw}}
                                    {% endif %}
                                {% endfor %}
                            </div>
                            <p>
                                {% for k,v in tpl_abstract %}
                                    {% if k == lp_type|default('') %}
                                        {{v|default('')|raw}}
                                    {% endif %}
                                {% endfor %}
                            </p>
                        </li>
                    {% endfor %}
                {% endif %}
            </ul>
        </div>
    {% endspaceless %}
{%- endmacro -%}

{# 首页特惠专区 #}
{#
/**
 * @method index_thzq_recommend(o)
 * @description 首页推送
 * @param {Boolean} o.topic - 是否是专题
 * @param {Array} o.list - 数据
 * @example
 * ```twig
 * {{- house_global.index_thzq_recommend({list: list}) -}}
 * ```
 */
 #}
{%- macro index_thzq_recommend(o) -%}
    {% import "CoreBundle:Macro:global.html.twig" as core_global %}
    {% set opt = {
        list: {},
        topic: 0
    }|merge(o) %}
    {% spaceless %}
        <div class="item">
            <div class="blank15"></div>
            <ul class="list clearfix">
                {% if opt.list is defined %}
                    {% for item in opt.list %}
                        <li {% if item.ad|default('') %}class="house-ad right-top"{% endif %}>
                            {% if item.ad|default('') %}
                                <div class="ad-txt"></div>
                            {% endif %}
                            <a href="{{item.url|default('')}}" target="_blank">
                                {{core_global.data_src_img({
                                    src: item.thumb|default(''),
                                    alt: item.name|default(''),
                                    type: 2,
                                    height: 192,
                                    width: 220
                                })}}
                                <p>
                                    {{item.name|default('')}}
                                </p>
                            </a>
                            {% if not opt.topic %}
                                <div class="info">
                                    {{core_global.region({id: item.region|default(''), tpl: '<span class="ad fr">%value%</span>'})}}
                                    {{_self.if_dj({value: item.dj|default(''), class: 'f-color price'})}}
                                </div>
                            {% endif %}
                            <p>
                                {# 楼盘使用报价说明 #}
                                {% if opt.topic %}
                                    {{item.abstract|default('')}}
                                {% else %}
                                    {{item.bdsm|default('')}}
                                {% endif %}
                            </p>
                        </li>
                    {% endfor %}
                {% endif %}
            </ul>
        </div>
    {% endspaceless %}
{%- endmacro -%}

{########################################################################################################
                                        列表区域
 ########################################################################################################}
{# 列表提示 #}
{%- macro list_tips(tips) -%}
    {# 搜索判断 #}
    {% set url_name = url_name|default(app.request.get('name')) %}
    {# 分类判断 #}
    {% set url_category = url_category|default(app.request.get('category')) %}

    {% set category = url_category|getCategoryById() %}

    {% set category_name = category.name|default('') %}

    {# 普通列表使用 #}
    {% if url_name|default('') %}
        {# 搜索 #}
        {% set tpl_noinfo_content = url_name %}
    {% elseif url_category|default('') and tpl_category|default(1) %}
        {# 分类 #}
        {% set tpl_noinfo_content = category_name %}
    {% else %}
        {# 自定义 #}
        {% set tpl_noinfo_content = tips|default('') %}
    {% endif %}
    {# 分类列表使用 #}
    {% set tpl_noinfo = '暂无' ~ tpl_noinfo_content ~ '数据' %}

    {% spaceless %}
        {{tpl_noinfo|default('')}}
    {% endspaceless %}
{%- endmacro -%}

{# 新房列表 #}
{%- macro houses_list(o) -%}
    {% import "CoreBundle:Macro:global.html.twig" as core_global %}
    {% set opt = {
    }|merge(o) %}

    {% spaceless %}
        {% if opt.list.data is defined and opt.list.pageCount|default(0) != 0 %}
            {# 获取当前列表id #}
            {% set ids = '' %}
            {% for item in opt.list.data %}
                {% if loop.index != 1 %}
                    {% set dh = ',' %}
                {% endif %}
                {% set ids = ids ~ dh|default('') ~ item.id %}
            {% endfor %}

            {# 获取资讯 #}
            {% set lpdt_ids = ('house.houses_arc')|getCol('id', {aid: 'in|' ~ ids, cate_pushs: 'lpdt', order: 'id', orderBy: 'asc'}) %}

            {% set block_lpdt = ('house.houses_arc')|getBlock({ename: 'lpdt'}, {pageSize: lpdt_ids|length, checked: 1, id: 'in|' ~ lpdt_ids|default(0)|join(','), order: 'id', orderBy: 'desc'}) %}
            {% set block_lpdt_list = {} %}

            {% for item in block_lpdt.data %}
                {% set block_lpdt_list = {
                    ('lpdt' ~ item.aid): {
                        "name": item.name,
                        "fromid": item.fromid|default(0)
                    }
                }|merge(block_lpdt_list) %}
            {% endfor %}

            {# 获取团购 #}
            {% set tuangou_ids = ('house.groupbuy')|getCol('id', {aid: 'in|' ~ ids, order: 'id', orderBy: 'asc'}) %}
            {% set block_tuangou = ('house.groupbuy')|getAll({pageSize: tuangou_ids|length, checked: 1, id: 'in|' ~ tuangou_ids|default(0)|join(','), order: 'id', orderBy: 'desc'}) %}

            {% set block_tuangou_list = {} %}

            {% for item in block_tuangou.data %}
                {% set block_tuangou_list = {
                    ('tuangou' ~ item.aid): {
                        "name": item.name,
                        "id": item.id
                    }
                }|merge(block_tuangou_list) %}
            {% endfor %}

            {# 获取户型 #}
            {% set huxings_ids = ('house.door')|getCol('id', {checked: 1, aid: 'in|' ~ ids, order: 'id', orderBy: 'asc', zlhx: 1 }) %}

            {% set block_huxings = ('house.door')|getAll({pageSize: huxings_ids|length, checked: 1, id: 'in|' ~ huxings_ids|default(0)|join(','), order: 'id', orderBy: 'desc'}) %}

            {% set block_huxings_list = {} %}

            {% for item in block_huxings.data %}
                {% set block_huxings_list = {
                    ('huxing' ~ item.aid ~ '_' ~ item.id): {
                        value: core_global.formData({value: item.shi|default(''), default: ''}) ~ core_global.formData({value: item.ting|default(''), default: ''}) ~ _self.if_mj({value: item.mj|default(''), tpl: '%value%%danwei%'}),
                        id: item.id
                    }
                }|merge(block_huxings_list) %}
            {% endfor %}

            {% for item in opt.list.data %}
                {# 资讯 #}
                {% set item_block_lpdt = block_lpdt_list['lpdt' ~ item.id]|default('') %}
                {# 团购 #}
                {% set item_block_tuangou = block_tuangou_list['tuangou' ~ item.id]|default('') %}
                {# 红包 #}
                <li class="list-item clearfix">
                    <div class="pic fl mleft0">
                        <a href="{{('houses/detail')|U({id:item.id|default('')})}}" target="_blank">
                            {{- core_global.lazy_img({
                                src: item.thumb|default(''),
                                alt: item.name|default(''),
                                type: 2,
                                width:180 ,
                                height: 135
                            }) -}}
                            {% if item.top|default('') == 159 %}
                                {# 置顶 #}
                                {{core_global.formData({value: item.top|default(''), tpl: '<i>%value%</i>'})}}
                            {% endif %}
                             {% if item.rednum > 0 %}
                                <img class="hongbao" src="{{- core_global.img_url({src: 'bundles/house/images/hogbao.png'}) -}}" alt="红包">
                            {% endif %}
                        </a>
                    </div>
                    <div class="info fl">
                        <h3>
                            <a href="{{('houses/detail')|U({id:item.id|default('')})}}" target="_blank" class="tit">{{item.name|default('')}}
                            {% if item.cate_status != '' %}
                                {# 销售状态 #}
                                <span class="tag on-sale-{{item.cate_status}}">
                                    {{ core_global.formData({value: item.cate_status|default('')}) }}
                                </span>
                            {% endif %}
                           </a>
                        </h3>
                        <p class="add">
                            {{core_global.address({data: item|default('')})}}
                        </p>
                        <p class="type"> <em>主力户型:</em>
                           {% for k,v in block_huxings_list|default({}) if ('huxing' ~ item.id|default('') ~ '_') in k %}
                                <a class='mr10' href='{{('door/detail')|U({id: v.id})}}' target='_blank'>
                                    {{v.value|raw}}
                                </a>
                            {% endfor %}
                        </p>
                        <p class="tags pt5">
                            {{_self.lptag({value: item, tpl: '<span>%value%</span>', con: 'cate_type,zxcd,tslp'})}}
                        </p>
                    </div>
                    <div class="other fr">
                        <p class="dj">
                            <a href="javascript:;" target="_blank">
                                {{_self.if_dj({value: item.dj|default(''), tpl: '<em class="arial">%value%</em>%danwei%'})}}
                            </a>
                        </p>
                        {% if item.bdsm|default('') != '' %}
                        <div class="blank5"></div>
                        <p>
                            <span class="preferential" title="{{item.bdsm|default('')}}">
                                {{ core_global.substr(item.bdsm|default(''), 15, 1) }}
                            </span>
                        </p>
                        {% endif %}
                        <div class="blank10"></div>
                        {% if item.tel|default('') != '' %}
                        <p class="ico-word tel">
                            <i class="font-lp-9"></i>
                            {{item.tel|default('')}}
                        </p>
                        {% endif %}
                    </div>
                    <div class="blank10"></div>
                    <p class="info2 clearfix">
                        <span class="fr">
                            <a target="_blank" href="{{('houses/dask')|U({id: item.id|default('')})}}" class="ico-word">
                                <i class="font-lp-5"></i>
                                问答
                            </a>
                            <a target="_blank" href="{{('houses/dcomment')|U({id: item.id|default('')})}}" class="ico-word">
                                <i class="font-lp-6"></i>
                                点评
                            </a>
                            {% if item_block_tuangou|default('') %}
                                {# 判断是否有团购 #}
                                <a target="_blank" href="{{('groupbuy/detail')|U({id: item_block_tuangou.id|default('')})}}" class="ico-word">
                                    <i class="font-lp-7"></i>
                                    团购
                                </a>
                            {% endif %}
                            {# 对比按钮 #}
                            {{_self.compare_btn({
                                id: item.id|default(''),
                                title: item.name|default(''),
                                url: ('houses/detail')|U({id:item.id|default('')})
                            })}}
                        </span>
                        {% if item_block_lpdt|default('') %}
                            {% if item_block_lpdt.fromid != 0 %}
                                {% set item_block_lpdt_url = ('news/detail')|U({id: item_block_lpdt.fromid|default('')}) %}
                            {% else %}
                                {% set item_block_lpdt_url = 'javascript:;' %}
                            {% endif %}
                            <a target="_blank" title="{{item_block_lpdt.name|default('')}}" href="{{item_block_lpdt_url}}" class="ico-word">
                                <i class="font-lp-10 ml20"></i>{{item_block_lpdt.name|default('')}}
                            </a>
                        {% endif %}
                    </p>
                    <div class="blank10"></div>
                </li>

            {% endfor %}
        {% else %}
            <li class="noinfo">{{_self.list_tips('新房'|trans({}))}}</li>
        {% endif %}
        <div class="blank30"></div>
        {{core_global.page(opt.list)}}
        <div class="blank30"></div>
        {# 图片加载 #}
        {{core_global.lazyload()}}
        {# 对比 #}
        {{_self.compare_tpl({
            chid: 4,
            title: '新房对比'
        })}}
    {% endspaceless %}
{%- endmacro -%}
{# 出租列表 #}
{%- macro rent_list(o) -%}
    {% set cook_id = app.request.get("cook_id") %}
    {% import "CoreBundle:Macro:global.html.twig" as core_global %}
    {% if o.list.data is defined and o.list.pageCount|default(0) != 0 %}
        {# 方式二获取当前数据用户信息 #}
        {% if cook_id|default(0) != 1 %}
            {# 列表会员id合集 #}
            {% set list_users_ids = '' %}
            {# 组装用户表数据 #}
            {% set list_users = {} %}
            {# 组装userinfo表数据 #}
            {% set list_userinfo = {} %}
            {# 经纪公司id合集 #}
            {% set list_jjgs_ids = '' %}
            {# 经纪公司属性表id合集 #}
            {% set list_jjgs_attr_ids = '' %}
            {# 经纪公司属性id #}
            {% set list_jjgs_attr_id_data = {} %}
            {# 组装经纪公司属性 #}
            {% set list_jjgs_attr = {} %}

            {# 列表经纪人id合集 #}
            {% for item in o.list.data %}
                {% if loop.index != 1 %}
                    {% set dh = ',' %}
                {% endif %}
                {% set list_users_ids = list_users_ids ~ dh|default('') ~ item.uid %}
            {% endfor %}

            {# 列表会员数据 #}
            {% set list_users_data = ('db.users')|getAll({id: 'in|' ~ list_users_ids, pageSize: o.list.pageSize}) %}

            {# 经纪人数据 #}
            {% for item in list_users_data.data %}
                {% set list_users = {
                    ('users' ~ item.id): item.username
                }|merge(list_users) %}
            {% endfor %}

            {# userinfo 数据 #}
            {% set list_userinfo_data = ('db.userinfo')|getAll({uid: 'in|' ~ list_users_ids, pageSize: o.list.pageSize}) %}

            {# 组装经纪人userinfo数据，所属经纪公司id合集 #}
            {% for item in list_userinfo_data.data %}
                {% set list_userinfo = {
                    ('userinfo' ~ item.uid): {
                        'nicename': item.nicename,
                        'cid': item.cid,
                        'usertype': item.usertype
                    }
                }|merge(list_userinfo) %}
                {% if loop.index != 1 %}
                    {% set dh = ',' %}
                {% endif %}
                {% set list_jjgs_ids = list_jjgs_ids ~ dh|default('') ~ item.cid %}
            {% endfor %}

            {# 经纪公司数据 #}
            {% set list_jjgs_userinfo = ('db.userinfo')|getAll({uid: 'in|' ~ list_jjgs_ids, pageSize: o.list.pageSize}) %}

            {# 获取经纪公司属性id合集 #}
            {% for item in list_jjgs_userinfo.data %}
                {% if loop.index != 1 %}
                    {% set dh = '' %}
                {% endif %}
                {% set list_jjgs_attr_ids = list_jjgs_attr_ids ~ dh|default('') ~ item.id %}
                {% set list_jjgs_attr_id_data = {
                    ('cid' ~ item.uid): item.id
                }|merge(list_jjgs_attr_id_data) %}
            {% endfor %}

            {# 经纪公司属性数据 #}
            {% set list_jjgs_attr_data = ('db.user_attr')|getAll({name: 'in|company,cpltd', pageSize: o.list.pageSize * 2, mid: "in|" ~ list_jjgs_attr_ids}) %}

            {# 组装经纪公司属性数据 #}
            {% for item in list_jjgs_attr_data.data %}
                {% set list_jjgs_attr = {
                    (item.name ~ item.mid): item.value
                }|merge(list_jjgs_attr) %}
            {% endfor %}
        {% endif %}

        {% for item in o.list.data %}
            {% set item_count = item.tujis|default('')|sourceImg|length %}
            {% if cook_id|default(0) != 1 %}
                {# 当前用户userinfo数据 #}
                {% set item_userinfo = list_userinfo['userinfo' ~ item.uid]|default({}) %}
                {# 用户名 #}
                {% set user_name = item_userinfo.nicename|default(list_users['users' ~ item.uid]|default('-')) %}
                {# 用户类型 #}
                {% set user_type = item_userinfo.usertype|default('') %}
                {# 经纪公司id #}
                {% set user_jjgs_id = item_userinfo.cid|default('') %}
                {# 经纪公司属性id #}
                {% set user_jjgs_attr_id = list_jjgs_attr_id_data['cid' ~ user_jjgs_id]|default('') %}
                {# 经纪公司名称 先读全称，再读简写 #}
                {% set user_jjgs_name = list_jjgs_attr['company' ~ user_jjgs_attr_id]|default(list_jjgs_attr['cpltd' ~ user_jjgs_attr_id]|default('')) %}
                {# 根据用户类型判断显示 #}
                {% if user_type == 15 %}
                    {% set item_user_data = '<a href="' ~ ('member/detail')|U({id: user_jjgs_id}) ~ '" target="_blank" class="ps mr5">' ~ user_jjgs_name ~ '</a><a href="' ~ ('member/j_detail')|U({id: item.uid}) ~ '" target="_blank" class="ps c-e43"><i class="font-icons-2 mr5" style="vertical-align: -1px;"></i>' ~ user_name ~ '</a><span class="new mr10">(经纪人)</span>' %}
                {% else %}
                    {% set item_user_data = user_name ~ '<span class="new">(个人)</span>' %}
                {% endif %}
                {# 图文 #}
                <div class="sale-list-item rent-list-ex" {% if loop.last %}
                    data-page ="{
                                pageCount : {{o.list.pageCount}},
                                pageIndex : {{o.list.pageIndex}},
                                suffix: '套房源',
                                pageSize : {{o.list.pageSize}}
                            }"
                {% endif %}>
                    <div class="sale-item-l">
                        <div class="sale-item-img">
                            <a href="{{('rent/detail')|U({id: item.id|default('')})}}" target="_blank">
                                {{- core_global.lazy_img({
                                    src: item.thumb|default(''),
                                    alt: item.name|default(''),
                                    type: 2,
                                    width:180 ,
                                    height: 135
                                }) -}}
                            </a>
                            {% if item_count|default('0') > 0 %}
                                <span>{{item_count}}{{'图'|trans({})}}</span>
                            {% endif %}
                        </div>
                        <div class="sale-item-text">
                            <h3>
                                <a href="{{('rent/detail')|U({id: item.id|default('')})}}" target="_blank">{{item.name|default('')|trans({})}}</a>
                                {% if item_count >= 10 %}
                                    <span class="tu tu-1">{{'多图'|trans({})}}</span>
                                {% endif %}
                                {% if item.zjdate|default('') >= ('now')|date('U') %}
                                    <span class="tu tu-2">{{'置顶'|trans({})}}</span>
                                {% endif %}
                                {% if item.jian|default('') == 1 %}
                                    <span class="tu tu-4">{{'店铺'|trans({})}}</span>
                                {% endif %}
                            </h3>
                            <p>
                                {{core_global.address({data: item|default(''), default: '', num: 100})}}
                            </p>
                            <p class="fang">
                                {{- _self.huxing({data: item|default(''), tpl: '<span>%shi%%ting%%wei%</span>', default: ''}) -}}
                                {{core_global.if({value: '' ~ core_global.formData({value: item.fl|default(''), default: ''}) ~ '', tpl: '  / <span>'~('房龄'|trans({}))~': %value%</span>', default: ''})}}
                                {{core_global.if({value: item.szlc|default(''), tpl: ' / <span>%value%/' ~ item.zlc|default('') ~('层'|trans({}))~'</span>'})}}
                                {{- _self.lptag({value: item, tpl: '&nbsp;/ <span>%value%</span>', con: 'zxcd,cx'}) -}}
                            </p>
                            <p>
                                {# 公用获取对应用户方法，此方法每条数据都会查询对应的表，耗性能 #}
                                {# {{- _self.publisher_list(item.uid|default('')) -}} #}
                                {# 方法二，一次查询出来，然后再找，此方式有点绕 #}
                                {{item_user_data|raw}}
                                {% if item.refreshdate > item.update_time %}
                                <span class="new">{{core_global.timeformat({time: item.refreshdate|default('')})}}</span>
                                {% else %}
                                <span class="new">{{core_global.timeformat({time: item.update_time|default('')})}}</span>
                                {% endif %}
                            </p>
                        </div>
                    </div>

                    <div class="sale-item-r">
                        <p>
                            {{_self.if_czj({value: item.czj|default(''), class: 'big'})}}
                        </p>
                        {{- _self.if_mj({value: item.mj|default(''), tpl: '<p>'~('面积'|trans({}))~'&nbsp;:&nbsp;<span>%value%</span>%danwei%</p>'}) -}}
                        {% if o.compare|default(1) == 1 %}
                        <p class="buy">
                            {% set name = core_global.substr(item.name|default(''), 20, 1) %}
                            {{_self.modal_btn({
                                id: 'yx-enroll',
                                attr: 'data-yx-btn="1"',
                                opt: "{name: '" ~ name|trim() ~ "', aid: '" ~ item.id|default(0) ~ "'}",
                                class: 'form-bdrs',
                                title: '我有意向',
                                icon: 'font-lp-29',
                            })}}
                            {# 对比按钮 #}
                            {{_self.compare_btn({
                                id: item.id|default(''),
                                title: item.name|default(''),
                                url: ('rent/detail')|U({id:item.id|default('')})
                            })}}
                        </p>
                        {% endif %}
                    </div>
                </div>
            {% else %}
                {# 文字结构 #}
                <div class="sale-item tag-box-t" {% if loop.last %}
                    data-page ="{
                                pageCount : {{o.list.pageCount}},
                                pageIndex : {{o.list.pageIndex}},
                                suffix: '套房源',
                                pageSize : {{o.list.pageSize}}
                            }"
                {% endif %}>
                    <div class="t-b-t-l">
                        <h3>
                            <a href="{{('rent/detail')|U({id: item.id|default('')})}}" target="_blank">{{'逸居菀好房不容错过'|trans({})}}</a>
                            {% if item_count >= 10 %}
                                <span class="tu tu-1">{{'多图'|trans({})}}</span>
                            {% endif %}
                            {% if item.zjdate|default('') >= ('now')|date('U') %}
                                <span class="tu tu-2">{{'置顶'|trans({})}}</span>
                            {% endif %}
                            {# <span class="tu tu-3">优质</span> #}
                            {% if item.jian|default('') == 1 %}
                                <span class="tu tu-4">{{'店铺'|trans({})}}</span>
                            {% endif %}
                        </h3>
                        <p>
                            <span class="place">
                                {{core_global.address({data:item|default('') })}}
                            </span>
                        {% if item.refreshdate > item.update_time %}
                            <span class="new">{{core_global.timeformat({time: item.refreshdate|default('')})}}</span>
                        {% else %}
                            <span class="new">{{core_global.timeformat({time: item.update_time|default('')})}}</span>
                        {% endif %}
                        </p>
                    </div>

                    <div class="t-b-t-m">
                        <p class="bold">
                            {{- _self.huxing({data: item|default(''), tpl: '<span>%shi%%ting%%wei%</span>'}) -}}
                        </p>
                        <p>
                            {{_self.if_mj({value: item.mj|default('')})}}
                        </p>
                    </div>

                    <div class="t-b-t-r">
                        <p>
                            {{_self.if_czj({value: item.czj|default(''), class: 'big'})}}
                        </p>
                    </div>
                </div>
            {% endif %}
        {% endfor %}
    {% else %}
        <div class="noinfo">{{_self.list_tips('出租')}}</div>
    {% endif %}
    {# 分页 #}
    {% if o.page|default('') %}
        <div class="blank30"></div>
        {{core_global.page(o.list)}}
        <div class="blank30"></div>
    {% endif %}
    {# 对比 #}
    {% if o.compare|default(1) == 1 %}
        {{_self.compare_tpl({
            chid: 2,
            title: '出租对比'
        })}}
        {{_self.modal_layout({
            id: 'yx-enroll',
            btn: '[data-yx-btn=1]',
            fields: ['aid'],
            ajax: "ajax: {
                data : {
                    formflag: 'view_sale_intent',
                    aid: 0,
                    models: 'rent',
                    cate_pushs: 'syixiang',
                    type: 'sale',
                    formcls: 'common-form-lg common-form-control'
                }
            }"
        })}}
    {% endif %}
    {{core_global.lazyload()}}
{%- endmacro -%}

{# 出售列表 #}
{%- macro sale_list(o) -%}
    {% set cook_id = app.request.get("cook_id") %}
    {% import "CoreBundle:Macro:global.html.twig" as core_global %}
    {% if o.list.data is defined and o.list.pageCount|default(0) != 0 %}
        {# 方式二获取当前数据用户信息 #}
        {% if cook_id|default(0) != 1 %}
            {# 列表会员id合集 #}
            {% set list_users_ids = '' %}
            {# 组装用户表数据 #}
            {% set list_users = {} %}
            {# 组装userinfo表数据 #}
            {% set list_userinfo = {} %}
            {# 经纪公司id合集 #}
            {% set list_jjgs_ids = '' %}
            {# 经纪公司属性表id合集 #}
            {% set list_jjgs_attr_ids = '' %}
            {# 经纪公司属性id #}
            {% set list_jjgs_attr_id_data = {} %}
            {# 组装经纪公司属性 #}
            {% set list_jjgs_attr = {} %}

            {# 列表经纪人id合集 #}
            {% for item in o.list.data %}
                {% if loop.index != 1 %}
                    {% set dh = ',' %}
                {% endif %}
                {% set list_users_ids = list_users_ids ~ dh|default('') ~ item.uid %}
            {% endfor %}

            {# 列表会员数据 #}
            {% set list_users_data = ('db.users')|getAll({id: 'in|' ~ list_users_ids, pageSize: o.list.pageSize}) %}

            {# 经纪人数据 #}
            {% for item in list_users_data.data %}
                {% set list_users = {
                    ('users' ~ item.id): item.username
                }|merge(list_users) %}
            {% endfor %}

            {# userinfo 数据 #}
            {% set list_userinfo_data = ('db.userinfo')|getAll({uid: 'in|' ~ list_users_ids, pageSize: o.list.pageSize}) %}

            {# 组装经纪人userinfo数据，所属经纪公司id合集 #}
            {% for item in list_userinfo_data.data %}
                {% set list_userinfo = {
                    ('userinfo' ~ item.uid): {
                        'nicename': item.nicename,
                        'cid': item.cid,
                        'usertype': item.usertype
                    }
                }|merge(list_userinfo) %}
                {% if loop.index != 1 %}
                    {% set dh = ',' %}
                {% endif %}
                {% set list_jjgs_ids = list_jjgs_ids ~ dh|default('') ~ item.cid %}
            {% endfor %}

            {# 经纪公司数据 #}
            {% set list_jjgs_userinfo = ('db.userinfo')|getAll({uid: 'in|' ~ list_jjgs_ids, pageSize: o.list.pageSize}) %}

            {# 获取经纪公司属性id合集 #}
            {% for item in list_jjgs_userinfo.data %}
                {% if loop.index != 1 %}
                    {% set dh = '' %}
                {% endif %}
                {% set list_jjgs_attr_ids = list_jjgs_attr_ids ~ dh|default('') ~ item.id %}
                {% set list_jjgs_attr_id_data = {
                    ('cid' ~ item.uid): item.id
                }|merge(list_jjgs_attr_id_data) %}
            {% endfor %}

            {# 经纪公司属性数据 #}
            {% set list_jjgs_attr_data = ('db.user_attr')|getAll({name: 'in|company,cpltd', pageSize: o.list.pageSize * 2, mid: "in|" ~ list_jjgs_attr_ids}) %}

            {# 组装经纪公司属性数据 #}
            {% for item in list_jjgs_attr_data.data %}
                {% set list_jjgs_attr = {
                    (item.name ~ item.mid): item.value
                }|merge(list_jjgs_attr) %}
            {% endfor %}
        {% endif %}

        {% for item in o.list.data %}
            {% set item_count = item.tujis|default('')|sourceImg|length %}
            {% if cook_id|default(0) != 1 %}
                {% if item.aid|default('') %}
                    {% set item_houses_attr = 'href=' ~ ("sale/qdetail")|U({id: item.aid|default('')}) ~ ' target="_blank"' %}
                {% else %}
                    {% set item_houses_attr = 'javascript:;' %}
                {% endif %}
                {# 当前用户userinfo数据 #}
                {% set item_userinfo = list_userinfo['userinfo' ~ item.uid]|default({}) %}
                {# 用户名 #}
                {% set user_name = item_userinfo.nicename|default(list_users['users' ~ item.uid]|default('-')) %}
                {# 用户类型 #}
                {% set user_type = item_userinfo.usertype|default('') %}
                {# 经纪公司id #}
                {% set user_jjgs_id = item_userinfo.cid|default('') %}
                {# 经纪公司属性id #}
                {% set user_jjgs_attr_id = list_jjgs_attr_id_data['cid' ~ user_jjgs_id]|default('') %}
                {# 经纪公司名称 先读全称，再读简写 #}
                {% set user_jjgs_name = list_jjgs_attr['company' ~ user_jjgs_attr_id]|default(list_jjgs_attr['cpltd' ~ user_jjgs_attr_id]|default('')) %}
                {# 根据用户类型判断显示 #}
                {% if user_type == 15 %}
                    {% set item_user_data = '<a href="' ~ ('member/detail')|U({id: user_jjgs_id}) ~ '" target="_blank" class="ps mr5">' ~ user_jjgs_name ~ '</a><a href="' ~ ('member/j_detail')|U({id: item.uid}) ~ '" target="_blank" class="ps c-e43"><i class="font-icons-2 mr5" style="vertical-align: -1px;"></i>' ~ user_name ~ '</a><span class="new mr10">(经纪人)</span>' %}
                {% else %}
                    {% set item_user_data = user_name ~ '<span class="new">(个人)</span>' %}
                {% endif %}

                {# 图文 #}
                <div class="sale-list-item sale-list-ex" {% if loop.last %}
                    data-page ="{
                                pageCount : {{o.list.pageCount}},
                                pageIndex : {{o.list.pageIndex}},
                                suffix: '套房源',
                                pageSize : {{o.list.pageSize}}
                            }"
                {% endif %}>

                    <div class="sale-item-l">
                        <div class="sale-item-img">
                            <a href="{{('sale/detail')|U({id:item.id|default('')})}}" target="_blank">
                                {{- core_global.lazy_img({
                                    src: item.thumb|default(''),
                                    alt: item.name|default(''),
                                    width: 180,
                                    height: 135,
                                    type: 2
                                }) -}}
                            </a>
                            {% if item_count > 0 %}
                                <span>{{item_count}}{{'图'|trans({})}}</span>
                            {% endif %}
                        </div>

                        <div class="sale-item-text">
                            <h3>
                                <a href="{{('sale/detail')|U({id:item.id})}}" target="_blank">{{item.name|default('')|trans({})}}</a>
                                {% if item.zjdate|default('') >= ('now')|date('U') %}
                                    <span class="tu tu-2">{{'置顶'|trans({})}}</span>
                                {% endif %}
                                {% if item_count > 10 %}
                                    <span class="tu tu-1">{{'多图'|trans({})}}</span>
                                {% endif %}
                                {% if item.jian|default('0') == 1 %}
                                    <span class="tu tu-4">{{'店铺'|trans({})}}</span>
                                {% endif %}
                            </h3>
                            <p>
                                <a class="mr5 c-e43" {{item_houses_attr|raw}} >
                                    {{item.lpmc|default('')}}
                                </a>
                                {{core_global.address({data:item, default: '', num: 100})}}
                            </p>
                            <p class="fang">
                                {{- _self.huxing({data: item, tpl: '<span>%shi%%ting%%wei%</span>', default: ''}) -}}
                                {{core_global.if({value: '' ~ core_global.formData({value: item.fl|default(''), default: ''}) ~ '', tpl: ' / <span>'~('房龄'|trans({}))~': %value%</span>', default: ''})}}
                                {{core_global.if({value: item.szlc|default(''), tpl: ' / <span>%value%/' ~ item.zlc|default('') ~('层'|trans({}))~'</span>'})}}
                                {{- _self.lptag({value: item, tpl: '&nbsp;/ <span>%value%</span>', con: 'zxcd,cx'}) -}}
                            </p>
                            <p>
                                {# 公用获取对应用户方法，此方法每条数据都会查询对应的表，耗性能 #}
                                {# {{- _self.publisher_list(item.uid|default('')) -}} #}
                                {# 方法二，一次查询出来，然后再找，此方式有点绕 #}
                                {{item_user_data|raw}}
                                {% if item.refreshdate > item.update_time %}
                                    <span class="new">{{core_global.timeformat({time: item.refreshdate|default('')})}}</span>
                                {% else %}
                                    <span class="new">{{core_global.timeformat({time: item.update_time|default('')})}}</span>
                                {% endif %}
                            </p>
                        </div>
                    </div>

                    <div class="sale-item-r">
                        <p>
                            {{_self.if_wy({value: item.zj|default(''), class: 'big'})}}
                        </p>
                        {{- _self.if_mj({value: item.mj|default(''), tpl: '<p>'~('面积'|trans({}))~'&nbsp;:&nbsp;<span>%value%</span>%danwei%</p>'}) -}}
                        <p>
                            {{'单价'|trans({})}}&nbsp;:&nbsp;{{_self.if_dj({value: item.dj|default('')})}}
                        </p>
                        {% if o.compare|default(1) == 1 %}
                        <p class="buy">
                            {% set name = core_global.substr(item.name|default(''), 20, 1) %}
                            {{_self.modal_btn({
                                id: 'yx-enroll',
                                attr: 'data-yx-btn="1"',
                                opt: "{name: '" ~ name|trim() ~ "', aid: '" ~ item.id|default(0) ~ "'}",
                                class: 'form-bdrs',
                                title: '我有意向',
                                icon: 'font-lp-29',
                            })}}
                           {# 对比按钮 #}
                            {{_self.compare_btn({
                                id: item.id|default(''),
                                title: item.name|default(''),
                                url: ('sale/detail')|U({id:item.id|default('')})
                            })}}
                        </p>

                        {% endif %}
                    </div>
                </div>
            {% else %}
                {# 文字结构 #}
                <div class="sale-item tag-box-t" {% if loop.last %}
                    data-page ="{
                                pageCount : {{o.list.pageCount}},
                                pageIndex : {{o.list.pageIndex}},
                                suffix: '套房源',
                                pageSize : {{o.list.pageSize}}
                            }"
                {% endif %}>
                    <div class="t-b-t-l">
                        <h3>
                            <a href="{{('sale/detail')|U({id:item.id})}}" target="_blank">{{core_global.substr(item.name|default('户型')|trans({}), 5, 1)}}</a>
                            {% if item.zjdate|default('') >= ('now')|date('U') %}
                                <span class="tu tu-2">{{'置顶'|trans({})}}</span>
                            {% endif %}
                            {% if item_count|default('0') > 10 %}
                                <span class="tu tu-1">{{'多图'|trans({})}}</span>
                            {% endif %}
                                {# <span class="tu tu-3">优质</span> #}
                            {% if item.jian|default('0') == 1 %}
                                <span class="tu tu-4">{{'店铺'|trans({})}}</span>
                            {% endif %}
                        </h3>
                        <p>
                            <span class="place">
                                {{core_global.address({data:item|default('') })}}
                            </span>
                            {% if item.refreshdate > item.update_time %}
                                <span class="new">{{core_global.timeformat({time: item.refreshdate|default('')})}}</span>
                            {% else %}
                                <span class="new">{{core_global.timeformat({time: item.update_time|default('')})}}</span>
                            {% endif %}
                        </p>
                    </div>

                    <div class="t-b-t-m">
                        <p class="bold">
                            {{- _self.huxing({data: item|default(''), tpl: '<span>%shi%%ting%%wei%</span>'}) -}}
                        </p>
                        <p>
                            <span>
                                {{_self.if_mj({value: item.mj|default('')})}}
                            </span>
                        </p>
                    </div>

                    <div class="t-b-t-r">
                        <p>
                            {{_self.if_wy({value: item.zj|default(''), class: 'big'})}}
                        </p>
                        <p>
                            {{'单价'|trans({})}}&nbsp;:&nbsp; {{_self.if_dj({value: item.dj|default('')})}}
                        </p>
                    </div>
                </div>
            {% endif %}
        {% endfor %}
    {% else %}
        <div class="noinfo">{{_self.list_tips('二手房')}}</div>
    {% endif %}
    {# 分页 #}
    {% if o.page|default('') %}
        <div class="blank30"></div>
        {{core_global.page(o.list)}}
        <div class="blank30"></div>
    {% endif %}
    {% if o.compare|default(1) == 1 %}
        {# 对比 #}
        {{_self.compare_tpl({
            chid: 2,
            title: '二手房对比'
        })}}
        {{_self.modal_layout({
            id: 'yx-enroll',
            btn: '[data-yx-btn=1]',
            fields: ['aid'],
            ajax: "ajax: {
                data : {
                    formflag: 'view_sale_intent',
                    aid: 0,
                    models: 'sale',
                    cate_pushs: 'syixiang',
                    type: 'sale',
                    formcls: 'common-form-lg common-form-control'
                }
            }"
        })}}
    {% endif %}
    {# 图片加载 #}
    {{core_global.lazyload()}}
{%- endmacro -%}

{# 说明
 * 使用模板: sale/xqlist
#}
{%- macro xiaoqu_list(o) -%}
    {% import "CoreBundle:Macro:global.html.twig" as core_global %}
    {% if o.list.data is defined and o.list.pageCount|default('') != 0 %}
        {% for item in o.list.data %}
        <!--item-->
        <div class="sale-list-item" {% if loop.last %}
            data-page="{
                pageCount: {{ o.list.pageCount }},
                pageIndex: {{ o.list.pageIndex }},
                pageSize: {{ o.list.pageSize }}
            }"{% endif %}>
            <div class="sale-item-l">
                <a href="{{('sale/qdetail')|U({id: item.id|default('')})}}" target="_blank">
                    {{- core_global.lazy_img({
                        src: item.thumb|default(''),
                        alt: item.name|default(''),
                        type: 2,
                        width: 120,
                        height: 120
                    }) -}}
                </a>
                <div class="sale-item-text">
                    <h3>
                        <a href="{{('sale/qdetail')|U({id: item.id|default('')})}}" target="_blank">{{item.name|default('')}}</a>
                        {{core_global.formData({value: item.cate_type|default(''), tpl: '<span>%value%</span>'})}}
                    </h3>
                    <p>
                         {{core_global.address({ data: item|default(''), default: ''})}}
                    </p>
                    <p>
                        <a href="{{('sale/qdplanintro')|U({id: item.id|default('')})}}" target="_blank">{{'户型'|trans({})}}
                            <span class="num">({{item.doornum|default('')}})</span>
                        </a>
                        <a href="{{('sale/qdphotos')|U({id: item.id|default('')})}}" target="_blank">
                            &nbsp;{{'相册'|trans({})}}
                            <span class="num">({{item.albumnum|default('')}})</span>
                        </a>
                        &nbsp;{{'人气'|trans({})}}&nbsp;:&nbsp;
                        <span>{{item.clicks|default('')}}</span>
                    </p>
                </div>
            </div>

            <div class="sale-item-r">
                <div class="v-b-r-l">
                    <p>
                        <i class="shou">{{'售'|trans({})}}</i>
                        &nbsp;
                        <a href="{{('sale/qdmai')|U({id:item.id|default('')})}}" target="_blank">
                            <span>{{item.sales|default(0)}}</span>{{'套'|trans({})}}
                        </a>
                    </p>
                    <p>{{'最高价'|trans({})}}&nbsp;:&nbsp;
                        {{_self.if_wy({value: item.sale_jgjj|default(''), default_tips: '-'})}}
                    </p>
                    <p>{{'最低价'|trans({})}}&nbsp;:&nbsp;
                        {{_self.if_wy({value: item.sale_jdjj|default(''), default_tips: '-'})}}
                    </p>
                </div>

                <div class="v-b-r-l margin">
                    <p>
                        <i class="zu">{{'租'|trans({})}}</i>
                        &nbsp;
                        <a href="{{('sale/qdzhu')|U({id: item.id|default('')})}}" target="_blank">
                            <span>{{item.rents|default(0)}}</span>{{'套'|trans({})}}
                        </a>
                    </p>
                    <p>{{'最高价'|trans({})}}&nbsp;:&nbsp;
                        {{_self.if_czj({value: item.rent_jgjj|default(''), default_tips: '-'})}}
                    </p>
                    <p>{{'最低价'|trans({})}}&nbsp;:&nbsp;
                        {{_self.if_czj({value: item.rent_jdjj|default(''), default_tips: '-'})}}
                    </p>
                </div>
            </div>
        </div>
        <!--/item-->
        {% endfor %}
    {% else %}
        <div class="noinfo">{{_self.list_tips('小区'|trans({}))}}</div>
    {% endif %}
    {# 图片加载 #}
    {{core_global.lazyload()}}
    </script>
{%- endmacro -%}

{# 说明
 * 使用模板: demand/list
#}
{%- macro demand_list(o) -%}
    {% import "CoreBundle:Macro:global.html.twig" as core_global %}
    {% if o.list.data is defined and o.list.pageCount|default(0) != 0 %}
        {% for item in o.list.data %}
            <!--item-->
            <div class="need-item">
                <span class="td1">
                    <a class="green" href="{{('demand/detail')|U({id:item.id|default('')})}}" target="_blank">{{item.name}}</a>
                </span>
                <span class="td2">{{_self.if_mj({value: item.mj|default(''), tpl: '%value%%danwei%'})}}</span>
                 <span class="td2">{{- _self.huxing({data: item|default(''), tpl: '%shi%%ting%'}) -}}</span>
                <span class="td3">
                    {% if item.type|default('') != 297 %}
                        {{_self.if_czj({value: item.zj|default(''), tpl: '<em class="c-e43">%value%</em>%danwei%'})}}
                    {% else %}
                        {{_self.if_wy({value: item.zj|default(''), tpl: '<em class="c-e43">%value%</em>%danwei%'})}}
                    {% endif %}
                </span>
                <span class="td4">{{item.xingming|default('游客')}}</span>
                <span class="new">{{core_global.timeformat({time: item.update_time|default('')})}}</span>
                <div class="blank0"></div>
            </div>
            <!--/item-->
        {% endfor %}
        {% else %}
        <div class="noinfo">{{_self.list_tips()}}</div>
    {% endif %}
{%- endmacro -%}

{# 说明
 * 使用模板: business/list
#}
{%- macro business_houses(o) -%}
    {% import "CoreBundle:Macro:global.html.twig" as core_global %}
    {% set opt = {
        action: 'detail',
    }|merge(o) %}
    {% if opt.list.data is defined and opt.list.pageCount|default(0) != 0 %}
        {% for item in opt.list.data %}

            {# 新房置顶 #}
            {% set item_top = (item.top|default('') == 159) ? 1 : 0 %}

            {# 新房建筑面积 #}
            {% set tpl_built_area = item.built_area|default('')|default('') %}

            {# 商铺/写字楼判断 #}
            {% if item.officetype|default('') %}
                {% set item_lp_con = 'officelevel,buildingfacilities' %}
                {% set tpl_cate_type = 'officetype' %}
                {% set tpl_type_name = '写字楼类型：' %}
            {% else %}
                {% set item_lp_con = 'shopindustry,buildingfacilities' %}
                {% set tpl_cate_type = 'shoptype' %}
                {% set tpl_type_name = '商铺类型：' %}
            {% endif %}

            <div class="sale-list-item">
                <!-- 左边 -->
                <div class="sale-item-l">
                    <div class="sale-item-img">
                        <a href="{{('business/' ~ opt.action)|U({id: item.id|default('')})}}" target="_blank">
                            {{- core_global.lazy_img({
                                src: item.thumb|default(''),
                                alt: item.name|default(''),
                                width: 180,
                                height: 135,
                                type: 2
                            }) -}}
                        </a>
                    </div>
                    <div class="sale-item-text">
                        <h3>
                            <a href="{{('business/' ~ opt.action)|U({id: item.id|default('')})}}" target="_blank">
                                {{item.name|default('')}}
                            </a>
                            {% if item_top %}
                                <span class="tu tu-2">置顶</span>
                            {% endif %}
                        </h3>
                        <p>
                            {{core_global.address({data:item|default(''), default: '', num: 100})}}
                        </p>
                        <p class="fan">
                            {{_self.lptag({value: item, con: tpl_cate_type, tpl: tpl_type_name ~ '<span>%value%</span>'})}}
                        </p>
                        <p class="fan">
                          电话&nbsp;:&nbsp;
                          <span>{{item.tel|default('-')}}</span>
                        </p>
                        <p class="tags">
                            {{- _self.lptag({value: item, con: item_lp_con, tpl: '<span>%value%</span>'}) -}}
                        </p>
                    </div>
                </div>
                <!-- 右边 -->
                <div class="sale-item-r">
                    <p>
                        {{_self.if_dj({value: item.dj|default(''), class: 'big'})}}
                    </p>

                    {{_self.if_mj({value: tpl_built_area, tpl: '<p>建筑面积&nbsp;&nbsp;<span>%value%</span>%danwei%</p>'})}}

                    <p>
                        开盘日期：{{detail.kpsm|default(core_global.time_date({time: item.kpdate.date|default('-')}))}}
                    </p>
                </div>
            </div>
        {% endfor %}
    {% else %}
        <div class="noinfo">{{_self.list_tips('写字楼楼盘'|trans({}))}}</div>
    {% endif %}

    {# 图片加载 #}
    {{core_global.lazyload()}}
{%- endmacro -%}

{# 说明
 * 使用模板: business/ssalelist   business/xsalelist
#}
{%- macro business_sale(o) -%}
    {% import "CoreBundle:Macro:global.html.twig" as core_global %}
    {% set opt = {
        action: 'sdetail',
        tips: ''
    }|merge(o) %}
    {% if opt.list.data is defined and opt.list.pageCount|default(0) != 0 %}
        {# 列表会员id合集 #}
        {% set list_users_ids = '' %}
        {# 组装用户表数据 #}
        {% set list_users = {} %}
        {# 组装userinfo表数据 #}
        {% set list_userinfo = {} %}
        {# 经纪公司id合集 #}
        {% set list_jjgs_ids = '' %}
        {# 经纪公司属性表id合集 #}
        {% set list_jjgs_attr_ids = '' %}
        {# 经纪公司属性id #}
        {% set list_jjgs_attr_id_data = {} %}
        {# 组装经纪公司属性 #}
        {% set list_jjgs_attr = {} %}

        {# 列表经纪人id合集 #}
        {% for item in opt.list.data %}
            {% if loop.index != 1 %}
                {% set dh = ',' %}
            {% endif %}
            {% set list_users_ids = list_users_ids ~ dh|default('') ~ item.uid %}
        {% endfor %}

        {# 列表会员数据 #}
        {% set list_users_data = ('db.users')|getAll({id: 'in|' ~ list_users_ids, pageSize: opt.list.pageSize}) %}

        {# 经纪人数据 #}
        {% for item in list_users_data.data %}
            {% set list_users = {
                ('users' ~ item.id): item.username
            }|merge(list_users) %}
        {% endfor %}

        {# userinfo 数据 #}
        {% set list_userinfo_data = ('db.userinfo')|getAll({uid: 'in|' ~ list_users_ids, pageSize: opt.list.pageSize}) %}

        {# 组装经纪人userinfo数据，所属经纪公司id合集 #}
        {% for item in list_userinfo_data.data %}
            {% set list_userinfo = {
                ('userinfo' ~ item.uid): {
                    'nicename': item.nicename,
                    'cid': item.cid,
                    'usertype': item.usertype
                }
            }|merge(list_userinfo) %}
            {% if loop.index != 1 %}
                {% set dh = ',' %}
            {% endif %}
            {% set list_jjgs_ids = list_jjgs_ids ~ dh|default('') ~ item.cid %}
        {% endfor %}

        {# 经纪公司数据 #}
        {% set list_jjgs_userinfo = ('db.userinfo')|getAll({uid: 'in|' ~ list_jjgs_ids, pageSize: opt.list.pageSize}) %}

        {# 获取经纪公司属性id合集 #}
        {% for item in list_jjgs_userinfo.data %}
            {% if loop.index != 1 %}
                {% set dh = '' %}
            {% endif %}
            {% set list_jjgs_attr_ids = list_jjgs_attr_ids ~ dh|default('') ~ item.id %}
            {% set list_jjgs_attr_id_data = {
                ('cid' ~ item.uid): item.id
            }|merge(list_jjgs_attr_id_data) %}
        {% endfor %}

        {# 经纪公司属性数据 #}
        {% set list_jjgs_attr_data = ('db.user_attr')|getAll({name: 'in|company,cpltd', pageSize: opt.list.pageSize * 2, mid: "in|" ~ list_jjgs_attr_ids}) %}

        {# 组装经纪公司属性数据 #}
        {% for item in list_jjgs_attr_data.data %}
            {% set list_jjgs_attr = {
                (item.name ~ item.mid): item.value
            }|merge(list_jjgs_attr) %}
        {% endfor %}
        {% for item in opt.list.data %}
            {# 当前用户userinfo数据 #}
            {% set item_userinfo = list_userinfo['userinfo' ~ item.uid]|default({}) %}
            {# 用户名 #}
            {% set user_name = item_userinfo.nicename|default(list_users['users' ~ item.uid]|default('-')) %}
            {# 用户类型 #}
            {% set user_type = item_userinfo.usertype|default('') %}
            {# 经纪公司id #}
            {% set user_jjgs_id = item_userinfo.cid|default('') %}
            {# 经纪公司属性id #}
            {% set user_jjgs_attr_id = list_jjgs_attr_id_data['cid' ~ user_jjgs_id]|default('') %}
            {# 经纪公司名称 先读全称，再读简写 #}
            {% set user_jjgs_name = list_jjgs_attr['company' ~ user_jjgs_attr_id]|default(list_jjgs_attr['cpltd' ~ user_jjgs_attr_id]|default('')) %}
            {# 根据用户类型判断显示 #}
            {% if user_type == 15 %}
                {% set item_user_data = '<a href="' ~ ('member/detail')|U({id: user_jjgs_id}) ~ '" target="_blank" class="ps mr5">' ~ user_jjgs_name ~ '</a><a href="' ~ ('member/j_detail')|U({id: item.uid}) ~ '" target="_blank" class="ps c-e43"><i class="font-icons-2 mr5" style="vertical-align: -1px;"></i>' ~ user_name ~ '</a><span class="new mr10">(经纪人)</span>' %}
            {% else %}
                {% set item_user_data = user_name ~ '<span class="new">(个人)</span>' %}
            {% endif %}

            {# 出租、二手置顶 #}
            {% set item_top = (item.zjdate|default('') >= ('now')|date('U')) ? 1 : 0 %}
            {# 出租、二手建筑面积 #}
            {% set tpl_built_area = item.mj|default('') %}

            {# 商铺/写字楼判断 #}
            {% if item.officetype|default('') %}
                {% set item_tag_con = 'officetype,officelevel,office_ts' %}
                {% set tpl_cate_type = 'officetype' %}
                {% set tpl_type_name = '写字楼类型：' %}
            {% else %}
                {% set item_tag_con = 'shoptype,shopindustry,shops_ts' %}
                {% set tpl_cate_type = 'shoptype' %}
                {% set tpl_type_name = '商铺类型：' %}
            {% endif %}

            <div class="sale-list-item">
                <!-- 左边 -->
                <div class="sale-item-l">
                    <div class="sale-item-img">
                        <a href="{{('business/' ~ opt.action)|U({id: item.id|default('')})}}" target="_blank">
                        {{- core_global.lazy_img({
                            src: item.thumb|default(''),
                            alt: item.name|default(''),
                            width: 180,
                            height: 135,
                            type: 2
                        }) -}}
                        </a>
                    </div>
                    <div class="sale-item-text">
                        <h3>
                            <a href="{{('business/' ~ opt.action)|U({id: item.id|default('')})}}" target="_blank">
                                {{item.name|default('')}}
                            </a>
                            {% if item_top %}
                                <span class="tu tu-2">置顶</span>
                            {% endif %}
                        </h3>
                        <p>
                            {{core_global.address({data:item|default(''), default: '', num: 100})}}
                        </p>
                        <p class="fang">
                            {{core_global.if({value: '' ~ core_global.formData({value: item.fl|default(''), default: ''}) ~ '', tpl: '<span>房龄: %value%</span>', default: ''})}}
                            {{core_global.if({value: item.szlc|default(''), tpl: ' / <span>%value%/' ~ item.zlc|default('') ~ '层</span>'})}}
                            {{- _self.lptag({value: item, tpl: '&nbsp;/ <span>%value%</span>', con: 'zxcd,cx'}) -}}
                        </p>
                        <p>
                            {# 公用获取对应用户方法，此方法每条数据都会查询对应的表，耗性能 #}
                            {# {{- _self.publisher_list(item.uid|default('')) -}} #}
                            {# 方法二，一次查询出来，然后再找，此方式有点绕 #}
                            {{item_user_data|raw}}
                            <span class="new">{{core_global.timeformat({time: item.update_time|default('')})}}</span>
                        </p>
                        <p class="tags mt5">
                            {{- _self.lptag({value: item, con: item_tag_con, tpl: '<span>%value%</span>'}) -}}
                        </p>
                    </div>
                </div>
                <!-- 右边 -->
                <div class="sale-item-r">
                    <p>
                        {{_self.if_wy({value: item.zj|default(''), class: 'big'})}}
                    </p>

                    {{_self.if_mj({value: tpl_built_area, tpl: '<p>建筑面积&nbsp;&nbsp;<span>%value%</span>%danwei%</p>'})}}

                    <p class="dj">
                        单价&nbsp;&nbsp;{{_self.if_dj({value: item.dj|default('')})}}
                    </p>
                    <p class="buy mt10">
                        {% set name = core_global.substr(item.name|default(''), 20, 1) %}
                        {{_self.modal_btn({
                            id: 'yx-enroll',
                            attr: 'data-yx-btn="1"',
                            opt: "{name: '" ~ name|trim() ~ "', aid: '" ~ item.id|default(0) ~ "'}",
                            class: 'form-bdrs',
                            title: '我有意向',
                            icon: 'font-lp-29',
                        })}}
                        {# 对比按钮 #}
                        {{_self.compare_btn({
                            id: item.id|default(''),
                            title: item.name|default(''),
                            url: ('business/' ~ opt.action)|U({id:item.id|default('')})
                        })}}
                    </p>
                </div>
            </div>
        {% endfor %}
    {% else %}
        <div class="noinfo">{{_self.list_tips(opt.tips ~ '出售'|trans({}))}}</div>
    {% endif %}
    {# 对比 #}
    {{_self.compare_tpl({
        chid: 3,
        title: opt.tips ~ '出售对比'
    })}}
    {{_self.modal_layout({
        id: 'yx-enroll',
        btn: '[data-yx-btn=1]',
        fields: ['aid'],
        ajax: "ajax: {
            data : {
                formflag: 'view_sale_intent',
                aid: 0,
                models: 'sale',
                cate_pushs: 'syixiang',
                type: 'sale',
                formcls: 'common-form-lg common-form-control'
            }
        }"
    })}}
    {{core_global.lazyload()}}
{%- endmacro -%}
{# 说明
 * 使用模板: business/srentlist   business/xrentlist
#}
{%- macro business_rent(o) -%}
    {% import "CoreBundle:Macro:global.html.twig" as core_global %}
    {% set opt = {
        action: 'rdetail',
        tips: '',
        method: ''
    }|merge(o) %}
    {% if opt.list.data is defined and opt.list.pageCount|default(0) != 0 %}
        {# 列表会员id合集 #}
        {% set list_users_ids = '' %}
        {# 组装用户表数据 #}
        {% set list_users = {} %}
        {# 组装userinfo表数据 #}
        {% set list_userinfo = {} %}
        {# 经纪公司id合集 #}
        {% set list_jjgs_ids = '' %}
        {# 经纪公司属性表id合集 #}
        {% set list_jjgs_attr_ids = '' %}
        {# 经纪公司属性id #}
        {% set list_jjgs_attr_id_data = {} %}
        {# 组装经纪公司属性 #}
        {% set list_jjgs_attr = {} %}

        {# 列表经纪人id合集 #}
        {% for item in opt.list.data %}
            {% if loop.index != 1 %}
                {% set dh = ',' %}
            {% endif %}
            {% set list_users_ids = list_users_ids ~ dh|default('') ~ item.uid %}
        {% endfor %}

        {# 列表会员数据 #}
        {% set list_users_data = ('db.users')|getAll({id: 'in|' ~ list_users_ids, pageSize: opt.list.pageSize}) %}

        {# 经纪人数据 #}
        {% for item in list_users_data.data %}
            {% set list_users = {
                ('users' ~ item.id): item.username
            }|merge(list_users) %}
        {% endfor %}

        {# userinfo 数据 #}
        {% set list_userinfo_data = ('db.userinfo')|getAll({uid: 'in|' ~ list_users_ids, pageSize: opt.list.pageSize}) %}

        {# 组装经纪人userinfo数据，所属经纪公司id合集 #}
        {% for item in list_userinfo_data.data %}
            {% set list_userinfo = {
                ('userinfo' ~ item.uid): {
                    'nicename': item.nicename,
                    'cid': item.cid,
                    'usertype': item.usertype
                }
            }|merge(list_userinfo) %}
            {% if loop.index != 1 %}
                {% set dh = ',' %}
            {% endif %}
            {% set list_jjgs_ids = list_jjgs_ids ~ dh|default('') ~ item.cid %}
        {% endfor %}

        {# 经纪公司数据 #}
        {% set list_jjgs_userinfo = ('db.userinfo')|getAll({uid: 'in|' ~ list_jjgs_ids, pageSize: opt.list.pageSize}) %}

        {# 获取经纪公司属性id合集 #}
        {% for item in list_jjgs_userinfo.data %}
            {% if loop.index != 1 %}
                {% set dh = '' %}
            {% endif %}
            {% set list_jjgs_attr_ids = list_jjgs_attr_ids ~ dh|default('') ~ item.id %}
            {% set list_jjgs_attr_id_data = {
                ('cid' ~ item.uid): item.id
            }|merge(list_jjgs_attr_id_data) %}
        {% endfor %}

        {# 经纪公司属性数据 #}
        {% set list_jjgs_attr_data = ('db.user_attr')|getAll({name: 'in|company,cpltd', pageSize: opt.list.pageSize * 2, mid: "in|" ~ list_jjgs_attr_ids}) %}

        {# 组装经纪公司属性数据 #}
        {% for item in list_jjgs_attr_data.data %}
            {% set list_jjgs_attr = {
                (item.name ~ item.mid): item.value
            }|merge(list_jjgs_attr) %}
        {% endfor %}
        {% for item in opt.list.data %}
            {# 当前用户userinfo数据 #}
            {% set item_userinfo = list_userinfo['userinfo' ~ item.uid]|default({}) %}
            {# 用户名 #}
            {% set user_name = item_userinfo.nicename|default(list_users['users' ~ item.uid]|default('-')) %}
            {# 用户类型 #}
            {% set user_type = item_userinfo.usertype|default('') %}
            {# 经纪公司id #}
            {% set user_jjgs_id = item_userinfo.cid|default('') %}
            {# 经纪公司属性id #}
            {% set user_jjgs_attr_id = list_jjgs_attr_id_data['cid' ~ user_jjgs_id]|default('') %}
            {# 经纪公司名称 先读全称，再读简写 #}
            {% set user_jjgs_name = list_jjgs_attr['company' ~ user_jjgs_attr_id]|default(list_jjgs_attr['cpltd' ~ user_jjgs_attr_id]|default('')) %}
            {# 根据用户类型判断显示 #}
            {% if user_type == 15 %}
                {% set item_user_data = '<a href="' ~ ('member/detail')|U({id: user_jjgs_id}) ~ '" target="_blank" class="ps mr5">' ~ user_jjgs_name ~ '</a><a href="' ~ ('member/j_detail')|U({id: item.uid}) ~ '" target="_blank" class="ps c-e43"><i class="font-icons-2 mr5" style="vertical-align: -1px;"></i>' ~ user_name ~ '</a><span class="new mr10">(经纪人)</span>' %}
            {% else %}
                {% set item_user_data = user_name ~ '<span class="new">(个人)</span>' %}
            {% endif %}

            {# 出租、二手置顶 #}
            {% set item_top = (item.zjdate|default('') >= ('now')|date('U')) ? 1 : 0 %}
            {# 出租、二手建筑面积 #}
            {% set tpl_built_area = item.mj|default('') %}

            {# 商铺/写字楼判断 #}
            {% if item.officetype|default('') %}
                {% set item_tag_con = 'officetype,officelevel,office_ts' %}
                {% set tpl_cate_type = 'officetype' %}
                {% set tpl_type_name = '写字楼类型：' %}
            {% else %}
                {% set item_tag_con = 'shoptype,shopindustry,shops_ts' %}
                {% set tpl_cate_type = 'shoptype' %}
                {% set tpl_type_name = '商铺类型：' %}
            {% endif %}

            <div class="sale-list-item">
                <!-- 左边 -->
                <div class="sale-item-l">
                    <div class="sale-item-img">
                        <a href="{{('business/' ~ opt.action)|U({id: item.id|default('')})}}" target="_blank">
                        {{- core_global.lazy_img({
                            src: item.thumb|default(''),
                            alt: item.name|default(''),
                            width: 180,
                            height: 135,
                            type: 2
                        }) -}}
                        </a>
                    </div>
                    <div class="sale-item-text">
                        <h3>
                            <a href="{{('business/' ~ opt.action)|U({id: item.id|default('')})}}" target="_blank">
                                {{item.name|default('')}}
                            </a>
                            {% if item_top %}
                                <span class="tu tu-2">置顶</span>
                            {% endif %}
                        </h3>
                        <p>
                            {{core_global.address({data:item|default(''), default: '', num: 100})}}
                        </p>
                        <p class="fang">
                            {{core_global.if({value: '' ~ core_global.formData({value: item.fl|default(''), default: ''}) ~ '', tpl: '<span>房龄: %value%</span>', default: ''})}}
                            {{core_global.if({value: item.szlc|default(''), tpl: ' / <span>%value%/' ~ item.zlc|default('') ~ '层</span>'})}}
                            {{- _self.lptag({value: item, tpl: '&nbsp;/ <span>%value%</span>', con: 'zxcd,cx'}) -}}
                        </p>
                        <p>
                            {# 公用获取对应用户方法，此方法每条数据都会查询对应的表，耗性能 #}
                            {# {{- _self.publisher_list(item.uid|default('')) -}} #}
                            {# 方法二，一次查询出来，然后再找，此方式有点绕 #}
                            {{item_user_data|raw}}
                            <span class="new">{{core_global.timeformat({time: item.update_time|default('')})}}</span>
                        </p>
                        <p class="tags mt5">
                            {{- _self.lptag({value: item, con: item_tag_con, tpl: '<span>%value%</span>'}) -}}
                        </p>
                    </div>
                </div>
                <!-- 右边 -->
                <div class="sale-item-r">
                    <p>
                        {{attribute(_self, opt.method, [{class: 'big', value: item.czj|default('')}])}}
                    </p>

                    {{_self.if_mj({value: tpl_built_area, tpl: '<p>建筑面积&nbsp;&nbsp;<span>%value%</span>%danwei%</p>'})}}
                    <p class="buy mt10">
                        {% set name = core_global.substr(item.name|default(''), 20, 1) %}
                        {{_self.modal_btn({
                            id: 'yx-enroll',
                            attr: 'data-yx-btn="1"',
                            opt: "{name: '" ~ name|trim() ~ "', aid: '" ~ item.id|default(0) ~ "'}",
                            class: 'form-bdrs',
                            title: '我有意向',
                            icon: 'font-lp-29',
                        })}}
                        {# 对比按钮 #}
                        {{_self.compare_btn({
                            id: item.id|default(''),
                            title: item.name|default(''),
                            url: ('business/' ~ opt.action)|U({id:item.id|default('')})
                        })}}
                    </p>
                </div>
            </div>
        {% endfor %}
    {% else %}
        <div class="noinfo">{{_self.list_tips(opt.tips ~ '出租'|trans({}))}}</div>
    {% endif %}
    {# 对比 #}
    {{_self.compare_tpl({
        chid: 2,
        title: opt.tips ~ '出租对比'
    })}}
    {{_self.modal_layout({
        id: 'yx-enroll',
        btn: '[data-yx-btn=1]',
        fields: ['aid'],
        ajax: "ajax: {
            data : {
                formflag: 'view_sale_intent',
                aid: 0,
                models: 'rent',
                cate_pushs: 'syixiang',
                type: 'sale',
                formcls: 'common-form-lg common-form-control'
            }
        }"
    })}}
    {{core_global.lazyload()}}
{%- endmacro -%}

{# 经纪公司
 * 使用模板 member/list
 #}
{%- macro member_list(o) -%}
    {% import "CoreBundle:Macro:global.html.twig" as core_global %}
    {% set opt = {
    }|merge(o) %}
    {% spaceless %}
        {% if opt.list.data is defined and opt.list.pageCount|default(0) != 0 %}
            {# userinfo uid合集变量 #}
            {% set userinfo_uids = '' %}
            {# users data #}
            {% set users_data = '' %}
            {# users data all #}
            {% set user_data = {} %}

            {# 获取user id合集 #}
            {% for item in opt.list.data %}
                {% if loop.index != 1 %}
                    {% set dh = ',' %}
                {% endif %}
                {% set userinfo_uids = userinfo_uids ~ dh|default('') ~ item.uid %}
            {% endfor %}

            {% set users_data = ('db.users')|getAll({id: 'in|' ~ userinfo_uids, pageSize: o.list.pageSize}) %}

            {% for item in users_data.data %}
                {% set user_data = user_data|merge({
                    ('user' ~ item.id): {
                        tel: item.tel,
                        username: item.username
                    }
                }) %}
            {% endfor %}

            {% for item in opt.list.data %}
                {# 获取userinfo对应的id #}
                {% set item_userinfo_id = users_data['users' ~ item.id].id|default('') %}

                {# 名称 公司名称 》公司简称 》昵称 》用户名 #}
                {% set item_name = item.company|default(item.cpltd|default(item.nicename|default(user_data['user' ~ item.uid].username|default('')))) %}

                <div class="cmp-box" {% if loop.last and loop.length % 2 == 1 %}style="width: 100%;"{% endif %}
                    {% if loop.last %}
                    data-page="{
                        pageIndex: {{ opt.list.pageIndex }},
                        pageSize: {{ opt.list.pageSize }},
                        pageCount: {{ opt.list.pageCount }}
                    }"
                    {% endif %} >
                    <div class="c-b-l">
                        <a href="{{('member/detail')|U({id: item.uid|default('')})}}" target="_blank">
                            {{- core_global.lazy_img({
                                src: item.image|default(''),
                                alt: item_name|default(''),
                                width: 160,
                                height: 90,
                                type: 2
                            }) -}}
                        </a>
                        <div class="cmp-text">
                            <p>
                                <a href="{{('member/detail')|U({id: item.uid|default('')})}}" target="_blank">
                                    {{item_name|default('')|trans({})}}
                                </a>
                            </p>
                            <p>
                               电话&nbsp;:&nbsp; <b>{{user_data['user' ~ item.uid].tel|default('-')}}</b>
                            </p>
                            <p>
                                地址&nbsp;:&nbsp;
                                <span>
                                    {{item.caddress|default('-')}}
                                </span>
                            </p>
                            <p>
                                房源&nbsp;:&nbsp;售(
                                <span class="num">{{item.csales|default(0)}}</span>
                                )&nbsp;&nbsp;租(
                                <span class="num">{{item.crents|default(0)}}</span>
                                )
                            </p>
                        </div>
                    </div>
                </div>
            {% endfor %}
          {% else %}
            <div class="noinfo">{{_self.list_tips('经纪公司'|trans({}))}}</div>
        {% endif %}
        {{core_global.lazyload()}}
        <script type="text/javascript">
            seajs.use(['formattime'], function (formattime) {})
        </script>
    {% endspaceless %}
{%- endmacro -%}

{# 经纪人列表
 * 模板  member/list
 #}
{%- macro member_j_list(o) -%}
    {% import "CoreBundle:Macro:global.html.twig" as core_global %}
    {% set opt = {
    }|merge(o) %}
    {% spaceless %}
        {% if opt.list.data is defined %}
            {% for item in opt.list.data %}
                {% set item_user_info = ('db.userinfo')|getRow({uid: item.id|default('')}) %}
                {% set item_name = item_user_info.nicename|default(item.username|default('')) %}
                <div class="sale-list-item" {% if loop.last %}
                data-page="{
                    pageIndex: {{ opt.list.pageIndex }},
                    pageSize: {{ opt.list.pageSize }},
                    pageCount: {{ opt.list.pageCount }}
                }"
                {% endif %}>
                    <div class="sale-item-l">
                        <div class="sale-item-img">
                            <a href="{{('member/j_detail')|U({id: item.id|default('')})}}" target="_blank">
                                {{- core_global.img({
                                    src: item_user_info.image|default(''),
                                    alt: item_name|default(''),
                                    width: 100,
                                    height: 130,
                                    type: 2
                                }) -}}
                            </a>
                        </div>
                        <div class="sale-item-text">
                            <h3>
                                <a class="name" href="{{('member/j_detail')|U({id: item.id|default('')})}}" target="_blank">
                                    {{item_name|default('')}}
                                </a>
                            </h3>
                                <p><i class="shou">{{'售'|trans({})}}</i>
                                &nbsp;
                                <span>{{item_user_info.sales|default('0')}}</span>
                                {{'套'|trans({})}}

                                <i class="zu">{{'租'|trans({})}}</i>
                                &nbsp;
                                <span>{{item_user_info.rents|default('0')}}</span>
                                {{'套'|trans({})}}
                                <a href="{{('member/j_detail')|U({id: item.id|default('')})}}" target="_blank" class="shop">{{'进入店铺'|trans({})}}</a>
                            </p>
                            <p>
                                {{'联系电话'|trans({})}}&nbsp;:&nbsp; <b>{{item.tel|default('')}}</b>
                            </p>
                            <p>
                                {{'服务区域'|trans({})}}&nbsp;:&nbsp;
                                <span>{{core_global.region({id: item_user_info.region|default(''), tpl: '%value%'})}}</span>
                            </p>
                            {{ _self.publisher({
                                id: item.id|default(''),
                                jjr_tpl: '<p>所属公司&nbsp;:&nbsp;<a href="%url%" target="_blank" class="c-e43">%jjgs_name%</a></p><p class="jjr-list-rz"><span>
                                %fwdj%%idcard%%license%
                            </span></p>'
                            }) }}
                        </div>
                    </div>
                    {# 经纪人旗下二手房 #}
                    {% set jjr_sale = ('house.sale')|getAll({checked: 1, pageSize: 3, uid: item.id|default(''), valid: 'gt|' ~ ('now')|date('U')}) %}
                    <div class="sale-item-r">
                        <ul>
                            {% if jjr_sale.data is defined %}
                                {% for sale in jjr_sale.data %}
                                    <li>
                                        <p>
                                            <i class="shou">{{'售'|trans({})}}</i>
                                            <a href="{{('sale/detail')|U({id: sale.id|default('')})}}" target="_blank">
                                                {{core_global.region({id: sale.region|default('')})}}
                                                {{sale.name|default('')}}
                                            </a>
                                        </p>
                                        <p class="p2">
                                            {{_self.if_wy({value: sale.zj|default('')})}}&nbsp;
                                            {{- _self.huxing({data: sale|default(''), tpl: '%shi%%ting%%wei%' }) -}}&nbsp;
                                            {{_self.if_mj({value: sale.mj|default('')})}}
                                        </p>
                                    </li>
                                {% endfor %}
                            {% endif %}
                        </ul>
                    </div>
                </div>
            {% endfor %}
        {% else %}
            <div class="noinfo">{{_self.list_tips('经纪人'|trans({}))}}</div>
        {% endif %}
        {{core_global.lazyload()}}
    {% endspaceless %}
{%- endmacro -%}

{# 开发商
 * 模板  member/k_list
#}
{%- macro member_k_list(o) -%}
    {% import "CoreBundle:Macro:global.html.twig" as core_global %}
    {% spaceless %}
        {% if o.list.data is defined and o.list.pageCount|default(0) != 0 %}
            {# users id合集变量 #}
            {% set userinfo_uids = '' %}
            {# users data #}
            {% set users_data = '' %}
            {# users data all #}
            {% set user_data = {} %}

            {# 获取user id合集 #}
            {% for item in o.list.data %}
                {% if loop.index != 1 %}
                    {% set dh = ',' %}
                {% endif %}
                {% set userinfo_uids = userinfo_uids ~ dh|default('') ~ item.uid %}
            {% endfor %}

            {% set users_data = ('db.users')|getAll({id: 'in|' ~ userinfo_uids, pageSize: o.list.pageSize}) %}

            {% for item in users_data.data %}
                {% set user_data = user_data|merge({
                    ('user' ~ item.id): {
                        tel: item.tel,
                        username: item.username
                    }
                }) %}
            {% endfor %}

            {% for item in o.list.data %}
            {# 名称 公司名称 》公司简称 》昵称 》用户名 #}
            {% set item_name = item.company|default(item.cpltd|default(item.nicename|default(user_data['user' ~ item.uid].username|default('')))) %}

            <li class="item">
                <a href="{{('member/k_detail')|U({id: item.uid|default('')})}}" target="_blank" class="img">
                    {{- core_global.lazy_img({
                        src: item.image|default(''),
                        alt: item_name|default(''),
                        type: 2,
                        width:120 ,
                        height: 90
                    }) -}}
                </a>
                <div class="info">
                    <p>
                        <i class="font-icons-22"></i>
                        <a href="{{('member/k_detail')|U({id: item.uid|default('')})}}" target="_blank">
                            {{item_name|default('')|trans({})}}
                        </a>
                    </p>
                    <p class="tel">
                        {{user_data['user' ~ item.uid].tel|default('')}}
                    </p>
                    <p class="add">
                        {{item.companyadr|default('')}}
                    </p>
                </div>
            </li>
            {% endfor %}
        {% else %}
             <div class="noinfo">{{_self.list_tips('开发商'|trans({}))}}</div>
        {% endif %}
        {{core_global.lazyload()}}
    {% endspaceless %}
{%- endmacro -%}

{# 资讯列表
 * 模板  houses/dnews   business/dnews   news/index   news/list
#}
{%- macro news_list(o) -%}
    {% import "CoreBundle:Macro:global.html.twig" as core_global %}
    {% spaceless %}
        {% if o.list.data is defined and o.list.pageCount|default('') != 0 %}
            {% for item in o.list.data %}
                {% set item_url = core_global.url(item|merge({models: 'news'})) %}
                {% set item_id = item.fromid|default('') ? item.fromid|default('') : item.id|default('') %}
                <div class="xwzxlist clearfix">
                    <span class="listl">
                        <a href="{{item_url}}" target="_blank">
                            {{- core_global.lazy_img({
                                src: item.thumb|default(''),
                                alt: item.name|default(''),
                                type: 2,
                                width: 180,
                                height: 120
                            }) -}}
                        </a>
                    </span>
                    <h3>
                        <a href="{{item_url}}" target="_blank">{{item.name|default('')|trans({})}}</a>
                    </h3>
                    <p>
                        {{core_global.substr(item.abstract|default(''), 55, 1)}}
                        <a href="{{item_url}}" target="_blank">{{'阅读原文'|trans({})}}</a>
                    </p>
                    <div class="mt5">
                        <span class="c-ccc ico-word">
                            <i class="font-icons-23"></i>
                            {{item.create_time|default('')|date('Y-m-d')}}
                            <i class="font-icons-18 ml10"></i><span  data-counts="{models: 'news', field: 'clicks', id: '{{item_id}}'}"></span>
                        </span>
                    </div>
                </div>
            {% endfor %}
        {% else %}
            <div class="noinfo">{{_self.list_tips(o.tips|default(''))}}</div>
        {% endif %}
        {{core_global.lazyload()}}
    {% endspaceless %}
{%- endmacro -%}

{# 特价房列表
 * 模板  houses/dspehouse   specail/list
 #}
{%- macro specail_list(o) -%}
    {% import "CoreBundle:Macro:global.html.twig" as core_global %}
    {% spaceless %}
        {% if o.list.data is defined and o.list.pageCount|default('0') != 0 %}
            {%- for item in o.list.data -%}
                <li class="list-item clearfix">
                    <div class="pic fl">
                        <a href="{{('special/detail')|U({id: item.id|default('')})}}" target="_blank">
                            {{- core_global.lazy_img({
                                src: item.thumb|default(''),
                                alt: item.name|default(''),
                                type: 2,
                                width: 160,
                                height: 120
                            }) -}}
                        </a>
                    </div>
                    <div class="info fl">
                        <h3>
                            {% if item.top|default('') == 159 %}
                            <div class="zd fl clearfix">
                                <div class="fl c-e43">{{'置'|trans({})}}</div>
                                <div class="fr c-fff">{{'顶'|trans({})}}</div>
                            </div>
                            {% endif %}
                            <span class="fr c-666 fz14">
                                {{_self.if_mj({value: item.mj|default(''), class: 'fz18 c-e43'})}}
                            </span>
                            <a href="{{('special/detail')|U({id: item.id|default('')})}}" target="_blank" class="tit">
                                 {{item.name|default('')}}
                            </a>
                        </h3>
                        <p>
                            {{item.lpmc|default('-')}}
                        </p>
                        <p>
                            {{- _self.huxing({data: item|default(''), tpl: '%shi%%ting%%wei%%chu% | ', default: ''}) -}}
                            {{core_global.if({value: item.szlc|default(''), tpl: '&nbsp;'~('第'|trans({}))~'%value%'~('层'|trans({}))})}}
                            {{core_global.if({value: item.zlc|default(''), tpl: '('~('共'|trans({}))~'%value%'~('层'|trans({}))~')'})}}
                            {{core_global.if({value: item.tel|default(''), tpl: '&nbsp;|&nbsp;电话：<span class="c-e43">%value%</span>'})}}
                        </p>
                        <p class="tj-tag mt5">
                            {{- _self.lptag({value: item|default(''), tpl: '<span>%value%</span>', con: 'cate_status,louxing,zxcd,cx'}) -}}
                        </p>
                    </div>
                    <div class="other fr">
                        <p>
                          {% if item.zj %}<span class="c-666 fz12">￥</span>{% endif %}
                          {{_self.if_wy({value: item.zj|default(''), class: 'total-price'})}}
                        </p>
                        <p class="yj c-999">
                            {{_self.if_wy({value: item.yj|default(''), tpl: '%value%%danwei%'})}}
                        </p>
                    </div>
                    <div class="blank20"></div>
                </li>
            {%- endfor -%}
        {% else %}
            <div class="noinfo">{{_self.list_tips(o.tips|default(''))}}</div>
        {% endif %}
        {{core_global.lazyload()}}
    {% endspaceless %}
{%- endmacro -%}

{# 问答列表
 * 模板  houses/dask   ask/index   ask/list
 #}

{%- macro ask_list(o) -%}
    {% import "CoreBundle:Macro:global.html.twig" as core_global %}
    {% spaceless %}
        {% if o.list.data is defined and o.list.data|default('') %}
            {# 高分标记设置获取 #}
            {% set mconfigAskcurrency = core_global.mconfigtostring({name: 'askcurrency', ename: 'mother'}).__toString %}
            {% for item in o.list.data %}
                {% set item_id = item.fromid|default('') ? item.fromid|default('') : item.id|default('') %}
                <div class="ask-list-item">
                    <div class="ask-item-left">
                        <i class="font-ask-2"></i>
                        <a title="{{item.name|default('')}}" href="{{- core_global.url(item|merge({models: 'ask'})) -}}" target="_blank" class="ask-item-text">{{core_global.substr(item.name|default('户型'), 40, 1)}}</a>
                        {% if item.currency|default('') >= mconfigAskcurrency %}
                            <span class="icon icon1">高分</span>
                        {% endif %}

                        {% if item.jinghua|default('') == 1 %}
                            <span class="icon icon2">精华</span>
                        {% endif %}

                        {% if item.solved|default('') == 1 %}
                            <span class="icon icon3">解决</span>
                        {% else %}
                            <span class="icon icon4">未解</span>
                        {% endif %}
                    </div>
                    <div class="ask-item-right">
                        <span class="num"><i data-counts="{models: 'ask', field: 'asknum', id: '{{item_id }}'}"></i></span>
                        回答
                        <span>{{item.create_time|default('')|date('Y-m-d')}}</span>
                    </div>
                </div>
            {% endfor %}
            {% else %}
            <div class="noinfo">{{_self.list_tips(o.tips|default(''))}}</div>
        {% endif %}
    {% endspaceless %}
{%- endmacro -%}

{# 学区列表
 * 模板   sale/xlist
#}
{%- macro school_list(o) -%}
    {% import "CoreBundle:Macro:global.html.twig" as core_global %}
    {% spaceless %}
        {% if o.list.data is defined and o.list.pageCount|default(0) != 0 %}
            {% for item in o.list.data %}
            {# zhoubian 查找当前学校中有哪些楼盘、小区 #}
            {% set zhoubian = ('house.houses_arc')|getCol('aid', { cate_pushs: 'zhoubian', fromid: item.id|default(''), checked: 1})|join(',') %}

            {% set houses = ('house.houses')|getAll({id: 'in|' ~ zhoubian, checked: 1, type: 1, pageSize: 4}) %}

            <li>
                <div class="photo">
                    <a target="_blank" href="{{('sale/xdetail')|U({id: item.id|default('')})}}">
                        {{- core_global.lazy_img({
                            src: item.thumb|default(''),
                            alt: item.name|default(''),
                            width: 180,
                            height: 138
                        }) -}}
                </div>
                <div class="intro">
                    <h3>
                        <a target="_blank" href="{{('sale/xdetail')|U({id: item.id|default('')})}}">{{item.name|default('')}}</a>
                    </h3>
                    <p>
                        <span>
                            {{core_global.address({data: item|default('')})}}
                        </span>
                    </p>
                    <p class="leixing mt20">
                        {{- core_global.formField({value: item.school_type|default(''), form: 'around_school', field: 'school_type', tpl: '<span>%title%</span>'}) -}}
                        {{- core_global.formField({value: item.leibie|default(''), form: 'around', field: 'leibie', tpl: '<span>%title%</span>'}) -}}
                        {{- core_global.formField({value: item.jibie|default(''), form: 'around', field: 'jibie', tpl: '<span>%title%</span>'}) -}}
                    </p>
                </div>
                <div class="jiage">
                    <div class="jg">
                        {% if houses.data is defined %}
                            {% for item2 in houses.data %}
                                <p class="clearfix">
                                    <span class="fr ml10">
                                        {{_self.if_dj({value: item2.dj|default(''), tpl: '%value%%danwei%'})}}
                                    </span>
                                    <span class="chover">
                                        <a href="{{('sale/qdetail')|U({id: item2.id|default('')})}}" title="{{item2.name|default('')}}">{{item2.name|default('')}}</a>
                                    </span>
                                </p>
                            {% endfor %}
                        {% endif %}
                    </div>
                    <div class="dk">
                        <a target="_blank" href="{{('sale/xdetail')|U({id: item.id|default('')})}}">
                            &gt;{{'参看全部对口小区'|trans({})}}(<i>{{- houses.pageCount|default('') -}}</i>)&lt;
                        </a>
                    </div>
                </div>
            </li>
            {% endfor %}
        {% else %}
            <li class="noinfo">{{_self.list_tips(o.tips|default(''))}}</li>
        {% endif %}
        {{core_global.lazyload()}}
    {% endspaceless %}
{%- endmacro -%}

{# 团购
 * 模板   groupbuy/list   groupbuy/detail
 * item_detail: 是否属于详情页
 * item_now: 当前时间
 * item_next_day: 当天时间
 * item_tpl_now: 判断团购是否已结束
 * item_houses: 当前团购所属楼盘
 * item_houses_a: 当前所属楼盘链接
 * item_btn_attr: 报名按钮属性
 * item_end_text: 团购结束倒计时提示
#}
{%- macro groupbuy_list(o) -%}
    {% import "CoreBundle:Macro:global.html.twig" as core_global %}
    {% spaceless %}
        {% if o.list.data is defined and o.list.pageCount|default(0) != 0 %}
            {% for item in o.list.data %}
  {#               {{dump(o.list.data)}} #}
                {% set item_detail = o.tpl_detail|default(1) %}

                {% set item_now = 'now'|date("U") %}

                {% set item_next_day = 'now'|date('Y-m-d')|date('U') + 24 * 60 * 60 %}

                {% set item_tpl_now = item.enddate.date|default('')|date('U') > item_now|default('') ? 1 : 0 %}

                {% set item_houses_a = '<a href="' ~ ('houses/detail')|U({id: item.aid|default('')}) ~ '" title="' ~ item.lpmc|default('') ~ '" target="_blank">所属楼盘：' ~ item.lpmc|default('') ~ '</a>' %}

                {% if item_tpl_now|default('') %}
                {# 团购进行中变量 #}
                    {% set item_btn_attr = 'href="' ~ ('groupbuy/detail')|U({id : item.id|default('')}) ~ '" target="_blank" class="btn"' %}
                {% else %}
                {# 团购已结束变量 #}
                    {% set item_btn_attr = 'href="' ~ ('groupbuy/detail')|U({id : item.id|default('')}) ~ '" target="_blank" class="btn"' %}

                    {% set item_end_text = '<p class="num fr c-e43">团购结束</p>' %}
                {% endif %}
                <li class="list-item {% if item_tpl_now|default('') %}first{% endif %} clearfix">
                    {% if item_detail == 0 %}
                        <h2>
                            <div class="recom pl15 fl">
                               {#  {% if item.enddate.date|default('')|date('U') < item_next_day %}
                                    今日团购
                                {% else %} #}
                                    {# 正在团购 #}
                                {# {% endif %} #}
                            </div>
                            <a href="{{('groupbuy/detail')|U({id:item.id|default('')})}}" target="_blank">{{item.name|default('')}}</a>
                        </h2>
                    {% else %}
                        <h2 class="pas list-item-name">
                            <a href="{{('groupbuy/detail')|U({id:item.id|default('')})}}" target="_blank" title="{{item.name|default('')}}">
                                {{item.name|default('')}}
                            </a>
                        </h2>
                    {% endif %}
                    <div class="pic fl">
                        <a href="{{('groupbuy/detail')|U({id:item.id|default('')})}}" target="_blank">
                            {{- core_global.lazy_img({
                                src: item.thumb|default(''),
                                alt: item.name|default(''),
                                type: 2,
                                width:160 ,
                                height: 120
                            }) -}}
                        </a>
                    </div>
                    <div class="info fl">
                            <div class="clearfix tuanse">
                                <em><span>团购价：</span><strong>{{core_global.if_dw({value: item.tgj|default(''), class: 'c-e43 fz16 pr5'})}}</strong></em>
                                <em><span>市场价：</span> {{core_global.if_dw({value: item.scj|default(''), class: ' fz14 pr5'})}}</em>
                                {# <dl class="fl">
                                    <dt class="fl">
                                        <i class="font-lp-30"></i>
                                    </dt>
                                    <dd>
                                        <p class="c-e43">
                                            <i data-counts="{models: 'groupbuy', field: 'clicks', id: '{{item.id|default('')}}'}"></i>
                                        </p>
                                        <p>
                                            人气
                                        </p>
                                    </dd>
                                </dl> #}
                            </div>
                            {% if item.aid|default('') %}
                            <div class="item-text">
                                {{item_houses_a|default('')|raw}}
                            </div>
                        {% endif %}
                        <div class="item-text">
                            楼盘地址：{{item.hdadr|default('待定')}}
                        </div>
                        <div class="item-text">
                            联系电话：<em class="tel c-e43">{{item.tel|default('更新中...')}}</em>
                        </div>
                    </div>
                    <div class="other fr">
                        <div class="on-sale">
                            <p class="num fr">
                                共<span class="c-e43 pl5 pr5 "><span data-counts="{models: 'groupbuy', field: 'ksnum', id: '{{item.id|default('')}}'}"></span></span>套房源
                            </p>
                            <p class="num fr mt5">
                                已报名<span class="c-e43 pl5 pr5 "><span data-counts="{models: 'groupbuy', field: 'hdnum', id: '{{item.id|default('')}}'}"></span></span>人
                            </p>
                        {% if item_tpl_now|default('') %}
                            <span class="time fr fz14 mt10 format-time" data-endtime="{{item.enddate.date|default('')}}" data-noend="永久有效！" data-type="1" data-timetype="1"></span>
                        </div>
                            <a {{item_btn_attr|default('')|raw}}>立即参团</a>
                        {% else %}
                        </div>
                            <a class="btn disable mt15">团购结束</a>
                        {% endif %}
                    </div>
                    <div class="blank20"></div>
                </li>
            {% endfor %}
        {% else %}
            <li class="noinfo">{{_self.list_tips('团购'|trans({}))}}</li>
        {% endif %}
        {{core_global.lazyload()}}
        <script type="text/javascript">
            seajs.use(['formattime'], function (formattime) {})
        </script>
    {% endspaceless %}
{%- endmacro -%}

{# 分销
 * 模板: fenxiao/list
 * 使用列表: fenxiao/list
 * item_time: 截止时间
 * item_tuijian: 推荐按钮
 * item_goufang: 我要购房按钮
#}
{%- macro sell_list(o) -%}
    {% import "CoreBundle:Macro:global.html.twig" as core_global %}
    {% spaceless %}
        {% set tpl_now = 'now'|date("U") %}
        {% if o.list.data is defined and o.list.pageCount|default(0) != 0 %}
            {% for item in o.list.data %}
                {% if item.enddate.date|default('')|date('U') > tpl_now %}

                    {% set item_time = '<span class="time format-time" data-endtime="' ~ item.enddate.date|default('') ~ '" data-noend="永久有效！" data-end="活动结束" data-type="1" data-timetype="1" data-text="剩余时间">截止日期：' ~ item.enddate.date|default('') ~ '</span>' %}

                    {% set item_tuijian = '<a href="' ~ ('fenxiao/earn')|U({id: item.id|default('')}) ~ '" class="btn" target="_blank">推荐朋友</a>' %}

                    {% set item_goufang = '<a href="' ~ ('fenxiao/earn')|U({id: item.id|default(''), myself: 1}) ~ '" class="btn" target="_blank">我要购房</a>' %}
                {% else %}

                    {% set item_time = '<span class="time"><span>活动结束</span></span>' %}

                    {% set item_tuijian = '<a href="javascript:;" class="btn btn-disable">推荐朋友</a>' %}

                    {% set item_goufang = '<a href="javascript:;" class="btn btn-disable">我要购房</a>' %}
                {% endif %}
                <div class="t1">
                    <a href="{{('fenxiao/detail')|U({id: item.id|default('')})}}" class="fl" target="_blank">
                        {{- core_global.lazy_img({
                            src: item.thumb|default(''),
                            alt: item.name|default(''),
                            type: 0,
                            width:669 ,
                            height: 279
                        }) -}}
                    </a>
                    <div class="t1-text fl">
                        <h2>
                            <a href="{{('fenxiao/detail')|U({id: item.id|default('')})}}" target="_blank">
                                {{item.name|default('')}}
                            </a>
                        </h2>
                        <h3>
                            市场价 {{_self.if_dj({value: item.shichangjia|default('')})}}

                            <span class="fr mr15">佣金 {{core_global.if_dw({value: item.yongjin|default(''), danwei: '元'})}}</span>
                        </h3>
                        <div class="ad">
                            <div class="ad-text">
                                <span>楼盘位置：</span>
                                <div class="ad-txt">
                                    {{('house.houses')|getOne('address', {checked: 1, id: item.aid|default('')})}}
                                </div>
                            </div>
                            开盘日期：{{item.kpsj|default('')|date('Y-m-d')}}
                        </div>
                        <div class="text-box fl">
                            <p>
                                {{item_tuijian|raw}}
                                已推荐<span>{{item.yituijian|default('0')}}</span>人
                            </p>
                            <p>
                                {{item_goufang|raw}}
                            </p>
                        </div>
                        <a href="{{('fenxiao/detail')|U({id: item.id|default('')})}}" class="fr btn-detail" target="_blank">
                            了解详细
                        </a>
                        <div class="blank1"></div>
                        <div class="t1-time">
                            已成交: <span class="time mr20"><span>{{item.yichengjiao|default(0)}}</span>套</span>
                            {{item_time|raw}}
                        </div>
                    </div>
                </div>
            {% endfor %}
        {% else %}
            <div class="noinfo">{{_self.list_tips()}}</div>
        {% endif %}
        {{core_global.lazyload()}}
    {% endspaceless %}
{%- endmacro -%}

{# 专题
 * 模板  topic/index   topic/list
#}
{%- macro topic_list(o) -%}
    {% import "CoreBundle:Macro:global.html.twig" as core_global %}
    {% spaceless %}
        {% if o.list.data is defined and o.list.pageCount|default(0) != 0 %}
            {% for item in o.list.data %}
                {% set item_category = (item.category|default(77))|getCategoryById() %}
                <div class="ztlist-item">
                    <a href="{{('topic/detail')|U({id:item.id|default('')})}}" target="_blank">
                        {{core_global.lazy_img({
                            width: 420,
                            height: 240,
                            src: item.thumb|default(''),
                            alt: item.name|default('')
                        })}}
                    </a>
                    <h2>
                         <span class="F60">
                            [{{item_category.name|default('专题')}}]
                        </span>
                        <a target="_blank" href="{{('topic/detail')|U({id:item.id|default('')})}}">{{item.name}}</a>
                    </h2>
                    <p>
                        {{core_global.substr(item.abstract, 45, 1)}}
                        <a target="_blank" href="{{('topic/detail')|U({id:item.id|default('')})}}">[查看全文]</a>
                    </p>
                </div>
            {% endfor %}
        {% else %}
            <div class="noinfo">{{_self.list_tips()}}</div>
        {% endif %}
        {{core_global.lazyload()}}
    {% endspaceless %}
{%- endmacro -%}

{# 看房团
 * 模板   topic/group   topic/group1/detail
 * item_btn: 报名按钮
 * item_time: 截止时间
#}
{%- macro topic_group(o) -%}
    {% import "CoreBundle:Macro:global.html.twig" as core_global %}
    {% set tpl_now = 'now'|date('U') %}
    {% spaceless %}
        {% if o.list.data is defined and o.list.pageCount|default(0) != 0 %}
            {# 列表id合集 #}
            {% set list_ids = '' %}
            {# 看房合集 #}
            {% set list_push_loupan_data = {} %}
            {% for item in o.list.data %}
                {% if loop.index != 1 %}
                    {% set dh = ',' %}
                {% endif %}
                {% set list_ids = list_ids ~ dh|default('') ~ item.id %}
            {% endfor %}
            {# 看房团合集 #}
            {% set list_push_loupan = ('house.topic_arc')|getBlock({ename: 'loupan'},{checked: 1, aid: 'in|' ~ list_ids, findType: 1, pageSize: o.list.pageSize * 10, order: 'id', orderBy: 'asc'}) %}
            {# 组装数据  data_aid_fromid_id aid为了识别当前前数据，fromid为了识别不同的楼盘，id为了识别手动添加 #}
            {% for item in list_push_loupan.data %}
                {% set list_push_loupan_data = {
                    ("data_" ~ item.aid ~ '_' ~ item.fromid ~ '_' ~ item.id): {
                        "url": item.url,
                        "thumb": item.thumb,
                        "name": item.name,
                        "dj": item.dj,
                        "bdsm": item.bdsm,
                        "address": item.address
                    }
                }|merge(list_push_loupan_data) %}
            {% endfor %}

            {% for item in o.list.data %}

                {% set arc_url = ('topic/detail')|U({id: item.id|default('')}) %}
                {% if item.show_time.date|date('U') > tpl_now|default('') %}
                    {# 活动期间变量 #}
                    {% set item_btn = '<a href="' ~ arc_url ~ '" target="_blank" class="btn">'~('报名组团'|trans({}))~'</a>' %}
                    {% set item_time = '<p class="format-time list-time" data-endtime="' ~ item.show_time.date|default('') ~ '" data-noend="永久有效！" data-end="'~('活动结束'|trans({}))~'" data-type="1" data-timetype="1"></p>' %}
                {% else %}
                    {# 活动结束变量 #}
                    {% set item_btn = '<a href="' ~ arc_url ~ '" class="btn btn-disable">'~('报名组团'|trans({}))~'</a>' %}
                    {% set item_time = '<p class="list-time"><i class="c-e43">'~('活动结束'|trans({}))~'</i></p>' %}
                {% endif %}

                <div class="kft-list">
                    <div class="list-img">
                        <a href="{{('topic/detail')|U({id:item.id|default('')})}}" target="_blank">
                            {{- core_global.lazy_img({
                                src: item.thumb|default(''),
                                alt: item.name|default(''),
                                width: 250,
                                height: 160,
                                type: 2
                            }) -}}
                        </a>
                    </div>
                    <div class="list-content">
                        <div class="list-name mt5">
                            <a href="{{('topic/detail')|U({id:item.id|default('')})}}" target="_blank">
                                {{item.name|default('')|trans({})}}
                            </a>
                        </div>
                        {% if item.discount|default('') %}
                        <div class="list-youhui c-e43">
                            {{'优惠'|trans({})}}: {{item.discount|default('')|trans({})}}
                        </div>
                        {% endif %}
                        <div class="list-tel">
                            {{'电话'|trans({})}}: {{item.hotline|default('暂无')|trans({})}}
                        </div>
                        <div class="list-address">
                            {{'集合地点'|trans({})}}: {{item.venue|default('')|trans({})}}
                        </div>
                        <div class="list-keywords">
                            {{core_global.keywords({keywords: item.keywords|default('')|trans({}), tpl: '<span>%keywords%</span>'})}}
                        </div>
                    </div>
                    <div class="list-operate">
                        <p class="list-enroll">
                            <i class="font-icons-2"></i>{{'已有'|trans({})}}
                            <span class="c-e43">
                                <span data-counts="{models: 'topic', field: 'enroll', id: '{{item.id|default('')}}'}"></span>
                            </span>{{'人报名'|trans({})}}
                        </p>
                        {{item_time|default('')|raw}}
                        {# 判断是否是详情页 #}
                        {% if app.request.get('id') < 1 %}
                            <p>
                                {{item_btn|default('')|raw}}
                            </p>
                        {% endif %}
                    </div>
                    <div class="blank1"></div>

                    <div class="list-route">
                        <div class="list-route-left">
                            <span>{{'看房线路'|trans({})}}</span>
                        </div>
                        <div class="list-route-right"></div>
                        <div class="list-route-line"></div>
                        <table class="list-route-table">
                            <tr>
                                {% if list_push_loupan_data %}
                                    {% for k,item2 in list_push_loupan_data if ('data_' ~ item.id ~ '_') in k %}
                                    <td data-show=".list-route-houses" data-wrap=".kft-list">
                                        <span class="list-route-td-circle"></span>
                                        <div class="sanjiao"></div>
                                        <div class="list-route-houses" data-hover='1'>
                                            <a href="{{item2.url}}" target="_blank" class="list-route-houses-img">
                                                {{- core_global.lazy_img({
                                                    src: item2.thumb|default(''),
                                                    alt: item2.name|default(''),
                                                    width: 134,
                                                    height: 100,
                                                    type: 2
                                                }) -}}
                                            </a>
                                            <div class="list-route-houses-content">
                                                <p>
                                                    <a href="{{item2.url}}" target="_blank">
                                                        {{item2.name|default('')}}
                                                    </a>
                                                </p>
                                                <p>
                                                    {{'均价'|trans({})}}: {{_self.if_dj({value: item2.dj|default(''), tpl: '<span class="c-e43">%value%%danwei%</span>'})}}
                                                </p>
                                                <p>
                                                    {{'优惠'|trans({})}}: <span class="c-e43">{{item2.bdsm|default('')}}</span>
                                                </p>
                                            </div>
                                            <div class="blank1"></div>
                                            <div class="list-route-houses-address">{{'地址'|trans({})}}: {{item2.address|default('')|trans({})}}</div>
                                        </div>
                                        <p class="list-route-td-name">
                                            {{item2.name|default('')|trans({})}}
                                        </p>
                                    </td>
                                    {% endfor %}
                                {% endif %}
                            </tr>
                        </table>
                    </div>
                </div>
            {% endfor %}
        {% else %}
            <div class="noinfo">{{_self.list_tips('看房团'|trans({}))}}</div>
        {% endif %}
        <script type="text/javascript">
            seajs.use(['formattime'], function (formattime) {})
        </script>
        {{core_global.lazyload()}}
    {% endspaceless %}
{%- endmacro -%}

{# 直播
 * 模板  topic/live
#}
{%- macro topic_live(o) -%}
    {% import "CoreBundle:Macro:global.html.twig" as core_global %}
    {% spaceless %}
        {% if o.list.data is defined and o.list.pageCount|default(0) != 0 %}
            {% for item in o.list.data %}
                <li>
                    <a href="{{('topic/detail')|U({id:item.id|default('')})}}" target="_blank" class="pic">
                        {{- core_global.lazy_img({
                            src: item.thumb|default(''),
                            alt: item.name|default(''),
                            width: 182,
                            height: 124,
                            type: 2
                        }) -}}
                    </a>
                    <p class="act"> <em>主　　题：</em> <strong><a href="{{('topic/detail')|U({id:item.id|default('')})}}" target="_blank">{{item.name|default('')}}</a></strong>
                    </p>
                    <p> <em>时　　间：</em>
                        {{item.time.date|default('更新中...')}}
                    </p>
                    <p>
                        <em>地　　点：</em>
                        {{core_global.address({data:item|default('待定')})}}
                    </p>
                    <p class="ny">
                        <em>主题内容：</em>
                        {{core_global.substr(item.abstract, 70, 1)}}
                        <a href="{{('topic/detail')|U({id:item.id|default('')})}}" target="_blank" class="c">更多详情&gt;&gt;</a>
                    </p>
                </li>
            {% endfor %}
        {% else %}
             <div class="noinfo">{{_self.list_tips('直播'|trans({}))}}</div>
        {% endif %}
        {{core_global.lazyload()}}
    {% endspaceless %}
{%- endmacro -%}

{# 视频
 * 模板   video/index   video/list
#}

{%- macro video_list(o) -%}
    {% import "CoreBundle:Macro:global.html.twig" as core_global %}
    {% spaceless %}
        <div class="panel video-floor">
            <div class="panel-title">
                <h2 {% if o.isList|default(0) %}style="height: auto; line-height: 1.5; margin-bottom: 15px;"{% endif %}>
                    {{o.title|default('')|raw}}
                    {% if o.isList|default(0) != 1 %}
                        <a href="{{('video/list')|U({category: o.category|default(16)})}}" target="_blank" class="more-video">更多</a>
                    {% endif %}
                </h2>
            </div>
            <div class="panel-body">
                <ul class="clearfix video-list">
                    {% if o.list.data is defined and o.list.pageCount|default(0) != 0 %}
                        {% for item in o.list.data %}
                            <li>
                                <a href="{{('video/detail')|U({id:item.id|default('')})}}" target="_blank">
                                    {{- core_global.lazy_img({
                                        src: item.thumb|default(''),
                                        alt: item.name|default(''),
                                        type: 2,
                                        width: 195,
                                        height: 130
                                    }) -}}
                                    {% if item.dujia|default('') == 1 %}
                                        <div class="list-tag">{{'独家'|trans({})}}</div>
                                    {% endif %}
                                </a>
                                <a href="{{('video/detail')|U({id:item.id|default('')})}}" target="_blank">
                                    <p class="list-desc" title="{{item.name|default('')|trans({})}}">
                                        {{item.name|default('')}}
                                    </p>
                                </a>
                                <p class="list-time">
                                    {{'更新日期'|trans({})}}：{{item.update_time|default('')|date('Y-m-d')}}
                                </p>
                            </li>
                        {% endfor %}
                    {% else %}
                        <div class="noinfo">{{_self.list_tips()}}</div>
                    {% endif %}
                </ul>
                {% if o.isList|default(0) %}
                    <!--page-->
                    {{core_global.page(o.list)}}
                    <!--page-->
                {% endif %}
            </div>
        </div>
        {{core_global.lazyload()}}
    {% endspaceless %}
{%- endmacro -%}

{# 置业指南
 * 模板   guide/index   guide/list
#}
{%- macro guide_list(o) -%}
    {% import "CoreBundle:Macro:global.html.twig" as core_global %}
    {% spaceless %}
        {% if o.list.data is defined and o.list.pageCount|default(0) != 0 %}
            {% for item in o.list.data %}
                <div class="list-b">
                    <a href="{{('guide/detail')|U({id:item.id|default('')})}}" target="_blank">
                        {{- core_global.lazy_img({
                            src: item.thumb|default(''),
                            alt: item.name|default(''),
                            type: 2,
                            width: 130,
                            height:100
                        }) -}}
                    </a>
                    <div class="tbox">
                        <h3>
                            <a href="{{('guide/detail')|U({id:item.id|default('')})}}" target="_blank">{{item.name|default('')}}</a>
                        </h3>
                        <p>
                            {{ core_global.substr(item.abstract|default(''), 80, 1) }}
                        </p>
                        <div class="ls-btn">
                            {{core_global.keywords({
                                keywords: item.keywords|default(''),
                                models: 'guide',
                                tpl: '<a href="%url%">%keywords%</a>'
                            })}}
                            <div class="p-row" data-vote="{models: 'news', id: {{item.id|default('')}}, field: 'vote'}">
                                <i class="font-gd-p"></i>
                                (<span data-vote-num="{{item.vote|default(0)}}">{{item.vote|default(0)}}</span>)
                            </div>

                        </div>
                    </div>
                </div>
            {% endfor %}
        {% else %}
            <p class="noinfo">{{_self.list_tips()}}</p>
        {% endif %}
        {{core_global.lazyload()}}
    {% endspaceless %}
{%- endmacro -%}

{# 服务中心
 * 模板   service/list
#}
{%- macro service_list(o) -%}
    {% spaceless %}
        {% if o.list.data is defined and o.list.pageCount|default(0) != 0 %}
            {% for item in o.list.data %}
                <li class="{% if loop.index % 10 == 0 or loop.index % 10 == 9 %}line{% elseif loop.last %}line{% endif %}">
                    <a href="{{('service/detail')|U({id: item.id})}}" title="{{item.name|trans({})}}" target="_blank">
                        <i class="font-service-arrow"></i>
                        {{item.name|trans({})}}
                    </a>
                </li>
                {% else %}
                <div class="noinfo">{{_self.list_tips()}}</div>
            {% endfor %}
        {% endif %}
    {% endspaceless %}
{%- endmacro -%}
