<!DOCTYPE html>
<html lang="zh">
<head>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/> 
	<title>微信支付</title>
</head>
<body>
{% set total = app.request.get('total_fee') %}
{% set infojsapi = info['jsApiParameters']|default('') %}
{% if info.mweb_url is defined %}
{% set mweb_url =  info.mweb_url ~ 'redirect_url' ~ ('main/mindex')|U %}
<p>正在为您跳转微信支付平台请稍候...</p>
<script type="text/javascript">
	window.location.href="{{ mweb_url }}"
</script>
{% elseif infojsapi %}
<style type="text/css">
	*{
		margin:0;
		padding:0;
	}
	.paybtn {
		padding: 8px 20%;
		border-radius: 5px;
		background-color:#fd8600;
		border:none; 
		cursor: pointer;
		text-align: center;  
		color: #FFF;  
		font-size:14px; 
		}
	.order{
		font-size: 14px;
		height: 39px;
		line-height: 39px;
		padding-left: 10px;
    	background: #f4f4f4;
	}
	.btnbox{
		text-align: center;
		margin-top: 60px;
		display: none;

	}
</style>
<div class="order">
	支付订单已经创建, 请尽快进行支付, 金额<font color="#FE6714"> {{ total }} </font>元
</div>
<div class="btnbox">
<button class="paybtn" style=" " type="button" onclick="callpay()" >重新支付</button>
</div>
<script type="text/javascript">
	//调用微信JS api 支付
	function jsApiCall()
	{
		WeixinJSBridge.invoke(
			'getBrandWCPayRequest',
				{{ infojsapi|raw }},
			function(res){
				WeixinJSBridge.log(res.err_msg);
				if ( res.err_msg =='get_brand_wcpay_request:cancel') {
					alert('支付失败');
					document.querySelector('.btnbox').style.display='block';
				}else if( res.err_msg == 'get_brand_wcpay_request:ok'){
					window.location.href="{{('main/mindex')|U}}";
				};
				// alert(res.err_code+','+res.err_desc+','+res.err_msg);
			}
		);
	}
	function callpay()
	{
		if (typeof WeixinJSBridge == "undefined"){
		    if( document.addEventListener ){
		        document.addEventListener('WeixinJSBridgeReady', jsApiCall, false);
		    }else if (document.attachEvent){
		        document.attachEvent('WeixinJSBridgeReady', jsApiCall); 
		        document.attachEvent('onWeixinJSBridgeReady', jsApiCall);
		    }
		}else{
		    jsApiCall();
		}
	}
	</script>
{% else %}
<style type="text/css">
		.qrcode{
			text-align: center;
			overflow: hidden;
			font-family: "Microsoft YaHei";
			line-height: 1.5;
		}
		.qrcode p{
			font-size:22px;
			color:#333;
		}
		.qrcode p em{
			color:#FF6600;
		}
		
		.qrcode p.tip{
			font-size: 14px;
			color:#808080;
		}
</style>
<div class="qrcode" id="qrcode">
<p>支付金额<font color="#FE6714">￥ {{ total }} </font>元, 请使用微信扫描下方二维码完成支付</p>	
<p class="tip">支付成功后, 请关闭该页面</p>
<img src="{{ qrcode_base64(info['code_url'],10) }}" /> 
</div>	
 {% endif %} 
{# <div class=" tac " id="tip">支付成功</div> #}
</body>
</html>